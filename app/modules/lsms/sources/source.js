define(["angularAMD","modules/lsms/sources/service","Session"],function(angularAMD){"use strict";angularAMD.controller("SourceManageCtrl",["$scope","SourceService","Session","$controller","$state","ngDialog","StarsUtils",function($scope,SourceService,Session,$controller,$state,ngDialog,StarsUtils){$scope.methods=$state.current.data.methods,$scope.$state=$state;var sourceManageCtrl=$scope.sourceManageCtrl={};$controller("BaseCtrl",{$scope:$scope}),$scope.dataConfig={create:{template:"modules/lsms/sources/sourceEdit.html",data:{title:"新增源信息",item:{}},controller:"SourceManageEditCtrl"},edit:{template:"modules/lsms/sources/sourceEdit.html",data:{title:"编辑源信息"},controller:"SourceManageEditCtrl"}},$scope.itemService=SourceService.setName("source"),"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage),sourceManageCtrl.openVideo=function(title,url){if(url.indexOf("p2p://")>-1)return void StarsUtils.alert("暂不支持播放p2p源");if(-1==url.indexOf("://"))return void StarsUtils.alert("播放地址格式不正确");var open=ngDialog.open({template:"modules/lsms/sources/showVideo.html",data:{title:title,location:url},controller:"ShowVideoCtrl"});open.closePromise.then(function(data){"$closeButton"==data.value&&window.location.reload()},function(error){})},sourceManageCtrl.openVideoList=function(id,name){$scope.videoPid=id,$scope.sourceName=name;var opens=ngDialog.open({template:"modules/lsms/sources/sourceVideo.html",data:{title:"涉及的频道：频道总数",id:$scope.videoPid,name:$scope.sourceName},controller:"SourceVideoCtrl"});opens.closePromise.then(function(data){$scope.getResultsPage($scope.currentPage)})}}])});