define("modules/oms/apps/appOperation",["angularAMD","modules/oms/apps/service"],function(angularAMD){"use strict";angularAMD.controller("appOperationCtrl",function($scope,AppsService,$controller){function isRelation(type){$scope.norelativeObj=[],$scope.relativeObj=[],0==type||1==type?angular.forEach($scope.items,function(obj){-1==$scope.ids.indexOf(obj.videoId)?$scope.norelativeObj.push({videoId:obj.videoId,videoName:obj.videoName,videoCategory:obj.videoCategory}):$scope.relativeObj.push({videoId:obj.videoId,videoName:obj.videoName,videoCategory:obj.videoCategory})}):angular.forEach($scope.items,function(obj){-1==$scope.ids.indexOf(obj.tabletId)?$scope.norelativeObj.push({tabletId:obj.tabletId,tabletName:obj.tabletName,apiName:obj.apiName,tabletType:obj.tabletType}):$scope.relativeObj.push({tabletId:obj.tabletId,tabletName:obj.tabletName,apiName:obj.apiName,tabletType:obj.tabletType})})}function saveRelation(status){if($scope.no_ids.length>0&&0==status&&($scope.ids=$scope.ids.concat($scope.no_ids)),$scope.is_ids.length>0&&1==status)for(var i=0;i<$scope.is_ids.length;i++)$scope.ids.splice($scope.ids.indexOf($scope.is_ids[i]),1);var item;1!=$scope.type||categoryName?1==$scope.type&&"category"==categoryName?item={categoryId:$scope.ngDialogData.appId,refId:$scope.ids,type:2}:0==$scope.type?item={appId:$scope.ngDialogData.appId,refId:$scope.ids,appRelationType:$scope.type}:2==$scope.type&&(item={appId:$scope.ngDialogData.appId,refId:$scope.ids,appRelationType:22}):item={appId:$scope.ngDialogData.appId,refId:$scope.ids,isApp:1},$scope.submitStatus=!0,AppsService.saveRelation(item).then(function(){$scope.closeThisDialog()},function(error){$scope.submitStatus=!1,$scope.errorMessage=error})}var appOperationCtrl=$scope.appOperationCtrl={};$scope.errorMessage="",$scope.title=$scope.ngDialogData.title,$scope.type=$scope.ngDialogData.type;var categoryName=$scope.categoryName=$scope.ngDialogData.name;$controller("BaseCtrl",{$scope:$scope});$scope.app=$scope.ngDialogData.item;$scope.ids=[],$scope.is_ids=[],$scope.no_ids=[],$scope.selectAll_is=!1,$scope.selectAll_no=!1,appOperationCtrl.init=function(){$scope.items=[],$scope.ids=[],$scope.loading_list=!0,$scope.searchParams.isAll=1,AppsService.getVideoList($scope.searchParams,$scope.type).then(function(e){$scope.items=e.data.rows,$scope.totalItems=e.data.totalResults,categoryName&&"category"==categoryName?AppsService.getCategoryRelation($scope.ngDialogData.appId,$scope.type).then(function(e){$scope.loading_list=!1,angular.forEach(e.data.rows,function(obj){$scope.ids.push(obj.refId)}),0==$scope.ids.length&&($scope.isRelative=0),isRelation($scope.type)}):AppsService.getRelation($scope.ngDialogData.appId,$scope.type).then(function(e){$scope.loading_list=!1,angular.forEach(e.data.rows,function(obj){$scope.ids.push(obj.refId)}),0==$scope.ids.length&&($scope.isRelative=0),isRelation($scope.type)})})},$scope.isRelative=1,appOperationCtrl.changeRelation=function(i){$scope.isRelative=i},appOperationCtrl.toggleAll=function(type,obj){1==type?obj.selectAll_is?($scope.is_ids=[],2==$scope.type?angular.forEach($scope.items,function(obj){$scope.is_ids.push(obj.tabletId)}):angular.forEach($scope.items,function(obj){$scope.is_ids.push(obj.videoId)})):$scope.is_ids=[]:obj.selectAll_no?($scope.no_ids=[],2==$scope.type?angular.forEach($scope.items,function(obj){-1==$scope.ids.indexOf(obj.tabletId)&&$scope.no_ids.push(obj.tabletId)}):angular.forEach($scope.items,function(obj){-1==$scope.ids.indexOf(obj.videoId)&&$scope.no_ids.push(obj.videoId)})):$scope.no_ids=[]},appOperationCtrl.toggleSelection=function(vid,type){1==type?$scope.is_ids.indexOf(vid)>=0?$scope.is_ids.splice($scope.is_ids.indexOf(vid),1):$scope.is_ids.push(vid):0==type&&($scope.no_ids.indexOf(vid)>=0?$scope.no_ids.splice($scope.no_ids.indexOf(vid),1):$scope.no_ids.push(vid))},appOperationCtrl.search=function(){appOperationCtrl.init()},AppsService.getAllArea().then(function(resp){$scope.areaList=resp.data.rows},function(){}),appOperationCtrl.checkCloseDialog=function(status){saveRelation(status)},appOperationCtrl.init()})}),define("modules/oms/apps/appShow",["angularAMD","modules/oms/apps/service","Session"],function(angularAMD){"use strict";angularAMD.controller("AppShowCtrl",["$scope","Session","AppsService","$controller",function($scope,Session,AppsService,$controller){var appShowCtrl=$scope.appShowCtrl={};$scope.errorMessage="",$controller("BaseCtrl",{$scope:$scope}),$scope.title=$scope.ngDialogData.title,$scope.type=$scope.ngDialogData.type,$scope.appKeyId=$scope.ngDialogData.appKeyId,$scope.fatherName=$scope.ngDialogData.name;$scope.app=$scope.ngDialogData.item;appShowCtrl.init=function(){0==$scope.type?($scope.newPage=1,AppsService.getAppVod($scope.appKeyId,1,{videoName:""}).then(function(e){$scope.loading_list=!1,$scope.items=e.data.rows,$scope.totalItems=e.data.totalResults})):($scope.newPage=1,AppsService.getAppVideo($scope.appKeyId,1,{videoName:""}).then(function(e){$scope.loading_list=!1,$scope.items=e.data.rows,$scope.totalItems=e.data.totalResults}))},appShowCtrl.init(),(0==$scope.type||1==$scope.type)&&(appShowCtrl.search=function(){$scope.getResultsPage(1,$scope.searchParams)},$scope.pageChanged=function(newPage){$scope.newPage=newPage,$scope.getResultsPage(newPage,$scope.searchParams)},$scope.getResultsPage=function(pageNumber,params){$scope.currentPage=pageNumber,$scope.items=[],$scope.loading_list=!0,0===$scope.type?AppsService.getAppVod($scope.appKeyId,pageNumber,params).then(function(e){$scope.loading_list=!1,$scope.totalItems=e.data.totalResults,$scope.items=e.data.rows}):AppsService.getAppVideo($scope.appKeyId,pageNumber,params).then(function(e){$scope.loading_list=!1,$scope.totalItems=e.data.totalResults,$scope.items=e.data.rows})})}])}),define("modules/oms/apps/apps",["angularAMD","modules/oms/apps/service","Session"],function(angularAMD){"use strict";angularAMD.controller("AppsCtrl",["$scope","AppsService","Session","$controller","$state","ngDialog","$stateParams",function($scope,AppsService,Session,$controller,$state,ngDialog,$stateParams){$scope.methods=$state.current.data.methods;$scope.appsCtrl={};$scope.dataConfig={edit:{template:"modules/oms/apps/appsEdit.html",data:{title:"编辑版本",appsAppId:$stateParams.appsAppId},controller:"AppsEditCtrl"},create:{template:"modules/oms/apps/appsEdit.html",data:{title:"添加版本",appsAppId:$stateParams.appsAppId},controller:"AppsEditCtrl"},live:{template:"modules/oms/apps/appOperation.html",data:{appId:"",title:"设置频道",type:1},controller:"appOperationCtrl"},onDemand:{template:"modules/oms/apps/appOperation.html",data:{appId:"",title:"设置栏目",type:0},controller:"appOperationCtrl"},tab:{template:"modules/oms/apps/appOperation.html",data:{appId:"",title:"设置模块",type:2},controller:"appOperationCtrl"}},$controller("BaseCtrl",{$scope:$scope}),$scope.route(),$scope.itemService=AppsService.setName("apps"),$scope.searchParams.appsAppId=$stateParams.appsAppId,$scope.searchParams.isAll=1,$scope.titleName=$stateParams.titleName,"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage,$scope.searchParams),$scope.itemCtrl.operation=function(obj,type){var config;switch(type){case 0:config=$scope.dataConfig.onDemand;break;case 1:config=$scope.dataConfig.live;break;case 2:config=$scope.dataConfig.tab}config.data.appId=obj.id;var ngdialog=ngDialog.open(config);ngdialog.closePromise.then(function(data){$scope.getResultsPage($scope.currentPage,$scope.searchParams)})},$scope.itemCtrl.forceUpdate=function(app){var ngdialog=ngDialog.open({template:"modules/oms/apps/appsForceUpdate.html",data:{title:"升级管理",app:angular.copy(app)},controller:"AppsForceUpdateCtrl"});ngdialog.closePromise.then(function(data){$scope.getResultsPage($scope.currentPage,$scope.searchParams)})}}])}),define("modules/oms/apps/appsEdit",["angularAMD","modules/oms/apps/service"],function(angularAMD){"use strict";angularAMD.controller("AppsEditCtrl",function($scope,AppsService,$stateParams){var appsEditCtrl=$scope.appsEditCtrl={},submitted=!1;$scope.errorMessage="",$scope.title=$scope.ngDialogData.title;$scope.app=$scope.ngDialogData.item;$scope.appALists=[],$scope.appILists=[],$scope.phoneStatus=[{name:"IOS"},{name:"Android"}],AppsService.getApp_version({appsAppId:$scope.ngDialogData.appsAppId,isAll:1}).then(function(resp){var list=resp.data.rows;list.map(function(li){li.appsAppOs==$scope.phoneStatus[1].name?$scope.appALists.push(li):$scope.appILists.push(li)})}),"undefined"==typeof $scope.app||null==$scope.app.id?($scope.app={},$scope.app.appsAppOs=$scope.phoneStatus[0],$scope.appLists=$scope.appILists):"IOS"==$scope.app.appsAppOs?$scope.app.appsAppOs=$scope.phoneStatus[0]:$scope.app.appsAppOs=$scope.phoneStatus[1],$scope.app.appsAppId=$scope.ngDialogData.appsAppId,appsEditCtrl.changeAppOs=function(appOs){appOs==$scope.phoneStatus[0]?$scope.appLists=$scope.appILists:$scope.appLists=$scope.appALists},appsEditCtrl.checkCloseDialog=function(){$scope.errorMessage="",submitted=!0;var saveApp=angular.copy($scope.app);saveApp.cloneAId&&(saveApp.cloneAId=saveApp.cloneAId.id),saveApp.appsAppOs=$scope.app.appsAppOs.name,AppsService.saveItem(saveApp,$scope).then(function(data){$scope.submitStatus=!1,$scope.closeThisDialog(data)},function(error){$scope.submitStatus=!1,$scope.errorMessage=error})}})}),define("modules/oms/apps/appsForceUpdate",["angularAMD","modules/oms/apps/service"],function(angularAMD){"use strict";angularAMD.controller("AppsForceUpdateCtrl",function($scope,AppsService){function getMarketAppElement(roles){roles.length>0&&""==app.appsTargetVersion?$scope.marketApp[0].appsTargetVersion=angular.copy(roles[0].appsAppVersion):$scope.marketApp[0].appsTargetVersion=angular.copy(app.appsTargetVersion)}var appsForceUpdateCtrl=$scope.appsForceUpdateCtrl={},submitted=!1;$scope.errorMessage="",$scope.title=$scope.ngDialogData.title;var app=$scope.app=$scope.ngDialogData.app;$scope.showFeedback=[],app.marketIds=[],$scope.showAll=!1,$scope.showMarkets=[],app.datas=[];var newValues;$scope.roles=[],$scope.marketApp=[{id:"",appMarketId:"",appsUpdateStatus:"1",appsTargetVersion:"",appsAppSource:"",appsUpdateMessage:""}],AppsService.getRoleList({appsAppOs:app.appsAppOs,appsAppId:app.appsAppId}).then(function(data){$scope.submitStatus=!1,$scope.roles=data.data.rows,getMarketAppElement($scope.roles)},function(error){$scope.submitStatus=!1}),AppsService.getMarketList({isAll:1}).then(function(resp){$scope.marketList=resp.data.rows,angular.forEach(app.marketLists,function(obj){$scope.showFeedback.push(obj)})},function(error){}),$scope.$watch("marketApp",function(newValue,oldValue){newValues=$scope.newValues=newValue[0],$scope.marketCurrent&&-1==$scope.showMarkets.indexOf($scope.marketCurrent.marketId)&&"1"!==newValue[0].appsUpdateStatus&&"0"!==$scope.marketCurrent.marketId&&$scope.showMarkets.push($scope.marketCurrent.marketId),$scope.marketCurrent&&-1!==$scope.showMarkets.indexOf($scope.marketCurrent.marketId)&&"1"==newValue[0].appsUpdateStatus&&"0"!==$scope.marketCurrent.marketId&&$scope.showMarkets.splice($scope.showMarkets.indexOf($scope.marketCurrent.marketId),1),$scope.marketCurrent&&($scope.npmMarketIds=[],angular.forEach(app.datas,function(obj){$scope.npmMarketIds.push(obj.upgradeMarketId),$scope.marketCurrent.marketId==obj.upgradeMarketId&&(app.datas[app.datas.indexOf(obj)]={upgradeAppverId:app.id,upgradeMarketId:$scope.marketCurrent.marketId,upgradeStatus:newValues.appsUpdateStatus,upgradeTargetVersion:newValues.appsTargetVersion,upgradeAppSource:newValues.appsAppSource,upgradeMessage:newValues.appsUpdateMessage})}),-1==$scope.npmMarketIds.indexOf($scope.marketCurrent.marketId)&&"1"!==newValue[0].appsUpdateStatus&&app.datas.push({upgradeAppverId:app.id,upgradeMarketId:$scope.marketCurrent.marketId,upgradeStatus:newValues.appsUpdateStatus,upgradeTargetVersion:newValues.appsTargetVersion,upgradeAppSource:newValues.appsAppSource,upgradeMessage:newValues.appsUpdateMessage}))},!0),AppsService.getUpdateGrades(app.id).then(function(resp){$scope.updateGrades=resp.data.rows,$scope.showMarkets=[],angular.forEach($scope.updateGrades,function(obj,i){"number"==typeof obj.upgradeStatus&&(obj.upgradeStatus=obj.upgradeStatus.toString()),app.datas.push({upgradeAppverId:app.id,upgradeMarketId:obj.upgradeMarketId,upgradeStatus:obj.upgradeStatus,upgradeTargetVersion:obj.upgradeTargetVersion,upgradeAppSource:obj.upgradeAppSource,upgradeMessage:obj.upgradeMessage}),"0"===obj.upgradeMarketId&&($scope.showAll=!0,$(".mars").addClass("btn-warning"),$scope.marketApp=[{id:obj.upgradeAppverId,appMarketId:obj.upgradeMarketId,appsUpdateStatus:obj.upgradeStatus,appsTargetVersion:obj.upgradeTargetVersion,appsAppSource:obj.upgradeAppSource,appsUpdateMessage:obj.upgradeMessage}]),$scope.showMarkets.push(obj.upgradeMarketId)})},function(error){}),appsForceUpdateCtrl.currentMarket=function(market,index,event){$scope.marketCurrent=market,$(".mar").hasClass("btn-warning")&&$(".mar").removeClass("btn-warning"),$scope.marketApp=[{id:"",appMarketId:"",appsUpdateStatus:"1",appsTargetVersion:"",appsAppSource:"",appsUpdateMessage:""}],getMarketAppElement($scope.roles),event.target.className=event.target.className+" btn-warning",angular.forEach(app.datas,function(obj){market.marketId==obj.upgradeMarketId&&($scope.marketApp=[{id:obj.upgradeAppverId,appMarketId:obj.upgradeMarketId,appsUpdateStatus:obj.upgradeStatus,appsTargetVersion:obj.upgradeTargetVersion,appsAppSource:obj.upgradeAppSource,appsUpdateMessage:obj.upgradeMessage}]),"0"==obj.upgradeMarketId&&(app.datas=[])})},appsForceUpdateCtrl.allMarket=function(event){1==$scope.showAll?$scope.showAll=!1:$scope.showAll=!0,1==$scope.showAll?event.target.className=event.target.className+" btn-warning":$(".mars").removeClass("btn-warning"),$scope.showAll&&$(".mar").removeClass("btn-warning"),$scope.showMarkets=[],angular.forEach($scope.updateGrades,function(obj){$scope.showMarkets.push(obj.upgradeMarketId),"0"==obj.upgradeMarketId&&($scope.marketApp=[{id:obj.upgradeAppverId,appMarketId:obj.upgradeMarketId,appsUpdateStatus:obj.upgradeStatus,appsTargetVersion:obj.upgradeTargetVersion,appsAppSource:obj.upgradeAppSource,appsUpdateMessage:obj.upgradeMessage}])}),-1==$scope.showMarkets.indexOf("0")&&($scope.marketApp=[{id:app.id,appMarketId:"0",appsUpdateStatus:"1",appsTargetVersion:"",appsAppSource:"",appsUpdateMessage:""}],getMarketAppElement($scope.roles))},appsForceUpdateCtrl.checkCloseDialog=function(){if($scope.errorMessage="",submitted=!0,$scope.showAll&&1!==$scope.marketApp[0].appsUpdateStatus){var marketApp=$scope.marketApp[0];app.datas=[],app.datas=[{upgradeAppverId:app.id,upgradeMarketId:"0",upgradeStatus:marketApp.appsUpdateStatus,upgradeTargetVersion:marketApp.appsTargetVersion,upgradeAppSource:marketApp.appsAppSource,upgradeMessage:marketApp.appsUpdateMessage}]}angular.forEach(app.datas,function(data,i){"number"==typeof data.upgradeStatus&&(data.upgradeStatus=data.upgradeStatus.toString())}),AppsService.saveUpGrades({appverId:app.id,data:app.datas},$scope).then(function(data){$scope.submitStatus=!1,$scope.closeThisDialog(data)},function(error){$scope.submitStatus=!1,$scope.errorMessage="code "+error.data.code+":"+error.data.message})}})}),define("modules/oms/apps/appsKey",["angularAMD","modules/oms/apps/service","Session"],function(angularAMD){"use strict";angularAMD.controller("AppsKeyCtrl",["$scope","AppsService","Session","$controller","$state","ngDialog",function($scope,AppsService,Session,$controller,$state,ngDialog){$scope.methods=$state.current.data.methods;var appsKeyCtrl=$scope.appsKeyCtrl={};$scope.dataConfig={edit:{template:"modules/oms/apps/appsKeyEdit.html",data:{title:"编辑应用"},controller:"AppsKeyEditCtrl"},create:{template:"modules/oms/apps/appsKeyEdit.html",data:{title:"应用增加"},controller:"AppsKeyEditCtrl"},video:{template:"modules/oms/apps/appShow.html",data:{title:"所有版本涉及的频道：频道总数",type:1,name:$scope.name},controller:"AppShowCtrl"},vod:{template:"modules/oms/apps/appShow.html",data:{title:"所有版本涉及的栏目：栏目总数",type:0,name:$scope.name},controller:"AppShowCtrl"}},$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=AppsService.setName("appKey"),$scope.searchParams.isAll=1,"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage,$scope.searchParams),$scope.itemCtrl.changeStatus=function(item,status){AppsService.changeStatu({id:item.id,status:status},$scope).then(function(resp){$scope.status=resp.data.status,$scope.getResultsPage($scope.currentPage,$scope.searchParams)})},appsKeyCtrl.operation=function(obj,type,name){var config;config=1==type?$scope.dataConfig.video:$scope.dataConfig.vod,config.data.appKeyId=obj.id,config.data.name=obj.name;var ngdialog=ngDialog.open(config);ngdialog.closePromise.then(function(data){$scope.getResultsPage($scope.currentPage,$scope.searchParams)})}}])}),define("modules/oms/apps/appsKeyEdit",["angularAMD","modules/oms/apps/service"],function(angularAMD){"use strict";angularAMD.controller("AppsKeyEditCtrl",function($scope,AppsService){var appsKeyEditCtrl=$scope.appsKeyEditCtrl={},submitted=!1;$scope.errorMessage="",$scope.title=$scope.ngDialogData.title;var app=$scope.app=$scope.ngDialogData.item;if($scope.packageAName=[],$scope.packageBName=[],"undefined"==typeof $scope.app&&($scope.app={}),angular.isUndefined(app))AppsService.getAppKey().then(function(resp){$scope.app.appKey=resp.data.data.appKey}),$scope.app.status=0,$scope.packageAName=[{name:""}],$scope.packageBName=[{name:""}];else if(""!==app["package"]&&null!==app["package"]&&"undefined"!=typeof app["package"]){var packageAll=JSON.parse(app["package"]);if(packageAll.Android)for(var package_A=packageAll.Android,i=0;i<package_A.length;i++)$scope.packageAName.push({name:package_A[i]});else $scope.packageAName.push({name:""});if(packageAll.IOS)for(var package_I=packageAll.IOS,j=0;j<package_I.length;j++)$scope.packageBName.push({name:package_I[j]});else $scope.packageBName.push({name:""})}else $scope.packageAName.push({name:""}),$scope.packageBName.push({name:""});appsKeyEditCtrl.addPackage=function(type){1==type?$scope.packageAName.push({name:""}):$scope.packageBName.push({name:""})},appsKeyEditCtrl.removePackage=function(index,type){1==type?$scope.packageAName.splice(index,1):$scope.packageBName.splice(index,1)},appsKeyEditCtrl.checkCloseDialog=function(){$scope.errorMessage="",submitted=!0,angular.isUndefined(app)&&delete $scope.app.appKey;var packageAName=[],packageBName=[];$scope.packageAName.map(function(li){""!==li.name&&packageAName.push(li.name)}),$scope.packageBName.map(function(li){""!==li.name&&packageBName.push(li.name)}),$scope.app["package"]={Android:packageAName,IOS:packageBName},0==packageAName.length&&delete $scope.app["package"].Android,0==packageBName.length&&delete $scope.app["package"].IOS,AppsService.saveItem($scope.app,$scope).then(function(data){$scope.submitStatus=!1,$scope.closeThisDialog(data)},function(error){$scope.submitStatus=!1,$scope.errorMessage=error})}})}),define("modules/oms/apps/service",["angularAMD","BaseService"],function(angularAMD,BaseService){"use strict";angularAMD.service("AppsService",["APP_CONFIG","$http","$q",function(config,$http,$q){var mapping={apps:{id:"appsId",appsAppId:"appsAppId",appVersion:"appsAppVersion",appsUserId:"appsUserId",appsCreatedAt:"appsCreatedAt",appsUpdatedAt:"appsUpdatedAt",appsDescription:"appsDescription",appsIsAds:"appsIsAds",appsIsReview:"appsIsReview",appsIsUpdate:"appsIsUpdate",appsTargetVersion:"appsTargetVersion",appsUpdateMessage:"appsUpdateMessage",appsAppSource:"appsAppSource",appsAppOs:"appsAppOs",userName:"userName",cloneAId:"cloneAId",appsUpdateStatus:"appsUpdateStatus",areaId:"areaId",isAll:"isAll"},video:{id:"videoId",name:"videoName",areaId:"areaId"},appKey:{id:"appKeyId",name:"appKeyName",keyType:"type",description:"description",appKey:"appKey",secret:"Secret",status:"status",userName:"userName",createdAt:"createdAt",updatedAt:"updatedAt","package":"package",isAll:"isAll"},area:{id:"areaId",name:"areaName",areaNote:"areaNote",createdAt:"createdAt",updatedAt:"updatedAt",userId:"userId",refName:"refName",refId:"refId"},market:{id:"id",marketId:"marketId",name:"marketName",note:"marketNote",createdAt:"createdAt",updatedAt:"updatedAt",isAll:"isAll"}},appsService=new BaseService(config,$http,$q,mapping);return appsService.getVideo=function(type,currentPage){var url;0==type?url=config.httpBaseUrl+"/apps/video?videoStatus=1&videoType="+type+"&currentPage="+currentPage:1==type?url=config.httpBaseUrl+"/apps/video?videoStatus=1&currentPage="+currentPage:2==type&&(url=config.httpBaseUrl+"/tablet/index?isAll=1");var that=this,d=that.$q.defer();return $http({url:url,method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},appsService.getVideoList=function(params,type){var url,that=this,d=that.$q.defer();return 0==type&&(params.videoStatus=1,params.videoType=type,url=that.httpBaseUrl+"/apps/video"),1==type&&(params.videoStatus=1,url=that.httpBaseUrl+"/apps/video"),2==type&&(url=that.httpBaseUrl+"/tablet/index"),$http({url:url,method:"GET",params:params,header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/json"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},appsService.getRelation=function(appid,type){var url,params;url=config.httpBaseUrl+"/appRelation/index",0==type?params={isAll:1,appRelationType:0,appId:appid}:1==type?params={isAll:1,isApp:1,appRelationType:1,appId:appid}:2==type&&(params={isAll:1,appRelationType:22,appId:appid});var that=this,d=that.$q.defer();return $http({url:url,method:"GET",params:params,withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},appsService.getCategoryRelation=function(appid,type){var url,params;url=config.httpBaseUrl+"/videoCategory/index",1==type&&(params={isAll:1,categoryId:appid});var that=this,d=that.$q.defer();return $http({url:url,method:"GET",params:params,withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},appsService.getRoleList=function(params){var d=$q.defer();return $http({url:config.httpBaseUrl+"/apps/index",params:params,method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},appsService.getUpdateGrades=function(id){var d=$q.defer();return $http({url:config.httpBaseUrl+"/apps/upgrades/"+id,method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},appsService.saveUpGrades=function(item,scope){var that=this,method="POST",name=that.name;return scope.submitStatus=!0,that.$http({url:that.httpBaseUrl+"/"+name+"/upgrades/"+item.appverId,method:method,data:item,withCredentials:!0})},appsService.getMarketList=function(params){var that=this,d=$q.defer();return $http({url:config.httpBaseUrl+"/market/index",params:params,method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows,mapping.market),d.resolve(resp)},function(error){d.reject(error)}),d.promise},appsService.saveRelation=function(item,scope){var method,url,that=this;return item.categoryId?(method="POST",url=config.httpBaseUrl+"/videoCategory/create"):(method="PATCH",url=config.httpBaseUrl+"/appRelation/appupdate"),that.$http({url:url,method:method,data:item,withCredentials:!0})},appsService.changeStatu=function(item,scope){var that=appsService,method="",url="",name=that.name;return scope.submitStatus=!0,_.isUndefined(item.id)||(method="PATCH",url=that.httpBaseUrl+"/"+name+"/updatestatus/"+item.id),item=that.changeFromLocalColumns(item),that.$http({url:url,method:method,data:item,withCredentials:!0})},appsService.getAppKey=function(){var that=this,d=$q.defer();return $http({url:that.httpBaseUrl+"/appKey/appkey",method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},appsService.getAppVideo=function(id,pageNumber,params){var that=this,d=that.$q.defer();return params.currentPage=pageNumber,that.$http({url:config.httpBaseUrl+"/appKey/video?appKeyId="+id,method:"GET",params:params,headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},appsService.getAppVod=function(id,pageNumber,params){var that=this,d=that.$q.defer();return params.currentPage=pageNumber,that.$http({url:config.httpBaseUrl+"/appKey/vod?appKeyId="+id,method:"GET",params:params,headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},appsService.getApp_version=function(params){var that=this,d=that.$q.defer();return that.$http({url:that.httpBaseUrl+"/apps/index",method:"GET",params:params,header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/json"},withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},appsService}])}),define("modules/oms/basic/category",["angularAMD","modules/oms/basic/service","Session"],function(angularAMD,BaseCtrl){"use strict";angularAMD.controller("CategoryCtrl",["$scope","BasicsService","Session","$controller","$state","ngDialog",function($scope,BasicsService,Session,$controller,$state,ngDialog){$scope.methods=$state.current.data.methods,$scope.dataConfig={edit:{template:"modules/oms/basic/categoryEdit.html",data:{title:"编辑分类"},controller:"CategoryEditCtrl"},create:{template:"modules/oms/basic/categoryEdit.html",data:{title:"添加分类",item:{}},controller:"CategoryEditCtrl"},live:{template:"modules/oms/apps/appOperation.html",data:{appId:"",title:"设置频道",type:1,name:"category"},controller:"appOperationCtrl"}},$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=BasicsService.setName("category"),"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage),$scope.itemCtrl.operation=function(obj,type){var config;switch(type){case 1:config=$scope.dataConfig.live}config.data.appId=obj.id;var ngdialog=ngDialog.open(config);ngdialog.closePromise.then(function(data){$scope.getResultsPage($scope.currentPage,$scope.searchParams)})}}])}),define("modules/oms/basic/categoryEdit",["angularAMD"],function(angularAMD){"use strict";angularAMD.controller("CategoryEditCtrl",function($scope,BasicsService){var categoryEditCtrl=$scope.categoryEditCtrl={},submitted=!1;$scope.errorMessage="",$scope.title=$scope.ngDialogData.title;var category=$scope.category=$scope.ngDialogData.item;null==category.id&&($scope.ngDialogData.item={}),category.categoryType=2,categoryEditCtrl.checkCloseDialog=function(){$scope.errorMessage="",submitted=!0,BasicsService.saveItem(category,$scope).then(function(data){$scope.submitStatus=!1,$scope.closeThisDialog(data)},function(error){$scope.submitStatus=!1,$scope.errorMessage=error})}})}),define("modules/oms/basic/market",["angularAMD","modules/oms/basic/service","Session"],function(angularAMD,BaseCtrl){"use strict";angularAMD.controller("MarketCtrl",["$scope","BasicsService","Session","$controller","$state",function($scope,BasicsService,Session,$controller,$state){$scope.methods=$state.current.data.methods,$scope.$state=$state,$scope.dataConfig={edit:{template:"modules/oms/basic/marketEdit.html",data:{title:"编辑应用市场"},controller:"MarketEditCtrl"},create:{template:"modules/oms/basic/marketEdit.html",data:{title:"添加应用市场",item:{}},controller:"MarketEditCtrl"}},$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=BasicsService.setName("market"),"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage),$scope.tagTypes={1:"频道标签",2:"栏目标签",3:"节目标签"}}])}),define("modules/oms/basic/marketEdit",["angularAMD","modules/oms/basic/service"],function(angularAMD){"use strict";angularAMD.controller("MarketEditCtrl",function($scope,BasicsService){var marketEditCtrl=$scope.marketEditCtrl={};$scope.submitted=!1,$scope.errorMessage="",$scope.title=$scope.ngDialogData.title;var market=$scope.market=$scope.ngDialogData.item;marketEditCtrl.init=function(){null==market.id&&($scope.ngDialogData.item={})},marketEditCtrl.checkCloseDialog=function(){$scope.errorMessage="",$scope.submitted=!0,BasicsService.isEmptyObject($scope.myform.$error)&&(market=angular.copy($scope.market),BasicsService.saveItem(market,$scope).then(function(data){$scope.closeThisDialog(data),$scope.submitStatus=!1},function(error){$scope.submitStatus=!1,$scope.errorMessage=error}))},marketEditCtrl.init()})}),define("modules/oms/basic/property",["angularAMD","modules/oms/basic/service","Session"],function(angularAMD,BaseCtrl){"use strict";angularAMD.controller("PropertyCtrl",["$scope","BasicsService","Session","$controller","$state","ngDialog",function($scope,BasicsService,Session,$controller,$state,ngDialog){$scope.methods=$state.current.data.methods,$scope.dataConfig={edit:{template:"modules/oms/basic/propertyEdit.html",data:{title:"编辑属性"},controller:"PropertyEditCtrl"},create:{template:"modules/oms/basic/propertyEdit.html",data:{title:"添加属性",item:{userId:Session.id}},controller:"PropertyEditCtrl"}},$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=BasicsService.setName("property"),"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage)}])}),define("modules/oms/basic/propertyEdit",["angularAMD","modules/oms/basic/service"],function(angularAMD){"use strict";angularAMD.controller("PropertyEditCtrl",function($scope,BasicsService){var propertyEditCtrl=$scope.propertyEditCtrl={};$scope.errorMessage="",$scope.title=$scope.ngDialogData.title;var property=$scope.property=$scope.ngDialogData.item;null==property.id&&($scope.ngDialogData.item={}),propertyEditCtrl.init=function(){$scope.options=[{id:1,name:"基础属性"},{id:2,name:"频道属性"},{id:3,name:"栏目属性"}],"undefined"!=typeof $scope.ngDialogData.item.id?$scope.property.propertyType=$scope.options[$scope.property.propertyType-1]:$scope.property.propertyType=$scope.options[0]},propertyEditCtrl.checkCloseDialog=function(){$scope.errorMessage="",$scope.submitted=!0,BasicsService.isEmptyObject($scope.myform.$error)&&($scope.property.propertyType=$scope.property.propertyType.id,BasicsService.saveItem($scope.property,$scope).then(function(data){$scope.submitStatus=!1,$scope.closeThisDialog(data)},function(error){$scope.submitStatus=!1,$scope.errorMessage="code "+error.data.code+":"+error.data.message}))},propertyEditCtrl.init()})}),define("modules/oms/basic/service",["angularAMD","BaseService"],function(angularAMD,BaseService){"use strict";angularAMD.service("BasicsService",["APP_CONFIG","$http","$q",function(config,$http,$q){var mapping={property:{id:"propertyId",propertyName:"propertyName",propertyType:"propertyType",typeName:"typeName"},tag:{id:"tagId",tagName:"tagName",userId:"userId",pid:"tagPid",origin:"tagOrigin",tagType:"tagType",pTag:"pTag"},category:{id:"categoryId",categoryName:"categoryName",userId:"userId",categoryType:"categoryType",createdAt:"createdAt",updatedAt:"updatedAt"},market:{id:"id",marketId:"marketId",name:"marketName",note:"marketNote",createdAt:"createdAt",updatedAt:"updatedAt"}},basicsService=new BaseService(config,$http,$q,mapping);return basicsService.getParentTags=function(){var d=$q.defer();return $http({url:config.httpBaseUrl+"/tag/ptag",method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"
},withCredentials:!0}).then(function(resp){resp.data.rows=basicsService.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},basicsService}])}),define("modules/oms/basic/tag",["angularAMD","modules/oms/basic/service","Session"],function(angularAMD,BaseCtrl){"use strict";angularAMD.controller("TagCtrl",["$scope","BasicsService","Session","$controller","$state",function($scope,BasicsService,Session,$controller,$state){$scope.methods=$state.current.data.methods,$scope.$state=$state,$scope.dataConfig={edit:{template:"modules/oms/basic/tagEdit.html",data:{title:"编辑标签"},controller:"TagEditCtrl"},create:{template:"modules/oms/basic/tagEdit.html",data:{title:"添加标签",item:{}},controller:"TagEditCtrl"}},$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=BasicsService.setName("tag"),"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage),$scope.tagTypes={1:"频道标签",2:"栏目标签",3:"节目标签"}}])}),define("modules/oms/basic/tagEdit",["angularAMD","modules/oms/basic/service"],function(angularAMD){"use strict";angularAMD.controller("TagEditCtrl",function($scope,BasicsService){var tagEditCtrl=$scope.tagEditCtrl={};$scope.submitted=!1,$scope.errorMessage="",$scope.title=$scope.ngDialogData.title;var tag=$scope.tag=$scope.ngDialogData.item;null==tag.id&&($scope.ngDialogData.item={}),tagEditCtrl.init=function(){$scope.options=[{id:1,tagName:"频道标签"},{id:2,tagName:"栏目标签"},{id:3,tagName:"节目标签"}],"undefined"!=typeof $scope.ngDialogData.item.id?$scope.tag.tagType=$scope.options[$scope.tag.tagType-1]:$scope.tag.tagType=$scope.options[0]},tagEditCtrl.checkCloseDialog=function(){$scope.errorMessage="",$scope.submitted=!0,BasicsService.isEmptyObject($scope.myform.$error)&&($scope.tag.tagType=$scope.tag.tagType.id,$scope.tag.pid=$scope.tag.pid.id,"undefined"==typeof $scope.tag.pid&&($scope.tag.pid=0),tag=angular.copy($scope.tag),BasicsService.saveItem(tag,$scope).then(function(data){$scope.closeThisDialog(data),$scope.submitStatus=!1},function(error){$scope.submitStatus=!1,$scope.errorMessage=error}))},tagEditCtrl.getParentTags=function(){BasicsService.getParentTags().then(function(resp){$scope.parentTags=resp.data.data,"undefined"==typeof $scope.tag.id||null==$scope.tag.id||""==$scope.tag.id?$scope.tag.pid=$scope.parentTags[0]:angular.forEach($scope.parentTags,function(obj,i){obj.id==$scope.tag.pid&&($scope.tag.pid=$scope.parentTags[i])})},function(error){})},tagEditCtrl.getParentTags(),$scope.is_first_level_tag=!1,tagEditCtrl.setTagPidValue=function(el){$scope.is_first_level_tag?$scope.is_first_level_tag=!1:($scope.is_first_level_tag=!0,$scope.tag.pid=0)},tagEditCtrl.init()})}),define("modules/oms/client/audioapi",["angularAMD","modules/oms/client/service","Session"],function(angularAMD,BaseCtrl){"use strict";angularAMD.controller("AudioapiCtrl",["$scope","clientService","Session","$controller","$state","ngDialog",function($scope,clientService,Session,$controller,$state,ngDialog){$scope.methods=$state.current.data.methods;var audioapiCtrl=$scope.audioapiCtrl={};$scope.typeStatus={0:"不显示",1:"显示"},audioapiCtrl.update=function(item,status){clientService.updateStatus({id:item.id,status:status,sort:item.sort},$scope).then(function(resp){item.status=resp.data.status,$scope.getResultsPage($scope.currentPage)},function(error){})},audioapiCtrl.ordersNum=function(){var eles=document.getElementsByClassName("sortInput"),list=[];angular.forEach(eles,function(ele,i){list.push({radioId:ele.getAttribute("data-id"),sort:ele.value})}),$scope.itemService.saveOrder(list,$scope).then(function(resp){$scope.getResultsPage($scope.currentPage)},function(error){$scope.errorMessage=code+error.data.code+error.data.message})},$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=clientService.setName("radio"),"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage,$scope.searchParams)}])}),define("modules/oms/client/clientEdit",["angularAMD","modules/oms/client/service","Session"],function(angularAMD){"use strict";angularAMD.controller("clientEditCtrl",["$scope","clientService","$controller","$state","ngDialog","StarsUtils",function($scope,clientService,$controller,$state,ngDialog,StarsUtils){$controller("BaseCtrl",{$scope:$scope}),$scope.objModel=[{},{template:"modules/oms/client/clientOption.html",data:{title:"添加频道",objName:"video",id:"",type:0},controller:"changeCtrl"},{template:"modules/oms/client/clientOption.html",data:{title:"栏目列表",objName:"video",id:"",type:1},controller:"changeCtrl"},{template:"modules/oms/client/clientOption.html",data:{title:"编辑热门搜索",objName:"video",id:"",type:2},controller:"changeCtrl"},{template:"modules/oms/client/clientOption.html",data:{title:"选择应用",objName:"appRelation",id:"",targetId:$scope.tabletId,type:3},controller:"changeCtrl"},{template:"modules/oms/client/clientOption.html",data:{title:"添加热播",objName:"video",id:"",type:0},controller:"changeCtrl"},{template:"modules/oms/client/clientOption.html",data:{title:"添加屏蔽频道",objName:"video",id:"",type:0},controller:"changeCtrl"}],$scope.targetId=$state.params.targetId,$scope.tabletId=$state.params.tabletId,$scope.showStatus=1,$scope.tabClass="btn-warning",$scope.modules=[],$scope.client={tabletId:$scope.tabletId,name:"",delModelId:[],appId:[],data:[]};var clientEditCtrl=$scope.clientEditCtrl={};clientEditCtrl.init=function(){clientService.getClientModels($scope.tabletId).then(function(e){$scope.model=e.data,angular.forEach($scope.model,function(obj){obj.config&&(obj.line=1,5==obj.id&&(obj.line=2),2==obj.id&&(obj.episode=1)),obj.modelId=angular.copy(obj.id),delete obj.id,obj.data={text:"",ids:[],attr:[]}}),$scope.model2=angular.copy($scope.model),-1!=$scope.targetId&&clientEditCtrl.editInit()})},clientEditCtrl.init(),clientEditCtrl.hideVideo=function(dialogIndex,i){var idArry=[],blockArry=[];if(_.isArray($scope.modules[i].data.block))angular.forEach($scope.modules[i].data.block,function(obj){idArry.push(obj.id)});else for(var j in $scope.modules[i].data.block)idArry.push(parseInt(j));0!==idArry.length&&(angular.forEach($scope.modules[i].data.block,function(blockObj,ind){blockObj.videoId?blockArry.push({id:blockObj.videoId,time:blockObj.time,videoName:blockObj.videoName}):blockArry.push({id:blockObj.id,time:blockObj.time,videoName:blockObj.videoName})}),$scope.modules[i].data.block=blockArry),$scope.objModel[dialogIndex].data.id=idArry;var ngdialog=ngDialog.open($scope.objModel[6]);ngdialog.closePromise.then(function(data){0!=data.value&&"$closeButton"!=data.value&&angular.forEach(data.value,function(blockObj,ind){-1==idArry.indexOf(blockObj.id)&&0!==idArry.length?$scope.modules[i].data.block.push({id:blockObj.id,time:!1,videoName:blockObj.name}):0==idArry.length&&(blockArry.push({id:blockObj.id,time:!1,videoName:blockObj.name}),$scope.modules[i].data.block=blockArry)})})},clientEditCtrl.editInit=function(){$scope.client.id=$scope.targetId,clientService.editData($scope.targetId).then(function(data){var e=data.data;angular.forEach(e.data,function(da){if(5==da.modelId)for(var m in da.data.block)m?$scope.typeShowList=1:$scope.typeShowList=0}),$scope.client={id:e.targetId,tabletId:$scope.tabletId,name:e.targetName,appId:[],appNames:[],delModelId:[],data:[]},angular.forEach(e.appList,function(app,i){$scope.client.appNames.push(app.appKeyName+" "+app.appsAppOs+" "+app.appsAppVersion),$scope.client.appId.push(app.appId)}),$scope.apps={appid:angular.copy($scope.client.appId),appName:$scope.client.appNames},$scope.dates=[],angular.forEach(e.data,function(obj,i){obj.data.attr=[];for(var key in obj.data.ids){var channelObj=obj.data.ids[key];obj.data.attr[obj.data.ids[key].sort]={modelId:key,name:obj.data.ids[key].videoName,imgUrl:obj.data.ids[key].videoImage,sortVideo:obj.data.ids[key].sort+1,intro:obj.data.ids[key].intro,recomm:obj.data.ids[key].recomm,times:obj.data.ids[key].time},$scope.dates.push({intro:channelObj.intro,recomm:channelObj.recomm})}obj.name=$scope.model[obj.modelId].name,$scope.modules.push(obj),obj.data.ids=[]})})},clientEditCtrl.rmSearchOption=function(module,index){$scope.modules[$scope.modules.indexOf(module)].data.ids.splice(index,1),$scope.modules[$scope.modules.indexOf(module)].data.attr.splice(index,1)},clientEditCtrl.delBlockOption=function(module,index){var blockTime=[],block_Time=[];for(var i in $scope.modules[$scope.modules.indexOf(module)].data.block)blockTime.push($scope.modules[$scope.modules.indexOf(module)].data.block[i]);blockTime.splice(index,1),angular.forEach(blockTime,function(e){e.videoId?block_Time.push({id:e.videoId,time:e.time,videoName:e.videoName}):block_Time.push({id:e.id,time:e.time,videoName:e.videoName})}),$scope.modules[$scope.modules.indexOf(module)].data.block=block_Time},$scope.sortFlag=!1,clientEditCtrl.pressKeySort=function(e,item,mode){var target=angular.element(e.target);!target.val(),angular.forEach($scope.modules,function(objS,i){if($scope.modules.indexOf(mode)==i){if(item.sortFlag=!0,13!=e.which)return;$scope.modules[i].data.attr=angular.copy(objS.data.attr);var arr=$scope.modules[i].data.attr;_.remove(arr,function(channel){return channel.modelId==item.modelId}),_.sortBy(arr,"sortVideo");var sorted_arr=[];_.each(arr,function(ch,i){i+1==target.val()&&sorted_arr.push(item),sorted_arr.push(ch)}),_.includes(sorted_arr,item)||sorted_arr.push(item),_.each(sorted_arr,function(c,j){c.sortVideo=j+1}),$scope.modules[i].data.attr=sorted_arr,item.sortFlag=!1}})},clientEditCtrl.changeTab=function(status){$scope.showStatus=status},clientEditCtrl.setVideoTime=function(module,index,num){$scope.module=module;var objSetTim=[{template:"modules/oms/client/clientSetTime.html",data:{title:"频道定时",id:1,dataTime:$scope.modules,index:index,module:$scope.module},controller:"changeTimeCtrl"},{template:"modules/oms/client/clientSetTime.html",data:{title:"栏目定时",dataTime:$scope.modules,id:2,index:index,module:$scope.module},controller:"changeTimeCtrl"},{template:"modules/oms/client/clientSetTime.html",data:{title:"热播定时",dataTime:$scope.modules,id:5,index:index,module:$scope.module},controller:"changeTimeCtrl"},{template:"modules/oms/client/clientSetTime.html",data:{title:"屏蔽频道定时",dataTime:$scope.modules,id:5,index:index,flag:0,module:$scope.module},controller:"changeTimeCtrl"}],ngdialog3=ngDialog.open(objSetTim[num]);ngdialog3.closePromise.then(function(data){0==data.value.length&&(3===num?$scope.modules[$scope.modules.indexOf(module)].data.block[index].time=!1:$scope.modules[$scope.modules.indexOf(module)].data.attr[index].times=!1),0!=data.value&&angular.forEach($scope.modules,function(obj){var t=0;if(obj.modelId==data.value[0].id){var m=$scope.modules[$scope.modules.indexOf(module)].data;if(angular.forEach(data.value,function(showObj){isNaN(showObj.end)&&isNaN(showObj.start)&&(t+=1)}),3!==num)t==data.value.length?m.attr[index].times=!1:m.attr[index].times=angular.copy(data.value);else{t==data.value.length?m.block[index].time=!1:(m.block[index].time=angular.copy(data.value),angular.forEach(m.block[index].time,function(e){delete e.id}));for(var i in m.block)m.block[i].videoId&&(m.block[i]={id:m.block[i].videoId,time:m.block[i].time,videoName:m.block[i].videoName})}}})},function(error){})},$scope.modelAdd=function(index){$scope.modules.push(angular.copy($scope.model2[index]))},$scope.removeModule=function(index,item){return"undefined"==typeof item.targetDataId||""==item.targetDataId?void $scope.modules.splice(index,1):($scope.client.delModelId.push(item.targetDataId),void $scope.modules.splice(index,1))};clientEditCtrl.save=function(){if($scope.submitted=!0,clientService.isEmptyObject($scope.myform.$error)){if(0==$scope.modules.length)return void StarsUtils.alert("保存失败，请输入数据！");if("undefined"==typeof $scope.client.name||""==$scope.client.name)return void alert("名称不能为空");for(var i=0,m=0;m=$scope.modules.length,m>i;i++){if(0==$scope.modules[i].data.attr.length&&4!==$scope.modules[i].modelId&&5!==$scope.modules[i].modelId||4==$scope.modules[i].modelId&&""==$scope.modules[i].data.text)return $scope.submitted=!1,void StarsUtils.alert("保存失败，存在空数据，请重新编辑！");if(5==$scope.modules[i].modelId&&("number"!=typeof $scope.modules[i].data.count||$scope.modules[i].data.count<$scope.modules[i].data.attr.length||$scope.modules[i].data.count==$scope.modules[i].data.attr.length))return void($scope.submitted=!1)}if(!$scope.submitted)return void($scope.submitted=!0);angular.forEach($scope.modules,function(obj,i){obj.sort=i+1;var tmp=[];obj.data.ids=[],1==obj.modelId||2==obj.modelId||5==obj.modelId?(angular.forEach(obj.data.attr,function(attr,a){if(attr.times){for(var i in attr.times)delete attr.times[i].id;obj.data.ids.push({id:angular.copy(attr.modelId),time:angular.copy(attr.times)})}else obj.data.ids.push({id:angular.copy(attr.modelId),time:!1})}),"2"==obj.modelId&&1==obj.episode&&delete obj.isNumber):3==obj.modelId?angular.forEach(obj.data.attr,function(attr,a){obj.data.ids.push(angular.copy(attr.modelId))}):4==obj.modelId&&(obj.data={text:obj.data.text}),5==obj.modelId&&(angular.forEach(obj.data.block,function(da,d){da.videoName&&delete da.videoName}),obj.data.block instanceof Array||(angular.forEach(obj.data.block,function(da,d){tmp.push({id:da.videoId,time:da.time})}),obj.data.block=tmp))}),$scope.client.data=angular.copy($scope.modules),$scope.itemService=clientService.setName("target"),"-1"==$scope.client.id&&delete $scope.client.id,clientService.saveItem(angular.copy($scope.client),$scope).then(function(data){alert("保存模版成功"),$scope.itemCtrl.back()},function(error){alert(error.data.message),$scope.submitStatus=!1,$scope.errorMessage="code "+error.data.code+":"+error.data.message})}},$scope.route(),clientEditCtrl.getApp=function(index){$scope.objModel[index].data.id=$scope.client.appId;var ngdialog=ngDialog.open($scope.objModel[index]);ngdialog.closePromise.then(function(data){"undefined"!=typeof data.value&&"$document"!=data.value&&"$closeButton"!=data.value&&0!=data.value&&($scope.client.appNames=[],$scope.client.appId=[],"undefined"!=typeof $scope.apps&&($scope.client.appId=angular.copy($scope.apps.appid),$scope.client.appNames=angular.copy($scope.apps.appName)),angular.forEach(data.value,function(e,vl){"undefined"!=typeof e.version&&($scope.client.appId.push(e.id),$scope.client.appNames.push(e.appKeyName+" "+e.name+e.version))}))})},clientEditCtrl.changeItem=function(dialogIndex,moduleIndex){var idArry=[];angular.forEach($scope.modules[moduleIndex].data.attr,function(obj){idArry.push(parseInt(obj.modelId))}),$scope.objModel[dialogIndex].data.id=idArry;var ngdialog=ngDialog.open($scope.objModel[dialogIndex]);ngdialog.closePromise.then(function(data){if("$document"!=data.value&&"$closeButton"!=data.value&&0!=data.value){data.value.map(function(a){"undefined"==typeof a.name&&data.value.splice(data.value.indexOf(a),1)});var ids=[],appSource=angular.copy($scope.modules[moduleIndex].data.attr),arryId=[];angular.forEach($scope.modules[moduleIndex].data.attr,function(obj,i){ids[i]=parseInt(obj.modelId)});for(var key in data.value){var word=data.value[key];if(ids.indexOf(word.id)>-1);else{var appObj=data.value[key];arryId.push(key);var obj={modelId:appObj.id,name:appObj.name,imgUrl:appObj.imgUrl,intro:appObj.intro,recomm:appObj.recomm,sortVideo:0};appSource.unshift(obj)}}$scope.modules[moduleIndex].data.arry=angular.copy(arryId),$scope.modules[moduleIndex].data.attr=angular.copy(appSource)}})},$scope.$watch("modules",function(value){},!0)}]),angularAMD.directive("dndList",function($parse){return function(scope,element,attrs){var toUpdate,startIndex=-1;scope.$watch(attrs.dndList,function(value){toUpdate=value},!0),$(element[0]).sortable({items:"li",start:function(event,ui){startIndex=$(ui.item).index()},stop:function(event,ui){var newIndex=$(ui.item).index(),toMove=toUpdate[startIndex];toUpdate.splice(startIndex,1),toUpdate.splice(newIndex,0,toMove),scope.$apply(attrs.dndList)},axis:"y"})}}),angularAMD.directive("dndBetweenList",function($parse){return function(scope,element,attrs){var toUpdate,target,args=attrs.dndBetweenList.split(","),targetArgs=$("#"+args[1]).attr("dnd-between-list").split(","),startIndex=-1;scope.$watch(args[0],function(value){toUpdate=value},!0),scope.$watch(targetArgs[0],function(value){target=value},!0),$(element[0]).sortable({items:"li",start:function(event,ui){startIndex=$(ui.item).index()},stop:function(event,ui){var newParent=ui.item[0].parentNode.id,newIndex=$(ui.item).index(),toMove=toUpdate[startIndex];toUpdate.splice(startIndex,1),newParent==args[1]?target.splice(newIndex,0,toMove):toUpdate.splice(newIndex,0,toMove),scope.$apply(targetArgs[0]),scope.$apply(args[0])},connectWith:"#"+args[1]})}}),angularAMD.directive("divList",function($parse){return function(scope,element,attrs){var toUpdate,startIndex=-1;scope.$watch(attrs.dndList,function(value){toUpdate=value},!0),$(element[0]).sortable({items:"div",start:function(event,ui){startIndex=$(ui.item).index()},stop:function(event,ui){var newIndex=$(ui.item).index(),toMove=toUpdate[startIndex];toUpdate.splice(startIndex,1),toUpdate.splice(newIndex,0,toMove),scope.$apply(attrs.dndList)},axis:"y"})}}),angularAMD.directive("divBetweenList",function($parse){return function(scope,element,attrs){var toUpdate,target,args=attrs.dndBetweenList.split(","),targetArgs=$("#"+args[1]).attr("dnd-between-list").split(","),startIndex=-1;scope.$watch(args[0],function(value){toUpdate=value},!0),scope.$watch(targetArgs[0],function(value){target=value},!0),$(element[0]).sortable({items:"div",start:function(event,ui){startIndex=$(ui.item).index()},stop:function(event,ui){var newParent=ui.item[0].parentNode.id,newIndex=$(ui.item).index(),toMove=toUpdate[startIndex];toUpdate.splice(startIndex,1),newParent==args[1]?target.splice(newIndex,0,toMove):toUpdate.splice(newIndex,0,toMove),scope.$apply(targetArgs[0]),scope.$apply(args[0])},connectWith:"#"+args[1]})}})}),define("modules/oms/client/clientManage",["angularAMD","modules/oms/client/service","Session"],function(angularAMD){"use strict";angularAMD.controller("clientCtrl",["$scope","clientService","$controller","$state","ngDialog",function($scope,clientService,$controller,$state,ngDialog){$scope.methods=$state.current.data.methods,$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=clientService.setName("tablet");var clientCtrl=$scope.clientCtrl={};clientCtrl.edit=function(item,status){clientService.saveItem({id:item.id,status:status},$scope).then(function(e){$scope.submitStatus=!1,item.status=status,$scope.itemCtrl.search()},function(e){alert(e),$scope.submitStatus=!1})},clientCtrl.changeItem=function(obj){sessionStorage.setItem("changeIndex",obj.id),$scope.titleName=obj.tabName,$scope.nameIndex=obj.tabApi,$scope.itemService=clientService.setName("target"),$scope.searchParams.tabletId=obj.id,$scope.items={}},clientCtrl.modelShow=function(obj){ngDialog.open({template:"modules/oms/client/template.html",data:{title:"预览模版",id:obj.id,name:obj.name,tabletId:$scope.searchParams.tabletId,nameIndex:$scope.nameIndex,type:3},controller:"templateCtrl"})},clientCtrl.changeCk=function(obj){obj.selectAll?$scope.selectAll=!0:$scope.selectAll=!1},clientCtrl.init=function(){$scope.selectAll=!1,clientService.targetTab($scope.currentPage).then(function(e){if($scope.tabItem=e.data.rows,$scope.tabItem.length>0){var changeIndex=sessionStorage.getItem("changeIndex");changeIndex&&"null"!=changeIndex?angular.forEach($scope.tabItem,function(obj,i){obj.id==changeIndex&&(clientCtrl.changeItem($scope.tabItem[i]),$scope.searchParams.tabletId=$scope.tabItem[i].id)}):(clientCtrl.changeItem($scope.tabItem[0]),$scope.searchParams.tabletId=$scope.tabItem[0].id)}},function(error){})},"undefined"!=typeof $scope.methods.index.name&&clientCtrl.init()}]),angularAMD.directive("ckStatus",function(){return{restrict:"A",require:"?ngModel",link:function(scope,el,attrs,ctrl){function status(){angular.element(el).parent().find("a").removeClass("btn-warning"),scope.searchParams.status=el.attr("name"),el.addClass("btn-warning"),scope.itemCtrl.search()}el.on("click",function(){scope.$apply(status)})}}}),angularAMD.directive("rmTitle",function(){return{restrict:"A",require:"?ngModel",link:function(scope,el,attrs,ctrl){function clear(){angular.element(el).parent().parent().find("div.title-div").children().removeClass("btn-warning")}el.on("click",function(){scope.$apply(clear)})}}})}),define("modules/oms/client/clientOption",["angularAMD","modules/oms/client/service","Session"],function(angularAMD){"use strict";angularAMD.controller("changeCtrl",["$scope","clientService","Session","$controller","$state","ngDialog",function($scope,clientService,Session,$controller,$state,ngDialog){$scope.methods=$state.current.data.methods,$controller("BaseCtrl",{$scope:$scope}),$scope.typeOption=[{id:1,name:"栏目"},{id:0,name:"直播"}],$scope.rItem=[],$scope.select="",$scope.idOptions=$scope.ngDialogData.id,$scope.title=$scope.ngDialogData.title,$scope.type=$scope.ngDialogData.type,$scope.changeType="1";var changeCtrl=$scope.changeCtrl={};changeCtrl.showSelect=function(){""==$scope.select?$scope.select="open":$scope.select=""},$scope.ckOption=function(obj){$scope.optionType=obj.name,$scope.changeType=obj.id,$scope.typeStatus=obj.id,clientService.getResultsPage(1,$scope.searchParams,obj.id).then(function(data){$scope.loading_list=!1,$scope.items=data.data.rows,$scope.totalItems=data.data.totalResults},function(error){})},changeCtrl.search=function(){clientService.getResultsPage(1,$scope.searchParams,$scope.changeType).then(function(data){$scope.loading_list=!1,$scope.items=data.data.rows,$scope.totalItems=data.data.totalResults},function(error){})},changeCtrl.getSearch=function(){clientService.getResultsPage(1,$scope.searchParams,$scope.typeStatus).then(function(data){$scope.loading_list=!1,$scope.items=data.data.rows,$scope.totalItems=data.data.totalResults},function(error){})},$scope.ckMore=function(obj,ckbox){ckbox.option?$scope.rItem[obj.id]=obj:$scope.rItem.splice($scope.rItem.indexOf($scope.rItem[obj.id]),1)},$scope.init=function(){$scope.initId=angular.copy($scope.idOptions),angular.forEach($scope.initId,function(app){$scope.rItem[app]=app}),$scope.itemService=clientService.setName($scope.ngDialogData.objName),$scope.searchParams.isAll=!0,"videoEpg"==$scope.ngDialogData.objName?clientService.getEpgItem(1,null).then(function(data){$scope.loading_list=!1,$scope.items=data.data.rows,$scope.totalItems=data.data.totalResults}):"appRelation"==$scope.ngDialogData.objName?($scope.getResultsPage=function(pageNumber,params){$scope.appFun(pageNumber,params)},$scope.getResultsPage($scope.currentPage)):(2==$scope.type&&($scope.optionType=$scope.typeOption[0].name),$scope.getResultsPage($scope.currentPage,$scope.type))},$scope.typeStatus="",$scope.getResultsPage=function(page,type){0!=type&&1!=type&&2!=type?type=$scope.typeStatus:$scope.typeStatus=type,clientService.getResultsPage(page,$scope.searchParams,type).then(function(data){$scope.loading_list=!1,$scope.items=data.data.rows,$scope.totalItems=data.data.totalResults},function(error){})},$scope.appFun=function(pageNumber,params){$scope.currentPage=pageNumber,$scope.items=[],$scope.loading_list=!0,$scope.searchParams.tabletId=$state.params.tabletId,clientService.getAppRelaction($scope.currentPage,$scope.searchParams).then(function(data){$scope.loading_list=!1,$scope.items=data.data.rows,$scope.totalItems=data.data.totalResults},function(error){$scope.loading_list=!1,$scope.search_error_msg="code "+error.data.code+":"+error.data.message,$scope.search_error=!0})},changeCtrl.ckAll=function(obj){obj.selectAll?angular.forEach($scope.items,function(obj){$scope.rItem.push(obj)}):($scope.rItem=[],$scope.idOptions=[])},$scope.$watch("items",function(){"undefined"!=typeof $scope.idOptions&&angular.forEach($scope.items,function(e,v){"undefined"!=typeof e.id&&$scope.idOptions.length>0&&$scope.idOptions.indexOf(e.id)>-1&&($scope.rItem[e.id]=e)})}),$scope.init()}])}),define("modules/oms/client/clientSetTime",["angularAMD","Session"],function(angularAMD,BaseCtrl){"use strict";angularAMD.controller("changeTimeCtrl",["$scope","clientService","Session","$controller","$state","ngDialog",function($scope,clientService,Session,$controller,$state,ngDialog){$scope.methods=$state.current.data.methods,$controller("BaseCtrl",{$scope:$scope}),$scope.title=$scope.ngDialogData.title,$scope.modelId=$scope.ngDialogData.id,$scope.index=$scope.ngDialogData.index,$scope.flag=$scope.ngDialogData.flag,$scope.module=$scope.ngDialogData.module,$scope.vods=[],angular.forEach($scope.ngDialogData.dataTime,function(obj,i){obj.modelId==$scope.modelId&&$scope.ngDialogData.dataTime.indexOf($scope.module)==i&&"undefined"==typeof $scope.flag&&((0==obj.data.attr[$scope.index].times||"undefined"==typeof obj.data.attr[$scope.index].times)&&($scope.vods=[{dates:"",startTime:"",endTime:""}]),angular.forEach(obj.data.attr[$scope.index].times,function(data){var test={};test.endTime=1e3*data.end,test.startTime=1e3*data.start,test.dates=1e3*data.start,$scope.vods.push(test)}));var blockList=[];if(obj.modelId==$scope.modelId&&$scope.ngDialogData.dataTime.indexOf($scope.module)==i&&0===$scope.flag){for(var i in obj.data.block){for(var b in obj.data.block[i].time);blockList.push(obj.data.block[i])}obj.data.block=blockList,(0==obj.data.block[$scope.index].time||"undefined"==typeof obj.data.block[$scope.index].time)&&($scope.vods=[{dates:"",startTime:"",endTime:""}]),angular.forEach(obj.data.block[$scope.index].time,function(data){var test={};test.endTime=1e3*data.end,test.startTime=1e3*data.start,test.dates=1e3*data.start,$scope.vods.push(test)})}});var changeCtrl=$scope.changeCtrl={};Date.prototype.Format=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};/(y+)/.test(fmt)&&(fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var k in o)new RegExp("("+k+")").test(fmt)&&(fmt=fmt.replace(RegExp.$1,1==RegExp.$1.length?o[k]:("00"+o[k]).substr((""+o[k]).length)));return fmt},changeCtrl.checkCloseDialog=function(item){$scope.submitted=!0,angular.forEach(item,function(obj,j){(isNaN(obj.dates)||isNaN(obj.endTime)||isNaN(obj.startTime)||""==obj.dates||""==obj.endTime||""==obj.startTime)&&item.splice(j,1);var d=new Date,ds=new Date(obj.dates),sd=new Date(obj.startTime),ed=new Date(obj.endTime);d.setUTCFullYear(ds.getFullYear()),d.setUTCMonth(ds.getUTCMonth()),sd.getUTCHours()<24&&17<=sd.getUTCHours()?d.setUTCDate(parseInt(new Date(obj.dates).Format("dd"))-1):d.setUTCDate(parseInt(new Date(obj.dates).Format("dd"))),d.setUTCHours(ed.getUTCHours()),d.setUTCMinutes(ed.getUTCMinutes());var npmD;sd.getUTCHours()<24&&17<=sd.getUTCHours()&&ed.getUTCHours()<=16&&0<=ed.getUTCHours()?(npmD=angular.copy(d),npmD.setDate(npmD.getDate()+1)):(d.setUTCMonth(ds.getMonth()),npmD=angular.copy(d)),obj.end=Date.parse(npmD)/1e3,d.setUTCHours(sd.getUTCHours()),d.setUTCMinutes(sd.getUTCMinutes()),obj.start=Date.parse(angular.copy(d))/1e3,delete obj.dates,delete obj.endTime,delete obj.startTime,obj.id=$scope.modelId}),$scope.closeThisDialog(item)},changeCtrl.addTime=function(){var addVod={dates:"",startTime:"",endTime:""};$scope.vods.length<10&&$scope.vods.push(addVod)},changeCtrl.deleteTime=function(index){$scope.vods.splice(index,1)}}])}),define("modules/oms/client/clientVersion",["angularAMD","modules/oms/client/service","Session"],function(angularAMD){"use strict";angularAMD.controller("versionCtrl",["$scope","clientService","$controller","$state","ngDialog",function($scope,clientService,$controller,$state,ngDialog){$scope.methods=$state.current.data.methods,$controller("BaseCtrl",{$scope:$scope}),$scope.type=$state.params.type,$scope.clientId=$state.params.clientId,$scope.tabletId=$state.params.tabletId,$scope.nameIndex=$state.params.nameIndex,$scope.toId=null,$scope.fromApp=[],$scope.leftApp,$scope.fromModules,$scope.toApp,$scope.rightApp,$scope.dialogConfig=[{template:"modules/oms/client/versionOption.html",data:{title:"选择应用",objName:"appRelation",targetId:$scope.clientId,tabletId:$scope.tabletId,appIds:[],type:0},controller:"versionAppCtrl"},{template:"modules/oms/client/versionOption.html",data:{title:"选择模版",objName:"target",targetId:$scope.clientId,tabletId:$scope.tabletId,type:1},controller:"versionAppCtrl"}];var versionCtrl=$scope.versionCtrl={};$scope.modelDemo={appKey:"WnJY48akhyvc",appOs:"",appVer:""},versionCtrl.getModelList=function(){clientService.getClientModels(0).then(function(e){$scope.model=e.data,angular.forEach($scope.model,function(obj){obj.config&&(obj.line=1,5==obj.id&&(obj.line=2),2==obj.id&&(obj.episode=1)),obj.modelId=angular.copy(obj.id),delete obj.id,obj.data={text:"",ids:[],attr:[]}})})},versionCtrl.changeVersion=function(){var ngdialog=ngDialog.open($scope.dialogConfig[0]);ngdialog.closePromise.then(function(data){"undefined"!=typeof data.value&&"$document"!=data.value&&"$closeButton"!=data.value&&0!=data.value&&angular.forEach(data.value,function(obj,i){var idPush=!1;if(angular.forEach($scope.fromApp,function(app){app.appId==obj.id&&(idPush=!0)}),!idPush){var newObj={appId:obj.id,appKeyName:obj.appKeyName,appsAppOs:obj.name,appsAppVersion:obj.version};$scope.fromApp.push(newObj)}})})},versionCtrl.ckFrom=function(obj,index){$scope.fromAppCk.indexOf(obj)<0?($scope.fromAppCk.push(obj),$scope.modelDemo.appOs=obj.name,$scope.modelDemo.appVer=obj.version):$scope.fromAppCk.splice($scope.fromAppCk.indexOf(obj),1)},versionCtrl.toCk=function(obj,index){$scope.toAppCk.indexOf(obj)<0?($scope.toAppCk.push(obj),$scope.modelDemo.appOs=obj.name,$scope.modelDemo.appVer=obj.version):$scope.toAppCk.splice($scope.toAppCk.indexOf(obj),1)},versionCtrl.removeByFrom=function(){return 0==$scope.fromApp.length?($scope.fromModules=[],$scope.leftApp=null,void($scope.fromData.fromTitle=angular.copy($scope.fromData.title))):($scope.toApp.push(angular.copy($scope.leftApp)),$scope.fromApp.splice($scope.fromApp.indexOf($scope.leftApp),1),$scope.fromApp.length>0?(versionCtrl.getLeftModel($scope.fromApp[0]),void(1==$scope.toApp.length&&$scope.getRightModel($scope.toApp[0]))):($scope.fromModules=[],$scope.leftApp=null,void($scope.fromData.fromTitle=angular.copy($scope.fromData.title))))},versionCtrl.removeByTo=function(){return 0==$scope.toApp.length?($scope.toModules=[],$scope.rightApp=null,void($scope.toData.toTitle=angular.copy($scope.toData.title))):($scope.fromApp.push(angular.copy($scope.rightApp)),$scope.toApp.splice($scope.toApp.indexOf($scope.rightApp),1),$scope.toApp.length>0?($scope.getRightModel($scope.toApp[0]),void(1==$scope.fromApp.length&&versionCtrl.getLeftModel($scope.fromApp[0]))):($scope.toModules=[],$scope.rightApp=null,void($scope.toData.toTitle=angular.copy($scope.toData.title))))},versionCtrl.changeModel=function(){var ngdialog=ngDialog.open($scope.dialogConfig[1]);ngdialog.closePromise.then(function(data){"$document"!=data.value&&"$closeButton"!=data.value&&0!=data.value.length&&($scope.toId=data.value[0].id,$scope.toApp=[],$scope.toModules=new Object,$scope.toData=new Object,clientService.versionByTarget(data.value[0].id).then(function(e){$scope.toApp=e.data.data.rows,$scope.toApp.length>0?$scope.getRightModel($scope.toApp[0]):$scope.getRightModel()},function(error){}))})},versionCtrl.save=function(){var firstApp=[];angular.forEach($scope.fromApp,function(obj){firstApp.push(obj.appId)});var secondApp=[];angular.forEach($scope.toApp,function(obj){secondApp.push(obj.appId)}),0==firstApp.length&&(firstApp=-1),0==secondApp.length&&(secondApp=-1);var json={arr:[{refId:$scope.clientId,appId:firstApp}]};null!=$scope.toId&&json.arr.push({refId:$scope.toId,appId:secondApp}),$scope.submitStatus=!0,clientService.versionEach(json).then(function(e){alert("保存成功"),$scope.itemCtrl.back()},function(error){$scope.submitStatus=!1})},$scope.init=function(){$scope.route(),versionCtrl.getModelList(),versionCtrl.leftVersion(),$scope.itemService=clientService.setName("apps")},versionCtrl.leftVersion=function(){clientService.versionByTarget($scope.clientId).then(function(e){$scope.fromApp=e.data.data.rows,$scope.fromApp.length>0?versionCtrl.getLeftModel($scope.fromApp[0]):versionCtrl.getLeftModel();
},function(error){})},versionCtrl.getLeftModel=function(appObj){$scope.leftApp=appObj;var leftAppId;leftAppId="undefined"==typeof appObj||null==appObj?0:appObj.appId,clientService.getModelData($scope.nameIndex,$scope.clientId,leftAppId).then(function(e){$scope.fromData=angular.copy(e.data),$scope.fromModules=[],angular.forEach($scope.fromData.datas,function(dataObj,i){if(1==dataObj.type||2==dataObj.type)$scope.modelTemplate=angular.copy($scope.model[dataObj.type]),2==dataObj.type&&2==dataObj.config.episode.option&&($scope.modelTemplate.episode=dataObj.config.episode.option,$scope.modelTemplate.isNumber=dataObj.config.isNumber.option),$scope.fromModules.push($scope.modelTemplate),$scope.fromModules[i].data.text=dataObj.headerTitle,$scope.fromModules[i].line=dataObj.config.line.option,angular.forEach(dataObj.data,function(child,a){$scope.fromModules[i].data.attr.push({imgUrl:child.videoImage,videoName:child.videoName})});else{if($scope.fromModules.push(angular.copy($scope.model[dataObj.type])),$scope.fromModules[i].data.text=dataObj.headerTitle,5==$scope.fromModules[i].modelId)return $scope.fromModules[i].data.headerCount=dataObj.headerCount,$scope.fromModules[i].data.attr.length=parseInt($scope.fromModules[i].data.headerCount),void angular.forEach(dataObj.data,function(child,a){a>=parseInt($scope.fromModules[i].data.headerCount)||($scope.fromModules[i].data.attr[a]={imgUrl:child.videoImage,videoName:child.videoName})});angular.forEach(dataObj.data,function(child,a){$scope.fromModules[i].data.attr.push({imgUrl:child.videoImage,videoName:child.videoName})})}})},function(error){})},$scope.getRightModel=function(appObj){$scope.toModules=[],$scope.rightApp=appObj;var rightAppId;rightAppId="undefined"==typeof appObj||null==appObj?0:appObj.appId,clientService.getModelData($scope.nameIndex,$scope.toId,rightAppId).then(function(e){$scope.toData=angular.copy(e.data),angular.forEach($scope.toData.datas,function(dataObj,i){if(1==dataObj.type||2==dataObj.type)$scope.modelTemplate=angular.copy($scope.model[dataObj.type]),2==dataObj.type&&2==dataObj.config.episode.option&&($scope.modelTemplate.episode=dataObj.config.episode.option,$scope.modelTemplate.isNumber=dataObj.config.isNumber.option),$scope.toModules.push($scope.modelTemplate),$scope.toModules[i].data.text=dataObj.headerTitle,$scope.toModules[i].line=dataObj.config.line.option,angular.forEach(dataObj.data,function(child,a){$scope.toModules[i].data.attr.push({imgUrl:child.videoImage,videoName:child.videoName})});else{if($scope.toModules.push(angular.copy($scope.model[dataObj.type])),$scope.toModules[i].data.text=dataObj.headerTitle,5==$scope.toModules[i].modelId)return $scope.toModules[i].data.headerCount=dataObj.headerCount,$scope.toModules[i].data.attr.length=parseInt($scope.toModules[i].data.headerCount),void angular.forEach(dataObj.data,function(child,a){a>=parseInt($scope.toModules[i].data.headerCount)||($scope.toModules[i].data.attr[a]={imgUrl:child.videoImage,videoName:child.videoName})});angular.forEach(dataObj.data,function(child,a){$scope.toModules[i].data.attr.push({imgUrl:child.videoImage,videoName:child.videoName})})}})},function(error){})},$scope.init()}])}),define("modules/oms/client/service",["angularAMD","BaseService"],function(angularAMD,BaseService){"use strict";angularAMD.service("clientService",["APP_CONFIG","$http","$q",function(config,$http,$q,$scope){var mapping={client:{id:"videoId",name:"videoName"},tablet:{id:"tabletId",modelId:"modelId",tabName:"tabletName",tabApi:"apiName",weight:"tabletSort",tabletStatus:"tabletStatus",tabletLock:"tabletLock",createdAt:"createdAt",updatedAt:"updatedAt",userId:"userId",userName:"userName",tabType:"tabletType",appId:"appId"},target:{id:"targetId",tabletId:"tabletId",name:"targetName",userName:"userName",appId:"appId",data:"data",delModelId:"delModelId",userId:"userId",status:"status",createdAt:"createdAt",updatedAt:"updatedAt"},video:{id:"videoId",name:"videoName",videoType:"videoType",imgUrl:"videoImage",status:"videoStatus",intro:"intro",recomm:"recomm",videoCategory:"videoCategory"},apps:{id:"appsId",version:"appsAppVersion",name:"appsAppOs",appKeyName:"appKeyName"},appRelation:{appRelationId:"appRelationId",refId:"refId",id:"appId",userId:"userId",type:"type",targetId:"targetId",version:"appsAppVersion",name:"appsAppOs",noAppId:"noAppId",appKeyName:"appKeyName"},radio:{id:"id",videoId:"videoId",videoName:"videoName",sort:"sort",status:"status",createdAt:"createdAt",updatedAt:"updatedAt"},customApi:{id:"customApiId",name:"customName",apiName:"customApiName",status:"customStatus",createdAt:"createdAt",updatedAt:"updatedAt",userId:"userId",userName:"userName",appId:"appId",customValue:"customValue",areaId:"areaId",isAll:"isAll"}},clientService=new BaseService(config,$http,$q,mapping);return clientService.editData=function(id){var that=this,d=that.$q.defer();return that.$http({url:that.httpBaseUrl+"/target/show/"+id,method:"GET",header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},clientService.getAppRelaction=function(pageNumber,params,tabletId){var that=this,d=that.$q.defer();return("undefined"==typeof tabletId||null==tabletId)&&(tabletId=angular.copy(params.tabletId)),params=params?that.changeFromLocalColumns(params):{},params.currentPage=pageNumber,that.$http({url:that.httpBaseUrl+"/apps/targetappindex?tabletId="+tabletId,method:"GET",params:params,withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},clientService.appByTarget=function(pageNumber,params){var that=this,d=that.$q.defer();return params=params?that.changeFromLocalColumns(params):{},params.currentPage=pageNumber,that.$http({url:that.httpBaseUrl+"/apps/targetappindex",method:"GET",params:params,withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},clientService.getModelData=function(url,targetId,appId){var URL,that=this,d=that.$q.defer();return URL="undefined"==typeof appId||null==appId?that.httpBaseUrl+"/preview/"+url+"/"+targetId:that.httpBaseUrl+"/preview/"+url+"/"+targetId+"/"+appId,that.$http({url:URL,method:"GET",withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},clientService.saveShow=function(item,scope){var that=clientService,method="",url="",name=that.name;return scope.submitStatus=!0,_.isUndefined(item.id)||(method="PATCH",url=that.httpBaseUrl+"/"+name+"/onoroff/"+item.id+"/"+item.tabletStatus),item=that.changeFromLocalColumns(item),that.$http({url:url,method:method,data:item,withCredentials:!0})},clientService.getClientModels=function(tabletId){var that=clientService,method="",url="";return method="GET",url=0==tabletId?that.httpBaseUrl+"/target/clientmodel":that.httpBaseUrl+"/target/clientmodel?tabletId="+tabletId,that.$http({url:url,method:method,withCredentials:!0})},clientService.getAreaList=function(){var that=clientService,method="GET",url=that.areaUrl+"/area/index";return that.$http({url:url,method:method,withCredentials:!0})},clientService.versionEach=function(params){var that=clientService,method="",url="";that.name;return method="PATCH",url=that.httpBaseUrl+"/appRelation/appupdate",that.$http({url:url,method:method,data:params,withCredentials:!0})},clientService.targetTab=function(pageNumber,params){var that=this,d=that.$q.defer();return that.$http({url:that.httpBaseUrl+"/tablet/index",method:"GET",withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},clientService.versionByTarget=function(targetId){var that=this,d=that.$q.defer();return that.$http({url:that.httpBaseUrl+"/target/appversion/"+targetId,method:"GET",withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},clientService.getResultsPage=function(pageNumber,params,type){var urlIndex="";urlIndex=0==type?"indexfornormal":"indexfornormalvod";var that=this,d=that.$q.defer();return params=params?that.changeFromLocalColumns(params):{},params.currentPage=pageNumber,that.$http({url:that.httpBaseUrl+"/"+that.name+"/"+urlIndex+"?isAll=true",method:"GET",params:params,withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},clientService.updateStatus=function(item,scope){var that=clientService,method="",url="",name=that.name;return scope.submitStatus=!0,_.isUndefined(item.id)||(method="PATCH",url=that.httpBaseUrl+"/"+name+"/update/"+item.id),item=that.changeFromLocalColumns(item),that.$http({url:url,method:method,data:item,withCredentials:!0})},clientService.saveOrder=function(list,scope){var that=this,method="",url="",name=that.name;scope.submitStatus=!0;var data=list;return method="POST",url=that.httpBaseUrl+"/"+name+"/sort",that.$http({url:url,method:method,data:data,withCredentials:!0})},clientService.saveTmp=function(item,scope){var that=clientService,method="",url="",name=that.name;return scope.submitStatus=!0,_.isUndefined(item.id)||(method="PATCH",url=that.httpBaseUrl+"/"+name+"/update/"+item.id),item=that.changeFromLocalColumns(item),that.$http({url:url,method:method,data:item,withCredentials:!0})},clientService.getTmpVersion=function(){var that=clientService,method="",url="";return method="GET",url=that.httpBaseUrl+"/apps/index?isAll=1",that.$http({url:url,method:method,withCredentials:!0})},clientService.showVeision=function(id){var that=clientService,params={refId:id,appRelationType:21,isAll:1},d=$q.defer();return $http({url:that.httpBaseUrl+"/appRelation/index",method:"GET",header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},params:params,withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},clientService.showTabVeision=function(id){var that=clientService,params={refId:id,appRelationType:22,isAll:1},d=$q.defer();return $http({url:that.httpBaseUrl+"/appRelation/index",method:"GET",header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},params:params,withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},clientService.getApp=function(){var that=this,d=$q.defer();return $http({url:that.httpBaseUrl+"/appKey/index",method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows,mapping.appKey),d.resolve(resp)},function(error){d.reject(error)}),d.promise},clientService.getApp_version=function(params){var that=this,d=that.$q.defer();return that.$http({url:that.httpBaseUrl+"/apps/index",method:"GET",params:params,header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/json"},withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows,mapping.apps),d.resolve(resp)},function(error){d.reject(error)}),d.promise},clientService.getAppsByVersionId=function(id){var that=this,method="GET",url="",d=that.$q.defer();return url=that.httpBaseUrl+"/appRelation/index",that.$http({url:url,method:method,params:{refId:id,appRelationType:21,isAll:1},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},clientService.getTabByVersionId=function(id){var that=this,method="GET",url="",d=that.$q.defer();return url=that.httpBaseUrl+"/appRelation/index",that.$http({url:url,method:method,params:{refId:id,appRelationType:22,isAll:1},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},clientService.getValue=function(id){var that=this,method="GET",url="",d=that.$q.defer();return url=that.httpBaseUrl+"/"+that.name+"/show/"+id,that.$http({url:url,method:method,withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},clientService}])}),define("modules/oms/client/tab",["angularAMD","modules/oms/client/service","Session"],function(angularAMD,BaseCtrl){"use strict";angularAMD.controller("TabCtrl",["$scope","clientService","Session","$controller","$state","$stateParams","ngDialog","StarsUtils",function($scope,clientService,Session,$controller,$state,$stateParams,ngDialog,StarsUtils){$scope.methods=$state.current.data.methods,$scope.dataConfig={edit:{template:"modules/oms/client/tabEdit.html",data:{title:"编辑TAB"},controller:"TabEditCtrl"},create:{template:"modules/oms/client/tabEdit.html",data:{title:"新增TAB",item:{}},controller:"TabEditCtrl"}},$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=clientService.setName("tablet");var tabCtrl=$scope.tabCtrl={};$scope.tabVals=[{val:1,name:"上线"},{val:0,name:"下线"}],$scope.tabtype={0:"导航",1:"API"},tabCtrl.update=function(item,status){clientService.saveShow({id:item.id,tabletStatus:status},$scope).then(function(e){item.tabletStatus=e.data.tabletStatus},function(error){var str=[];400==error.status?angular.forEach(error.data.message,function(e){str.push(e)}):(str.push(error.data.message),error.data.error&&str.push(error.data.error.message));var errorStr="code "+error.status+":"+str;StarsUtils.confirm(errorStr).then(function(){})})},tabCtrl.versionChoice=function(id){ngDialog.open({template:"modules/oms/client/versionList.html",data:{title:"模块版本列表",id:id},controller:"VersionCtrl"})},"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage)}])}),define("modules/oms/client/tabEdit",["angularAMD","modules/oms/client/service","jquery"],function(angularAMD){"use strict";angularAMD.controller("TabEditCtrl",function($scope,clientService){$scope.tabEditCtrl={};$scope.errorMessage="",$scope.title=$scope.ngDialogData.title;var tablet=$scope.tablet=$scope.ngDialogData.item;$scope.app=$scope.ngDialogData.item;var id=tablet.id;$scope.isShow=0,$scope.typeApp="tab",angular.isUndefined(id)&&(tablet.tabType=0),null==tablet.id&&($scope.ngDialogData.item={}),$scope.checkCloseDialog=function(){$scope.tablet.appId=tablet.appId,$scope.errorMessage="",$scope.submitted=!0,clientService.isEmptyObject($scope.myform)||clientService.saveItem($scope.tablet,$scope).then(function(data){$scope.submitStatus=!1,$scope.closeThisDialog(data)},function(error){$scope.submitStatus=!1,$scope.errorMessage=error})},clientService.getClientModels(0).then(function(resp){$scope.clientModels=resp.data},function(error){}),$scope.toggleCheck=function(id){angular.isUndefined($scope.tablet.modelId)&&($scope.tablet.modelId=[]),$scope.tablet.modelId.indexOf(id)>-1?$scope.tablet.modelId.splice($scope.tablet.modelId.indexOf(id),1):$scope.tablet.modelId.push(id)}})}),define("modules/oms/client/template",["angularAMD","modules/oms/client/service","Session"],function(angularAMD){"use strict";angularAMD.controller("templateCtrl",["$scope","clientService","$controller","$state","ngDialog",function($scope,clientService,$controller,$state,ngDialog){$scope.methods=$state.current.data.methods,$controller("BaseCtrl",{$scope:$scope}),$scope.clientId=$scope.ngDialogData.id,$scope.titleName=$scope.ngDialogData.name,$scope.nameIndex=$scope.ngDialogData.nameIndex,$scope.tabletId=$scope.ngDialogData.tabletId;var versionCtrl=$scope.versionCtrl={};$scope.modelDemo={appKey:"WnJY48akhyvc",appOs:"",appVer:""},$scope.fromAppCk=[],$scope.toAppCk=[],$scope.toApp=[],$scope.fromApp=[],versionCtrl.ckFrom=function(obj,index){$scope.fromAppCk.indexOf(obj)<0?($scope.fromAppCk.push(obj),$scope.modelDemo.appOs=obj.appsAppOs,$scope.modelDemo.appVer=obj.appsAppVersion):$scope.fromAppCk.splice($scope.fromAppCk.indexOf(obj),1)},$scope.fromModules=[],$scope.init=function(){clientService.getClientModels($scope.tabletId).then(function(e){$scope.model=e.data,angular.forEach($scope.model,function(obj){obj.config&&(obj.line=1,5==obj.id&&(obj.line=2),2==obj.id&&(obj.episode=1)),obj.modelId=angular.copy(obj.id),delete obj.id,obj.data={text:"",ids:[],attr:[]}})}),clientService.versionByTarget($scope.clientId).then(function(e){$scope.fromApp=e.data.data.rows,$scope.fromApp.length>0&&$scope.showByVersion($scope.fromApp[0])},function(error){})},$scope.showByVersion=function(appObj){$scope.getObjByVersion(appObj.appId)},$scope.getObjByVersion=function(appId){clientService.getModelData($scope.nameIndex,$scope.clientId,appId).then(function(e){$scope.fromData=angular.copy(e.data),$scope.fromModules=[],angular.forEach($scope.fromData.datas,function(dataObj,i){if(1==dataObj.type||2==dataObj.type)$scope.modelTemplate=angular.copy($scope.model[dataObj.type]),2==dataObj.type&&2==dataObj.config.episode.option&&($scope.modelTemplate.episode=dataObj.config.episode.option,$scope.modelTemplate.isNumber=dataObj.config.isNumber.option),$scope.fromModules.push(angular.copy($scope.modelTemplate)),$scope.fromModules[i].data.text=dataObj.headerTitle,$scope.fromModules[i].line=dataObj.config.line.option,angular.forEach(dataObj.data,function(child,a){$scope.fromModules[i].data.attr.push({imgUrl:child.videoImage,videoName:child.videoName})});else{if($scope.fromModules.push(angular.copy($scope.model[dataObj.type])),$scope.fromModules[i].data.text=dataObj.headerTitle,5==$scope.fromModules[i].modelId)return $scope.fromModules[i].headerCount=dataObj.headerCount,$scope.fromModules[i].data.attr.length=parseInt($scope.fromModules[i].headerCount),void angular.forEach(dataObj.data,function(child,a){a>=parseInt($scope.fromModules[i].data.headerCount)||($scope.fromModules[i].data.attr[a]={imgUrl:child.videoImage,videoName:child.videoName})});angular.forEach(dataObj.data,function(child,a){$scope.fromModules[i].data.attr.push({imgUrl:child.videoImage,videoName:child.videoName})})}})},function(error){})},$scope.init()}])}),define("modules/oms/client/tmpapi",["angularAMD","modules/oms/client/service","Session"],function(angularAMD){"use strict";angularAMD.controller("TmpapiCtrl",["$scope","clientService","Session","$controller","$state","$stateParams","ngDialog","StarsUtils",function($scope,clientService,Session,$controller,$state,$stateParams,ngDialog,StarsUtils){$scope.methods=$state.current.data.methods,$scope.dataConfig={edit:{template:"modules/oms/client/tmpapiEdit.html",data:{title:"编辑API"},controller:"TmpapiEditCtrl"},create:{template:"modules/oms/client/tmpapiEdit.html",data:{title:"新增API",item:{}},controller:"TmpapiEditCtrl"},area:{template:"modules/oms/content/channelOption.html",data:{title:"所属地域",objName:"area",type:5},controller:"changeCtrl"}},$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=clientService.setName("customApi");var tmpapiCtrl=$scope.tmpapiCtrl={};$scope.Vals=[{val:1,name:"上线"},{val:0,name:"下线"}],tmpapiCtrl.versionList=function(id){ngDialog.open({template:"modules/oms/client/versionList.html",data:{title:"版本列表",id:id},controller:"VersionCtrl"})},clientService.getAllArea().then(function(resp){$scope.areaList=resp.data.rows},function(){}),tmpapiCtrl.belongArea=function(id,event){clientService.getAllArea().then(function(data){},function(error){})},tmpapiCtrl.update=function(item,status){clientService.saveTmp({id:item.id,status:status},$scope).then(function(resp){$scope.status=resp.data.status,$scope.getResultsPage($scope.currentPage)},function(error){var str=[];400==error.status?angular.forEach(error.data.message,function(e){str.push(e)}):(str.push(error.data.message),error.data.error&&str.push(error.data.error.message));var errorStr="code "+error.status+":"+str;StarsUtils.confirm(errorStr).then(function(){})})},"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage,$scope.searchParams),$scope.itemCtrl.search=function(){$scope.itemService=clientService.setName("customApi"),$scope.getResultsPage(1,$scope.searchParams)}}])}),define("modules/oms/client/tmpapiEdit",["angularAMD","modules/oms/client/service"],function(angularAMD){"use strict";angularAMD.controller("TmpapiEditCtrl",function($scope,clientService){function getLists(){$scope.versionAppList=[],$scope.itemService=clientService.setName("appRelation"),$scope.itemService.getAppsByVersionId(refId).then(function(resp){$scope.versionAppList=resp.data.rows,_.map($scope.tmpVersion,function(item){_.find($scope.versionAppList,{appId:item.appsId})&&$scope.toggleCheck(item.appsId)}),$scope.tmpVersion.length==$scope.versionAppList.length&&($scope.selectAll=!0),clientService.setName("customApi")},function(error){$scope.errorMessage="code "+error.data.code+":"+error.data.message})}var tmpapiEditCtrl=$scope.tmpapiEditCtrl={};$scope.errorMessage="",$scope.title=$scope.ngDialogData.title;var tmpapi=$scope.tmpapi=$scope.ngDialogData.item,refId=$scope.ngDialogData.item.id;$scope.app=$scope.tmpapi,null==tmpapi.id&&($scope.ngDialogData.item={}),$scope.apiReturns=[{key:"",value:""}],tmpapiEditCtrl.addApi=function(){var keyVal={key:"",value:""};$scope.apiReturns.push(keyVal)},tmpapiEditCtrl.remove=function(index){$scope.apiReturns.splice(index,1)},tmpapi.customValue=$scope.apiReturns,clientService.getTmpVersion().then(function(resp){$scope.tmpVersion=resp.data.rows,"新增API"!=$scope.title&&getLists()},function(error){}),angular.isUndefined(refId)||clientService.getValue(refId).then(function(e){var customV=angular.copy(e.data.customValue);for(var i in customV)$scope.apiReturns.push(customV[i]);for(var j in $scope.apiReturns)""==$scope.apiReturns[j].key&&""==$scope.apiReturns[j].value&&$scope.apiReturns.splice($scope.apiReturns[j],1)},function(error){$scope.errorMessage="code "+error.data.code+":"+error.data.message}),tmpapiEditCtrl.checkCloseDialog=function(){$scope.errorMessage="",$scope.submitted=!0,clientService.isEmptyObject($scope.myform)||clientService.saveItem(tmpapi,$scope).then(function(data){$scope.submitStatus=!1,$scope.closeThisDialog(data)},function(error){$scope.submitStatus=!1,$scope.errorMessage=error})},angular.isUndefined(tmpapi.appId)&&(tmpapi.appId=[]),$scope.selectAll=!1,$scope.toggleCheck=function(id){tmpapi.appId.indexOf(id)>-1?tmpapi.appId.splice(tmpapi.appId.indexOf(id),1):tmpapi.appId.push(id)},$scope.toggleAll=function(){$scope.selectAll?(tmpapi.appId=[],angular.forEach($scope.tmpVersion,function(val){tmpapi.appId.push(val.appsId)})):tmpapi.appId=[]}})}),define("modules/oms/client/versionList",["angularAMD","lodash","modules/oms/client/service"],function(angularAMD,_){"use strict";angularAMD.controller("VersionCtrl",["$scope","clientService","Session","$controller","$state","ngDialog",function($scope,clientService,Session,$controller,$state,ngDialog){$scope.methods=$state.current.data.methods,$controller("BaseCtrl",{$scope:$scope}),$scope.title=$scope.ngDialogData.title;var id=$scope.id=$scope.ngDialogData.id;"版本列表"==$scope.title&&clientService.showVeision(id).then(function(resp){$scope.items=resp.data.rows},function(error){$scope.errorMessage="code "+error.data.code+":"+error.data.message}),"模块版本列表"==$scope.title&&clientService.showTabVeision(id).then(function(resp){$scope.items=resp.data.rows},function(error){$scope.errorMessage="code "+error.data.code+":"+error.data.message})}])}),define("modules/oms/client/versionOption",["angularAMD","modules/oms/client/service","Session"],function(angularAMD){"use strict";angularAMD.controller("versionAppCtrl",["$scope","clientService","Session","$controller","$state","ngDialog",function($scope,clientService,Session,$controller,$state,ngDialog){$scope.methods=$state.current.data.methods,$controller("BaseCtrl",{$scope:$scope}),$scope.rItem=[],$scope.select="",$scope.type=$scope.ngDialogData.type,$scope.title=$scope.ngDialogData.title,$scope.idOptions=$scope.ngDialogData.id,$scope.appIds=$scope.ngDialogData.appIds,$scope.objName=$scope.ngDialogData.objName,$scope.tabletId=$scope.ngDialogData.tabletId,$scope.targetId=$scope.ngDialogData.targetId;$scope.versionAppCtrl={};$scope.ckOption=function(obj){$scope.optionType=obj.name,$scope.searchParams.videoType=obj.id},$scope.ckMore=function(obj,ckbox){ckbox?$scope.rItem[obj.id]=obj:$scope.rItem.splice($scope.rItem.indexOf($scope.rItem[obj.id]),1)},$scope.ckModel=function(item,option){$scope.rItem[0]=item},$scope.init=function(){"undefined"!=typeof $scope.appIds?($scope.itemService=clientService.setName("appRelation"),$scope.getResultsPage=function(pageNumber,params){clientService.getAppRelaction(pageNumber,$scope.searchParams,$scope.tabletId).then(function(data){$scope.loading_list=!1,$scope.items=data.data.rows,$scope.totalItems=data.data.totalResults},function(error){})},$scope.getResultsPage(1,null)):($scope.itemService=clientService.setName($scope.objName),$scope.searchParams.tabletId=$scope.tabletId,$scope.searchParams.id=$scope.targetId,$scope.getResultsPage($scope.currentPage,{type:2,tabletId:$scope.tabletId,id:$scope.targetId}))},$scope.init(),$scope.$watch("items",function(){"undefined"!=typeof $scope.idOptions&&angular.forEach($scope.items,function(e,v){"undefined"!=typeof e.id&&$scope.idOptions.length>0&&$scope.idOptions.indexOf(e.id)>=0?($scope.items[v].check=!0,$scope.rItem[e.id]=e):$scope.items[v].check=!1})})}])}),define("modules/oms/config/config",["angularAMD","modules/oms/config/service","Session"],function(angularAMD,BaseCtrl){"use strict";angularAMD.controller("ConfigCtrl",function($scope,ConfigService,$state,$controller,StarsUtils){function load(){ConfigService.getList($scope.searchParams).then(function(resp){$scope.select=resp.data.rows[0].configValue,$scope.configId=resp.data.rows[0].configId},function(error){})}$scope.methods=$state.current.data.methods;var configCtrl=$scope.configCtrl={};$controller("BaseCtrl",{$scope:$scope}),ConfigService.getConfigList().then(function(resp){$scope.configList=[];for(var i in resp.data)$scope.configList.push({key:i,value:resp.data[i]})},function(error){}),$scope.itemService=ConfigService.setName("Config"),$scope.searchParams.configKey="control_url",load(),configCtrl.update=function(value){$scope.configValue=value},configCtrl.checkCloseDialog=function(){var item={};item.configId=$scope.configId,item.configKey="control_url",item.configValue=$scope.configValue,ConfigService.saveItem(item,$scope).then(function(resp){StarsUtils.alert("配置成功！"),$state.go("site.oms.config.config"),$scope.submitStatus=!1},function(error){$scope.submitStatus=!1})}})}),define("modules/oms/config/service",["angularAMD","BaseService"],function(angularAMD,BaseService){"use strict";angularAMD.service("ConfigService",["APP_CONFIG","$http","$q",function(config,$http,$q){var mapping={config:{configId:"configId",configKey:"configKey",configValue:"configValue"}},configService=new BaseService(config,$http,$q,mapping);return configService.getConfigList=function(){var that=this,d=$q.defer();return $http({url:that.httpBaseUrl+"/Config/url",method:"GET",header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},configService.getList=function(params){var that=this,d=$q.defer();return $http({url:that.httpBaseUrl+"/Config/index",method:"GET",params:params,header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},configService.saveItem=function(item,scope){var that=this,method="",url="",name=that.name;return scope.submitStatus=!0,method="PATCH",url=that.httpBaseUrl+"/"+name+"/update/"+item.configId,that.$http({url:url,method:method,data:item,withCredentials:!0})},configService}])}),define("modules/oms/content/bindVideo",["angularAMD","modules/oms/content/service","jquery"],function(angularAMD){"use strict";angularAMD.controller("bindVideoCtrl",function($scope,contentService,$stateParams,$state,$controller,$location,StarsUtils){function removeEqualArea(){var unique={};$scope.checkAreas.forEach(function(gpa){unique[JSON.stringify(gpa)]=gpa}),$scope.checkAreas=Object.keys(unique).map(function(u){return JSON.parse(u)})}function equalArea(){var ids=[];angular.forEach($scope.checkAreas,function(obj){ids.push(obj.id)}),angular.forEach($scope.trees,function(data){-1!==ids.indexOf(data.id)?data.selected=!0:data.selected=!1,angular.forEach(data.data,function(dat){-1!==ids.indexOf(dat.id)?dat.selected=!0:dat.selected=!1,angular.forEach(dat.data,function(da){-1!==ids.indexOf(da.id)?da.selected=!0:da.selected=!1}),dat.selected&&angular.forEach(dat.data,function(da){da.selected=!0})}),data.selected&&angular.forEach(data.data,function(d){d.selected=!0})})}function invalidTime(video){$scope.validTime=!0,angular.forEach(video,function(obj){return obj.endTime<obj.startTime?void($scope.validTime=!1):void 0})}var bindVideoCtrl=$scope.bindVideoCtrl={},video=$scope.video={};$controller("BaseCtrl",{$scope:$scope}),$scope.errorMessage="",$scope.loading_list=!0,$scope.dopoolKey="4MUAHmQFf1YR",$scope.checkAreas=[],video.areaId=[],video.marketId=[],$scope.isClicks=!0,$scope.isClick=!0;var stuff=[];contentService.getCityList().then(function(res){$scope.stuff=res.data,stuff[0]={id:0,cityName:"中国",data:$scope.stuff},bindVideoCtrl.stuff=stuff,$scope.trees=stuff},function(error){$scope.errorMessage="error get market:"+error}),bindVideoCtrl.toggleCallback=function(node,e,t){$scope.node=node},bindVideoCtrl.otherAwesomeCallback=function(node,isSelected,tree){$scope.node&&$scope.node.id==node.id&&$scope.node.selected&&(angular.forEach($scope.node.data,function(dat){angular.forEach($scope.checkAreas,function(da,j){dat.id==da.id&&$scope.checkAreas.splice(j,1)})}),$scope.checkAreas.push({name:node.cityName,id:node.id})),0==node.id&&node.selected&&($scope.checkAreas=[{name:node.cityName,id:node.id}]),0!=node.id||node.selected||($scope.checkAreas=[]),$scope.node&&$scope.node.id==node.id&&!$scope.node.selected&&$scope.checkAreas.splice($scope.checkAreas.indexOf({name:node.cityName,id:node.id}),1),$scope.node&&$scope.node.id!==node.id&&!$scope.node.selected&&isSelected&&$scope.checkAreas.push({name:node.cityName,id:node.id}),!$scope.node||$scope.node.id===node.id||$scope.node.selected||isSelected||(angular.forEach($scope.checkAreas,function(da,j){$scope.node.id==da.id&&$scope.checkAreas.splice(j,1)}),angular.forEach($scope.node.data,function(dat){angular.forEach($scope.checkAreas,function(da,j){dat.id==da.id&&$scope.checkAreas.splice(j,1)}),dat.selected&&$scope.checkAreas.push({name:dat.cityName,id:dat.id})})),node.selected?$scope.checkAreas.push({name:node.cityName,id:node.id}):angular.forEach($scope.checkAreas,function(obj,i){node.id==obj.id&&$scope.checkAreas.splice(i,1)}),removeEqualArea()},bindVideoCtrl.removeCity=function(checkArea,i){$scope.checkAreas.splice(i,1),removeEqualArea(),equalArea()},$scope.isShow=1,$scope.selcetStyle=function(){$("ul").css({"max-height":"110%",overflow:"auto"})},$scope.videoTimes=[],contentService.videoApp($stateParams.videoId).then(function(resp){$scope.appKeys=resp.data},function(error){}),contentService.getMarketList().then(function(res){$scope.marketList=angular.copy(res.data.rows)},function(error){$scope.errorMessage="error get market:"+error}),contentService.getMarketRelation($stateParams.videoId).then(function(res){var areaList="";video=$scope.video=angular.copy(res.data.rows),0==video.appKey.length&&0==video.time.length&&0==video.areaId[0]&&0==video.marketId.length&&(video.areaId=[]),angular.forEach($scope.video.time,function(obj){obj.endTime=new Date(1e3*parseInt(obj.endTime)),obj.startTime=new Date(1e3*parseInt(obj.createTime)),delete obj.createTime,$scope.videoTimes.push(obj),$scope.isShow=1}),angular.forEach(video.areaId,function(obj){areaList+=obj+","}),$scope.video.areaId.length>0&&contentService.getCityList(areaList).then(function(res){
var data=res.data;0==data.length?$scope.checkAreas.push({id:0,name:"中国"}):angular.forEach(data,function(obj){$scope.checkAreas.push({id:obj.id,name:obj.cityName})}),equalArea()},function(error){$scope.errorMessage="error get city:"+error}),$scope.loading_list=!1},function(error){$scope.errorMessage="error get marketRelation:"+error}),bindVideoCtrl.addVideoTime=function(){return angular.forEach($scope.checkAreas,function(data){video.areaId.push(data.id)}),0==video.appKey.length||0==video.areaId.length||0==video.marketId.length?void StarsUtils.alert("选项不可为空，如果全部屏蔽，请全选！"):void($scope.videoTimes.length<10?($scope.isShow=1,$scope.videoTimes.push({startTime:new Date,endTime:new Date,reason:1})):StarsUtils.alert("屏蔽时段最多只能添加10个！"))},bindVideoCtrl.removeVideoTime=function(i){$scope.videoTimes.splice(i,1)},bindVideoCtrl.showMarket=function(market,event){"all"==market&&($scope.isClicks?(angular.forEach($scope.marketList,function(data){video.marketId.push(data.marketId)}),$(".mar").attr("disabled",!0),$scope.isClicks=!1,$(".mar").addClass("btn-warning"),$(".mars").addClass("btn-warning")):(video.marketId=[],$(".mar").attr("disabled",!1),$scope.isClicks=!0,$(".mar").removeClass("btn-warning"),$(".mars").removeClass("btn-warning"))),"all"!==market&&(-1==event.target.className.indexOf("btn-warning")?(video.marketId.push(market.marketId),$(".mar").remove("btn-warning"),event.target.className=event.target.className+" btn-warning",$scope.marketList.length==video.marketId.length&&($(".mars").addClass("btn-warning"),$(".mar").attr("disabled",!0),$scope.isClicks=!1)):(video.marketId.splice(market.marketId.indexOf(video.marketId),1),event.target.className=event.target.className.replace("btn-warning","")))},bindVideoCtrl.checkCloseDialog=function(){$scope.errorMessage="",video.videoId=parseInt($stateParams.videoId),video.areaId=[],invalidTime($scope.videoTimes),$scope.validTime?(angular.forEach($scope.videoTimes,function(obj,i){obj.endTime=Date.parse(obj.endTime)/1e3,obj.startTime=Date.parse(obj.startTime)/1e3}),video.time=$scope.videoTimes,angular.forEach($scope.checkAreas,function(data){video.areaId.push(data.id)}),video.areaId.length>0&&video.appKey.length>0&&video.marketId.length>0?($scope.submitStatus=!0,contentService.setName("marketRelation").saveItem(video,$scope).then(function(data){0==video.time.length&&StarsUtils.alert("未添加时段！"),$state.go("site.oms.contents.video"),$scope.submitStatus=!1},function(error){$scope.submitStatus=!1,$scope.errorMessage="code "+error.type+":"+error.message})):StarsUtils.alert("选项不可为空，如果全部屏蔽，请全选！")):StarsUtils.alert("保存失败:结束时间必须大于开始时间")}})}),define("modules/oms/content/channel",["angularAMD","modules/oms/content/service","Session"],function(angularAMD){"use strict";angularAMD.controller("channelCtrl",["$scope","contentService","Session","$controller","$state","ngDialog","StarsUtils",function($scope,contentService,Session,$controller,$state,ngDialog,StarsUtils){$scope.methods=$state.current.data.methods,$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=contentService.setName("video");var channelCtrl=$scope.channelCtrl={};$scope.init=function(){$scope.dataConfig={area:{template:"modules/oms/content/channelOption.html",data:{title:"所属地域",objName:"area",type:5},controller:"changeCtrl"}},$scope.statusVal=[{name:"未完善",val:"0"},{name:"上线",val:"1"},{name:"下线",val:"2"}],"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage),contentService.getAllArea().then(function(resp){$scope.areaList=resp.data.rows},function(){})},channelCtrl.update=function(item,status){contentService.upVideoStatus({id:item.id,videoStatus:status}).then(function(e){item.videoStatus=e.data.videoStatus},function(error){var str=[];400==error.status?angular.forEach(error.data.message,function(e){str.push(e)}):(str.push(error.data.message),error.data.error&&str.push(error.data.error.message));var errorStr="code "+error.status+":"+str;StarsUtils.confirm(errorStr).then(function(){})})},channelCtrl.selectline=function(status){contentService.upSelectVideoStatus({id:$scope.ids,videoStatus:status}).then(function(e){angular.forEach($scope.items,function(obj){$scope.ids.indexOf(obj.id)>-1&&(obj.videoStatus=e.data.videoStatus)}),$scope.ids=[],$scope.getResultsPage($scope.currentPage)},function(error){var str=[];400==error.status?angular.forEach(error.data.message,function(e){str.push(e)}):(str.push(error.data.message),error.data.error&&str.push(error.data.error.message));var errorStr="code "+error.status+":"+str;StarsUtils.confirm(errorStr).then(function(){})})},channelCtrl.belongArea=function(id,type,event){contentService.getAllArea().then(function(data){},function(error){})},$scope.init(),$scope.itemCtrl.search=function(){$scope.itemService=contentService.setName("video"),$scope.getResultsPage(1,$scope.searchParams)}}])}),define("modules/oms/content/channelEdit",["angularAMD","modules/oms/content/service","Session"],function(angularAMD){"use strict";angularAMD.controller("channelEditCtrl",["$scope","$rootScope","contentService","Session","$controller","$state","ngDialog","StarsUtils","$location","APP_CONFIG",function($scope,$rootScope,contentService,Session,$controller,$state,ngDialog,StarsUtils,$location,config){function ckform(value){var str=value,reg=/(http|https|p2p|ftp|rtsp|rtsp|igmp|file|rtspt|rtspu):\/\/[^\/]+/,urlReg=new RegExp(reg),flag=!!str.match(urlReg);return flag?!0:!1}$scope.methods=$state.current.data.methods,$controller("BaseCtrl",{$scope:$scope});var channelEditCtrl=$scope.channelEditCtrl={};$scope.channel={},$scope.init=function(){$scope.route($location.$$absUrl),$scope.videoId=$state.params.videoId,$scope.urlOptions=["流畅","标清","高清","极速高清","极速标清","极速流畅","手工输入"],$scope.channelSubmit=!1,$scope.urlCount=[{id:1,selectName:"流畅",pUrlId:"",urlId:0,writeName:"",location:"",sourceId:"",sourceName:"",vip:0}],$scope.channel={},$scope.urlObj={urlId:0,is_showUrl:1},$scope.channel.vip=0,contentService.getChargetype().then(function(e){$scope.chargetypes=[],angular.forEach(e.data,function(obj,i){$scope.chargetypes.push({id:obj.id,name:obj.title})}),$scope.chargetype=$scope.chargetypes[0]},function(error){}),$scope.loading=!1,-1!=$scope.videoId?($scope.loading_list=!0,$scope.channel.vip=0,contentService.editData($scope.videoId).then(function(e){$scope.loading_list=!1,$scope.item=angular.copy(e.data),$scope.chargetype=$scope.chargetypes[$scope.item.chargeType],angular.forEach($scope.chargetypes,function(obj,e){$scope.item.chargeType==obj.id&&($scope.chargetype=$scope.chargetypes[e])}),$scope.channel=e.data,$scope.channel.name=$scope.channel.videoName,$scope.channel.id=$scope.videoId,angular.isDefined($scope.channel.images)&&$scope.channel.images.length>0&&($scope.channel.videoImage=$scope.channel.images[0].imagePath,$scope.channel.videoTvImage=$scope.channel.images[1].imagePath,$scope.channel.videoShareImage=$scope.channel.images[2].imagePath),1==$scope.channel.videoStatus&&($scope.channel.videoStatus=2),$scope.channel.is_showUrl=1,$scope.channelOld=angular.copy($scope.channel),$scope.tagListData=angular.copy($scope.channel.videoTag),$scope.videoCp=[],$scope.channel.videoCp=[],$scope.videoApp=[],$scope.channel.videoApp=[],$scope.channel.categoryList=angular.copy($scope.channel.rows.categoryList),$scope.videoTag=[],$scope.channel.videoTag=[],$scope.channelOld.videoUrl.length>0&&($scope.urlCount=[]),1==$scope.channelOld.urlSource&&$scope.channelOld.videoUrl.length>0&&($scope.urlObj.title=$scope.channelOld.videoUrl[0].title,$scope.urlObj.location=$scope.channelOld.videoUrl[0].location,$scope.urlObj.urlId=$scope.channelOld.videoUrl[0].urlId),angular.forEach($scope.channelOld.videoUrl,function(e,i){var title="",write="";$scope.urlOptions.indexOf(e.title)>=0?title=e.title:(title="手工输入",write=e.title),contentService.showSourceList(e.lsId).then(function(data){e.lsName=data.data.lsName;var option={id:i,selectName:title,writeName:write,pUrlId:e.pUrlId,urlId:e.urlId,location:e.location,source:e.lsId+" "+e.lsName,sourceId:e.lsId,sourceName:e.lsName,vip:e.vip};$scope.urlCount.push(option),contentService.setHttpBaseUrl(config.httpBaseUrl)},function(error){if(404==error.status){var option={id:i,selectName:title,writeName:write,pUrlId:e.pUrlId,urlId:e.urlId,location:e.location,source:" ",sourceId:e.lsId,vip:e.vip};$scope.urlCount.push(option),contentService.setHttpBaseUrl(config.httpBaseUrl)}})}),angular.forEach($scope.channelOld.videoCp,function(e,i){$scope.videoCp.push(e.cpName),$scope.channel.videoCp.push(e.cpId)}),angular.forEach($scope.channelOld.appRelation,function(e,i){$scope.videoApp.push(e.appKeyName+e.appsAppOs+e.appsAppVersion),$scope.channel.videoApp.push(e.appId)}),"undefined"!=typeof $scope.channelOld.videoEpg&&($scope.videoEpg=$scope.channelOld.videoEpg.videoName,$scope.channel.videoEpg=$scope.channelOld.videoEpg.videoId),$scope.channel.categoryList.length>0&&($scope.channel.videoCategory=angular.copy($scope.channel.categoryList[0].categoryId),$scope.videoCategory=angular.copy($scope.channel.categoryList[0].categoryName)),"undefined"!=typeof $scope.channelOld.videoCategory&&$scope.channelOld.videoCategory.length>0&&($scope.videoCategory=$scope.channelOld.videoCategory[0].categoryName,$scope.channel.videoCategory=$scope.channelOld.videoCategory[0].categoryName.categoryId),angular.forEach($scope.channelOld.videoTag,function(e,i){$scope.videoTag.push(e.tagName),$scope.channel.videoTag.push(e.tagId)})},function(error){})):$scope.channel.urlSource=0},$scope.init(),channelEditCtrl.changeItem=function(index){var objModel=[{template:"modules/oms/content/channelOption.html",data:{title:"选择EPG频道",objName:"videoEpg",id:$scope.channel.videoEpg,type:0},controller:"changeCtrl"},{template:"modules/oms/content/channelOption.html",data:{title:"选择CP",objName:"cps",id:$scope.channel.videoCp,type:1},controller:"changeCtrl"},{template:"modules/oms/content/channelOption.html",data:{title:"选择频道分类",objName:"category",id:$scope.channel.categoryList&&$scope.channel.categoryList.length>0?[$scope.channel.categoryList[0].categoryId]:"",type:0},controller:"changeCtrl"},{template:"modules/oms/content/channelOption.html",data:{title:"选择频道标签",objName:"tag",id:$scope.channel.videoTag,type:2},controller:"changeCtrl"},{template:"modules/oms/content/channelOption.html",data:{title:"选择频道应用",objName:"apps",id:$scope.channel.videoApp,type:3},controller:"changeCtrl"}],ngdialog=ngDialog.open(objModel[index]);ngdialog.closePromise.then(function(data){if("undefined"!=typeof data.value&&"$document"!=data.value&&"$closeButton"!=data.value&&0!=data.value){var id=[],value=[];angular.forEach(data.value,function(i,vl){id.push(i.id),4==index?(id.push(i.appsId),value.push(i.appKeyName+i.appsAppOs+i.appsAppVersion)):value.push(i.name)}),0==index?($scope.videoEpg=value[0],$scope.channel.videoEpg=id[0]):1==index?($scope.videoCp=value,$scope.channel.videoCp=id):2==index?($scope.videoCategory=value[0],$scope.channel.videoCategory=id[0]):3==index?($scope.videoTag=value,$scope.channel.videoTag=id):4==index&&($scope.videoApp=value,$scope.channel.videoApp=id)}})},channelEditCtrl.changeVideoType=function(model,index){$scope.urlCount[index].selectName=model},channelEditCtrl.urlblur=function(){$scope.formatError=0},channelEditCtrl.channelSave=function(){$scope.channelSubmit=!0,contentService.isEmptyObject($scope.myform.$error)&&($scope.channel.videoUrl=[],0==$scope.channel.urlSource?angular.forEach($scope.urlCount,function(e,i){return ckform(e.location)?void(-2!=e.pUrlId&&("undefined"!=typeof e.writeName&&e.writeName.length>0&&"手工输入"==e.selectName?$scope.channel.videoUrl.push({title:e.writeName,location:e.location,pUrlId:e.pUrlId,urlId:e.urlId,urlSort:i,lsId:e.sourceId,vip:e.vip}):$scope.channel.videoUrl.push({title:e.selectName,location:e.location,pUrlId:e.pUrlId,urlId:e.urlId,urlSort:i,lsId:e.sourceId,vip:e.vip}))):void($scope.formatError=1)}):("undefined"==typeof $scope.urlObj.title&&($scope.urlObj.title=""),"undefined"==typeof $scope.urlObj.location&&($scope.urlObj.location=""),$scope.channel.videoUrl.push({title:$scope.urlObj.title,location:$scope.urlObj.location,pUrlId:-2,urlId:$scope.urlObj.urlId,urlSort:0,lsId:$scope.urlObj.sourceId,vip:$scope.urlObj.vip})),1!=$scope.formatError&&($scope.itemService=contentService.setName("video").setHttpBaseUrl(config.httpBaseUrl),$scope.submitStatus=!0,$scope.channel.chargeType=$scope.chargetype.id,"undefined"!=typeof $scope.channel.videoId?channelEditCtrl.ckUp($scope.channelOld,$scope.channel.videoCp,$scope.channel.videoApp,$scope.channel.videoCategory,$scope.channel.videoTag,$scope.channel.videoEpg)&&($scope.channel.categoryList=$scope.channel.videoCategory,contentService.saveItem($scope.channel,$scope).then(function(e){$scope.itemCtrl.back()},function(error){$scope.submitStatus=!1;var str=[];400==error.status?angular.forEach(error.data.message,function(e){str.push(e)}):(str.push(error.data.message),error.data.error&&str.push(error.data.error.message));var errorStr="code "+error.status+":"+str;StarsUtils.confirm(errorStr).then(function(){})})):($scope.channel.categoryList=$scope.channel.videoCategory,contentService.saveItem(angular.copy($scope.channel),$scope).then(function(e){$scope.submitStatus=!1,$state.go("site.oms.contents.video")},function(error){$scope.submitStatus=!1}))))},channelEditCtrl.ckUp=function(oldData,newCp,newApp,newCategory,newTag){var cp=[],app=[],tag=[],videoCategory="";return angular.forEach(oldData.videoCp,function(e,i){cp.push(e.cpId)}),angular.forEach(oldData.videoApp,function(e,i){app.push(e.appId)}),angular.forEach(oldData.videoTag,function(e,i){tag.push(e.tagId)}),$scope.channel.videoType!=oldData.videoType?!0:("undefined"!=typeof oldData.videoEpg[0]&&"undefined"!=typeof oldData.videoEpg[0].videoId&&oldData.videoEpg[0].videoId==$scope.channel.videoEpg&&($scope.channel.videoEpg=-1),videoCategory="undefined"==typeof oldData.videoCategory||0==oldData.videoCategory.length?-1:oldData.videoCategory[0].categoryId,-1!=newCp&&cp.sort().toString()==newCp.sort().toString()&&($scope.channel.videoCp=-1),app.sort().toString()==newApp.sort().toString()&&($scope.channel.videoApp=-1),-1!=newTag&&tag.sort().toString()==newTag.sort().toString()&&($scope.channel.videoTag=-1),!0)},channelEditCtrl.radioType=function(){$scope.urlCount.map(function(b){-2==b.pUrlId&&($scope.urlCount=[{id:1,selectName:"流畅",pUrlId:"",urlId:0,writeName:"",location:"",source:""}])})},channelEditCtrl.addUrl=function(){var urlOption={id:$scope.urlCount.length,selectName:"流畅",writeName:"",urlId:0,pUrlId:"",location:"",flag:0,urlObj:2,source:"",vip:""};$scope.urlCount.push(urlOption)},channelEditCtrl.chooseMore=function(index){var openDia=ngDialog.open({template:"modules/oms/content/channelOption.html",data:{title:"添加源",objName:"liverSource",type:4},controller:"changeCtrl"});openDia.closePromise.then(function(data){0!=data.value&&"$closeButton"!=data.value&&($scope.urlCount[index].source=data.value[0].sourceId+" "+data.value[0].sourceName,$scope.urlCount[index].sourceId=data.value[0].sourceId,$scope.urlCount[index].sourceName=data.value[0].sourceName,$scope.urlCount[index].location=data.value[0].location)},function(error){})},channelEditCtrl.upState=function(obj,selectName,index){if(index>0){var obj=angular.copy($scope.urlCount[index]);obj.selectName=selectName;var obj1=angular.copy($scope.urlCount[index-1]);$scope.urlCount[index]=obj1,$scope.urlCount[index-1]=obj}},channelEditCtrl.deleteState=function(index){$scope.urlCount.splice(index,1)},channelEditCtrl.downState=function(obj,selectName,index){if(index<$scope.urlCount.length-1){var obj=angular.copy($scope.urlCount[index]);obj.selectName=selectName;var obj1=angular.copy($scope.urlCount[index+1]);$scope.urlCount[index]=obj1,$scope.urlCount[index+1]=obj}}}])}),define("modules/oms/content/channelOption",["angularAMD","modules/oms/content/service","Session"],function(angularAMD,BaseCtrl){"use strict";angularAMD.controller("changeCtrl",["$scope","contentService","Session","$controller","$state","ngDialog",function($scope,contentService,Session,$controller,$state,ngDialog){$scope.methods=$state.current.data.methods,$controller("BaseCtrl",{$scope:$scope}),$scope.idOptions=$scope.ngDialogData.id,$scope.relateId=$scope.ngDialogData.videoId,$scope.areaType=$scope.ngDialogData.areaRelationType,$scope.title=$scope.ngDialogData.title,$scope.type=$scope.ngDialogData.type,$scope.rItem=[],$scope.typeApp="video",$scope.ckOption=function(obj){$scope.rItem[0]=obj,angular.forEach($scope.items,function(data){data.id==obj.id?data.check=!0:data.check=!1})},$scope.ckMore=function(obj,ckbox){ckbox=ckbox.target.checked,5!==$scope.type?ckbox?$scope.rItem[obj.id]=obj:delete $scope.rItem[obj.id]:ckbox?$scope.rItem[obj.areaId]=obj:$scope.rItem.splice($scope.rItem.indexOf(obj),1)},$scope.itemService=contentService.setName($scope.ngDialogData.objName),"apps"==$scope.ngDialogData.objName&&($scope.searchParams.isAll=1),("videoEpg"==$scope.ngDialogData.objName||"liverSource"==$scope.ngDialogData.objName||"area"==$scope.ngDialogData.objName)&&($scope.getResultsPage=function(pageNumber,params,callback){$scope.currentPage=pageNumber,$scope.items=[],$scope.loading_list=!0,"videoEpg"==$scope.ngDialogData.objName&&contentService.getEpgItem(pageNumber,params).then(function(data){$scope.loading_list=!1,$scope.items=data.data.rows,$scope.totalItems=data.data.totalResults}),"liverSource"==$scope.ngDialogData.objName&&contentService.getSourceList(pageNumber,params).then(function(data){$scope.loading_list=!1,$scope.items=data.data.rows,$scope.totalItems=data.data.totalResults}),"area"==$scope.ngDialogData.objName&&contentService.getAllArea().then(function(data){if($scope.loading_list=!1,$scope.items=data.data.rows,$scope.totalItems=data.data.totalResults,$scope.relateId){var ids=[];contentService.getVideoArea($scope.relateId,$scope.areaType).then(function(resp){var respRelat=resp.data.rows;angular.forEach(respRelat,function(o,i){ids.push(o.id)}),angular.forEach($scope.items,function(e,v){-1!==ids.indexOf(e.areaId)?($scope.items[v].check=!0,$scope.rItem[e.areaId]=e):$scope.items[v].check=!1})},function(error){$scope.errorMessage="code "+error.data.code+":"+error.data.message})}})},$scope.pageChanged=function(newPage){$scope.getResultsPage(newPage,$scope.searchParams)}),$scope.getResultsPage($scope.currentPage,$scope.searchParams),$scope.$watch("items",function(){"undefined"!=typeof $scope.idOptions&&angular.forEach($scope.items,function(e,v){"apps"==$scope.ngDialogData.objName?"undefined"!=typeof e.appsId&&$scope.idOptions.length>0&&$scope.idOptions.indexOf(e.appsId)>=0?($scope.items[v].check=!0,$scope.rItem[e.appsId]=e):$scope.items[v].check=!1:"undefined"!=typeof e.id&&$scope.idOptions.length>0&&$scope.idOptions.indexOf(e.id)>=0?($scope.items[v].check=!0,$scope.rItem[e.id]=e):$scope.items[v].check=!1})}),$scope.checkCloseDialog=function(rItem){var areaIds=[];angular.forEach(rItem,function(a,i){a.areaId&&areaIds.push(a.areaId)});var data={areaRelationType:$scope.areaType,refId:$scope.relateId,areaIds:areaIds};contentService.saveVideoArea(data).then(function(resp){$scope.closeThisDialog(resp),1==$scope.areaType?contentService.setName("video").getList():0==$scope.areaType&&contentService.setName("vod").getList()},function(error){$scope.errorMessage="code "+error.data.code+":"+error.data.message})}}])}),define("modules/oms/content/epg",["angularAMD","modules/oms/content/epgService","Session"],function(angularAMD){"use strict";angularAMD.controller("EpgCtrl",["$scope","EpgService","Session","$controller","$stateParams","APP_CONFIG","$state",function($scope,EpgService,Session,$controller,$stateParams,config,$state){$scope.dataConfig={edit:{template:"modules/oms/content/epgEdit.html",data:{title:"编辑EPG"},controller:"EpgEditCtrl"},create:{template:"modules/oms/content/epgEdit.html",data:{title:"新增EPG",is_create:!0,item:{}},controller:"EpgEditCtrl"}},$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=EpgService.setName("video").setHttpBaseUrl(config.epgBaseUrl),$scope.methods=$state.current.data.methods,$scope.$state=$state,"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage),$scope.typeSource={1:"tvsou",2:"手工上传",3:"CIBN"}}])}),define("modules/oms/content/epgEdit",["angularAMD","jquery","modules/oms/content/service"],function(angularAMD,$){"use strict";angularAMD.controller("EpgEditCtrl",function($scope,EpgService){var epgEditCtrl=$scope.epgEditCtrl={};$scope.errorMessage="",$scope.channelList=[],$scope.title=$scope.ngDialogData.title;var is_create=$scope.ngDialogData.is_create,epg=$scope.epg=$scope.ngDialogData.item,id=$scope.epg.thirdId,fromSrc=$scope.epg.epgSource;null==epg.id&&($scope.ngDialogData.item={}),epgEditCtrl.checkCloseDialog=function(){$scope.errorMessage="",$scope.submitted=!0,EpgService.isEmptyObject($scope.myform)||EpgService.saveEpg(epg,$scope.uploadfile,$scope).then(function(data){$scope.closeThisDialog(data)},function(error){$scope.submitStatus=!1,$scope.errorMessage=error})},is_create&&(epg.epgSource=2);var tempName="";epgEditCtrl.refreshChannels=function(name){angular.isUndefined(id)?EpgService.setName("thirdVideo").getChannelList(name,epg.epgSource).then(function(resp){$scope.channelList=resp.data.rows},function(error){$scope.errorMessage="code "+error.data.code+":"+error.data.message}):EpgService.getChoiceName(id).then(function(resp){tempName=resp.data.thirdName,epg.epgSource==resp.data.fromSrc&&""==name?name=tempName:$scope.epg.thirdId="",EpgService.setName("thirdVideo").getChannelList(name,epg.epgSource).then(function(resp){$scope.channelList=resp.data.rows,angular.forEach($scope.channelList,function(obj,e){obj.id==id&&obj.fromSrc==fromSrc?$scope.epg.thirdId=$scope.channelList[e].id:obj.fromSrc!==fromSrc&&($scope.epg.thirdId="")})},function(error){$scope.errorMessage="code "+error.data.code+":"+error.data.message})},function(){})},$scope.selectedRanges=[]})}),define("modules/oms/content/epgService",["angularAMD","BaseService","jquery"],function(angularAMD,BaseService,$){"use strict";angularAMD.service("EpgService",["APP_CONFIG","$http","$q",function(config,$http,$q){var mapping={video:{id:"videoId",epgSource:"fromSrc",channelName:"videoName",thirdId:"thirdId",createdAt:"createdAt",updatedAt:"updatedAt",epgLastTime:"epgLastTime"},epg:{id:"epgId",programName:"epgName",showId:"showId",showName:"showName",startDate:"startDate",startTime:"startTime",userId:"userId",videoId:"videoId",createdAt:"createdAt",updatedAt:"updatedAt"},thirdVideo:{id:"thirdId",name:"thirdName",fromSrc:"fromSrc",createdAt:"createdAt",updatedAt:"updatedAt"}},EpgService=new BaseService(config,$http,$q,mapping);return EpgService.getChannelList=function(name,fromSrc){var that=EpgService,params={name:name,fromSrc:fromSrc};params=that.changeFromLocalColumns(params);var d=$q.defer();return $http({url:config.epgBaseUrl+"/"+that.name+"/index",method:"GET",header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},params:params,withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp),EpgService.setName("video")},function(error){d.reject(error)}),d.promise},EpgService.getChoiceName=function(id){var d=$q.defer();return $http({url:config.epgBaseUrl+"/thirdVideo/show/"+id,method:"GET",header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},EpgService.saveEpg=function(item,uploadfile,scope){var that=EpgService,method="",url="",name=that.name;scope.submitStatus=!0,_.isUndefined(item.id)?(method="POST",url=that.httpBaseUrl+"/"+name+"/create"):(method="POST",url=that.httpBaseUrl+"/"+name+"/update/"+item.id),item=that.changeFromLocalColumns(item);var formData=new FormData;return 2==item.fromSrc&&formData.append("upload",uploadfile),angular.forEach(item,function(v,k){formData.append(k,v)}),that.$http({url:url,method:method,headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":void 0},data:formData,withCredentials:!0})},EpgService}])}),define("modules/oms/content/program",["angularAMD","modules/oms/content/epgService","Session"],function(angularAMD){"use strict";angularAMD.controller("ProgramCtrl",["$scope","EpgService","Session","$controller","APP_CONFIG","$stateParams","$state",function($scope,EpgService,Session,$controller,config,$stateParams,$state){$scope.dataConfig={edit:{template:"modules/oms/content/programEdit.html",data:{title:"编辑节目"},controller:"ProgramEditCtrl"},create:{template:"modules/oms/content/programEdit.html",data:{title:"新增节目单",item:{},isCreate:!0},controller:"ProgramEditCtrl"}},$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=EpgService.setName("epg").setHttpBaseUrl(config.epgBaseUrl),$scope.searchParams.videoId=$stateParams.videoId,$scope.methods=$state.current.data.methods,"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage,$scope.searchParams),$scope.ids=[],$scope.selectAll=!1,$scope.itemCtrl.search=function(){$scope.searchParams.startTime=angular.copy($scope.searchParams.time),$scope.searchParams.startTime=Math.floor(Date.parse($scope.searchParams.startTime)/1e3),$scope.getResultsPage(1,$scope.searchParams)},$scope.route()}])}),define("modules/oms/content/programEdit",["angularAMD","modules/oms/content/service"],function(angularAMD){"use strict";angularAMD.controller("ProgramEditCtrl",function($scope,EpgService,$stateParams){var programEditCtrl=$scope.programEditCtrl={};$scope.errorMessage="",$scope.title=$scope.ngDialogData.title;var program=$scope.program=$scope.ngDialogData.item;program.videoId=$stateParams.videoId;var isCreate=$scope.ngDialogData.isCreate;isCreate?$scope.program.startTime=new Date:$scope.program.startTime=new Date(1e3*parseInt($scope.program.startTime)),programEditCtrl.checkCloseDialog=function(){$scope.errorMessage="",$scope.submitted=!0;var data=angular.copy(program);data.startTime=Math.floor(Date.parse(program.startTime)/1e3),EpgService.saveItem(data,$scope).then(function(data){1==isCreate&&($scope.ngDialogData.item.programName=""),$scope.closeThisDialog(data),$scope.submitStatus=!1},function(error){$scope.errorMessage="code "+error.data.code+":"+error.data.message,$scope.submitStatus=!1})}})}),define("modules/oms/content/service",["angularAMD","BaseService"],function(angularAMD,BaseService){"use strict";angularAMD.service("contentService",["APP_CONFIG","$http","$q",function(config,$http,$q){var mapping={video:{id:"videoId",name:"videoName",videoType:"videoType",description:"description",videoDuration:"videoDuration",videoStatus:"videoStatus",area:"area",urlSource:"urlSource",videoSize:"videoSize",firstChar:"firstChar",videoOfflinetime:"videoOfflinetime",videoOnlinetime:"videoOnlinetime",score:"score",videoRecord:"videoRecord",videoEpg:"videoEpg",images:"images",videoUrl:"videoUrl",userId:"userId",videoCp:"videoCp",categoryList:"videoCategory",videoTag:"videoTag",videoApp:"appRelation",createdAt:"createdAt",chargeType:"chargeType",chargeTypeName:"chargeTypeName",updatedAt:"updatedAt",videoImage:"videoImage",videoShareImage:"videoShareImage",videoTvImage:"videoTvImage",vip:"vip",relationEpg:"relationEpg",areaId:"areaId"},liverSource:{sourceId:"lsId",sourceName:"lsName",location:"location"},area:{id:"areaId",name:"areaName"},videoEpg:{id:"videoId",name:"videoName",videoEpgSrc:"videoEpgSrc",userId:"userId",epgVideoId:"epgVideoId",createdAt:"createdAt",updatedAt:"updatedAt"},category:{id:"categoryId",name:"categoryName",userId:"userId",createdAt:"createdAt",updatedAt:"updatedAt",categoryType:"categoryType"},cps:{id:"cpId",cpStatus:"cpStatus",sortNum:"sortNum",userId:"userId",name:"cpName",cpImage:"cpImage",cpUrl:"cpUrl",cpDescription:"cpDescription",createdAt:"createdAt",updatedAt:"updatedAt"},program:{id:"epgId",programName:"epgName",showId:"showId",columnName:"showName",startDate:"startDate",startTime:"startTime",userId:"userId",videoId:"videoId",createdAt:"createdAt",updatedAt:"updatedAt"},vod:{id:"videoId",videoName:"videoName",videoType:"videoType",fromSrc:"fromSrc",description:"description",videoStatus:"videoStatus",isDownload:"isDownload",createdAt:"createdAt",updatedAt:"updatedAt",showAttribute:"showAttribute",offlineNum:"offlineNum",onlineNum:"onlineNum",userId:"userId",images:"images",chargeType:"chargeType",name:"chargeTypeName",score:"score",introduction:"intro",recommendation:"recomm",vip:"vip",areaId:"areaId"},vodurls:{id:"urlId",title:"title",location:"location",urlStatus:"urlStatus",urlSort:"urlSort",isDownload:"isDownload",duration:"duration",urlType:"urlType",vip:"vip"},videoUrl:{id:"urlId",title:"title",userId:"userId",videoId:"videoId",location:"location",urlStatus:"urlStatus",urlType:"urlType",isDownload:"isDownload",createdAt:"createdAt",updatedAt:"updatedAt",vip:"vip"},property:{id:"propertyId",propertyName:"propertyName",type:"propertyType",userId:"userId",createdAt:"createdAt",updatedAt:"updatedAt",typeName:"typeName",isAll:"isAll"},propertyValue:{id:"refId",propertyName:"propertyName",propertyId:"propertyId",type:"type",value:"value",valueId:"valueId",isAll:"isAll"},tag:{id:"tagId",name:"tagName",userId:"userId",tagPid:"tagPid",tagOrigin:"tagOrigin",type:"tagType",createdAt:"createdAt",updatedAt:"updatedAt",isAll:"isAll"},videoTag:{videoTagId:"videoTagId",id:"videoId",tagId:"tagId",userId:"userId",tagName:"tagName",isAll:"isAll"},apps:{appsId:"appsId",appsAppId:"appsAppId",appsAppVersion:"appsAppVersion",appsUserId:"appsUserId",appsCreatedAt:"appsCreatedAt",appsDescription:"appsDescription",appsIsAds:"appsIsAds",appsIsReview:"appsIsReview",appsIsUpdate:"appsIsUpdate",appsTargetVersion:"appsTargetVersion",appsUpdateMessage:"appsUpdateMessage",appsAppSource:"appsAppSource",appsAppOs:"appsAppOs",appsUpdatedAt:"appsUpdatedAt",userName:"userName",isAll:"isAll",appKey:"appKey",appKeyName:"appKeyName"},appRelation:{appRelationId:"appRelationId",refId:"refId",id:"appId",userId:"userId",type:"type",targetId:"targetId",version:"appsAppVersion",name:"appsAppOs",noAppId:"noAppId",appKeyName:"appKeyName"},bulkurlonline:{ids:"ids"},market:{id:"id",marketId:"marketId",videoId:"videoId",name:"marketName",note:"marketNote",createdAt:"createdAt",updatedAt:"updatedAt"},marketRelation:{videoId:"videoId",marketId:"marketId",areaId:"areaId",appKey:"appKey",time:"time"}},contentService=new BaseService(config,$http,$q,mapping);return contentService.editData=function(id){var that=this,d=that.$q.defer();return that.$http({url:that.httpBaseUrl+"/video/show/"+id,method:"GET",header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data),d.resolve(resp)},function(error){d.reject(error)}),d.promise},contentService.videoApp=function(id){var that=contentService,method="",url="";return method="GET",url=that.httpBaseUrl+"/video/videoappkey/"+id,that.$http({url:url,method:method,withCredentials:!0})},contentService.getSourceList=function(pageNumber,params){var that=this,d=that.$q.defer();return params=params?that.changeFromLocalColumns(params):{},params.currentPage=pageNumber,that.$http({url:that.sourceServeUrl+"/"+that.name,method:"GET",params:params,header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/json"},withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},contentService.showSourceList=function(id){contentService.setHttpBaseUrl(config.sourceServeUrl);var that=this,d=that.$q.defer();return that.$http({url:that.httpBaseUrl+"/liverSource/show/"+id,method:"GET",header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},contentService.getChargetype=function(id){var that=this,d=that.$q.defer();return that.$http({url:that.httpBaseUrl+"/video/chargetype",method:"GET",header:{Authorization:"Basic fdfwoeigjiewoe",
"Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},contentService.showVideoCharge=function(id){var that=contentService,method="",url="",d=that.$q.defer();return method="GET",url=that.httpBaseUrl+"/vod/show/"+id,that.$http({url:url,method:method,withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},contentService.editShow=function(id){var that=this,d=that.$q.defer();return that.$http({url:that.httpBaseUrl+"/show/"+id,method:"GET",header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},contentService.getAreaList=function(){var that=contentService,method="GET",url=that.areaUrl+"/area/index";return that.$http({url:url,method:method,withCredentials:!0})},contentService.getCityList=function(params){var url,that=contentService,method="GET";return url=params?that.areaUrl+"/city/index?id="+params:that.areaUrl+"/city/index",that.$http({url:url,method:method,withCredentials:!0})},contentService.getVideo=function(id){var that=contentService,method="",url="",d=that.$q.defer();return method="GET",url=that.httpBaseUrl+"/vod/vodurls/"+id,that.$http({url:url,method:method,withCredentials:!0}).then(function(resp){resp.data=that.changeToLocalColumns(resp.data,mapping.vodurls),d.resolve(resp)},function(error){d.reject(error)}),d.promise},contentService.showVideo=function(item){var that=contentService,method="",url="",d=that.$q.defer();return method="GET",url=that.httpBaseUrl+"/videoUrl/show/"+item.id,that.$http({url:url,method:method,withCredentials:!0}).then(function(resp){resp.data=that.changeToLocalColumns(resp.data,mapping.videoUrl),d.resolve(resp)},function(error){d.reject(error)}),d.promise},contentService.saveVideo=function(item){var that=this,method="",url="";return _.isUndefined(item.id)||(method="PATCH",url=that.httpBaseUrl+"/videoUrl/update/"+item.id),item=that.changeFromLocalColumns(item,mapping.videoUrl),that.$http({url:url,method:method,data:item,withCredentials:!0})},contentService.saveVideosOn=function(ids){var that=this,method="",url="";return _.isUndefined(ids)||(method="PATCH",url=that.httpBaseUrl+"/vod/bulkurlonline/"+ids),that.$http({url:url,method:method,data:ids,withCredentials:!0})},contentService.saveVideosOff=function(ids){var that=this,method="",url="";return _.isUndefined(ids)||(method="PATCH",url=that.httpBaseUrl+"/vod/bulkurloffline/"+ids),that.$http({url:url,method:method,data:ids,withCredentials:!0})},contentService.upVideoStatus=function(item){var that=this;return that.$http({url:that.httpBaseUrl+"/video/changestatus/"+item.id,method:"PATCH",data:item,withCredentials:!0})},contentService.upSelectVideoStatus=function(item){var that=this;return that.$http({url:that.httpBaseUrl+"/video/allstatus/"+item.id,method:"PATCH",data:item,withCredentials:!0})},contentService.getMarketList=function(){var that=this,method="GET",url="",d=that.$q.defer();return url=that.httpBaseUrl+"/market/index",that.$http({url:url,method:method,params:{isAll:1},withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows,mapping.market),d.resolve(resp)},function(error){d.reject(error)}),d.promise},contentService.getMarketRelation=function(id){var that=this,method="GET",url="",d=that.$q.defer();return url=that.httpBaseUrl+"/marketRelation/index",that.$http({url:url,method:method,params:{videoId:id},withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows,mapping.marketRelation),d.resolve(resp)},function(error){d.reject(error)}),d.promise},contentService.saveVideos=function(item){var that=this,method="",url="";return _.isUndefined(item)||(method="PATCH",url=that.httpBaseUrl+"/videoUrl/update/"),item=that.changeFromLocalColumns(item,mapping.videoUrl),that.$http({url:url,method:method,data:item,withCredentials:!0})},contentService.getTagsByVideoId=function(id){var that=this,method="GET",url="",d=that.$q.defer();return url=that.httpBaseUrl+"/videoTag/index",that.$http({url:url,method:method,params:{videoId:id},withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},contentService.getAppsByVideoId=function(id){var that=this,method="GET",url="",d=that.$q.defer();return url=that.httpBaseUrl+"/appRelation/index",that.$http({url:url,method:method,params:{refId:id,isAll:1},withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},contentService.saveTag=function(item){var that=this,method="",url="";return _.isUndefined(item.id)||(method="PATCH",url=that.httpBaseUrl+"/videoTag/update/"+item.id),item=that.changeFromLocalColumns(item,mapping.videoTag),that.$http({url:url,method:method,data:item,withCredentials:!0})},contentService.saveApp=function(item){var that=this,method="",url="";return _.isUndefined(item.id)||(method="PATCH",url=that.httpBaseUrl+"/appRelation/update/"+item.id),item.appRelationType=0,that.$http({url:url,method:method,data:item,withCredentials:!0})},contentService.saveVideoArea=function(item){var that=this,method="",url="";return _.isUndefined(item.refId)||(method="PATCH",url=that.httpBaseUrl+"/areaRelation/arearef/"),that.$http({url:url,method:method,data:item,withCredentials:!0})},contentService.getVideoArea=function(id,type){var url=config.httpBaseUrl+"/areaRelation/index",that=this,d=that.$q.defer();return $http({url:url,method:"GET",params:{isAll:1,areaRelationType:type,refId:id},withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},contentService.deleteShow=function(id){var that=this;that.name;return that.$http({url:that.httpBaseUrl+"/videoUrl/dels/"+id.toString(),method:"DELETE",header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0})},contentService.getEpgItem=function(pageNumber,params){var that=this,d=that.$q.defer();return params=params?that.changeFromLocalColumns(params):{},params.currentPage=pageNumber,that.$http({url:that.epgBaseUrl+"/video/index",method:"GET",params:params,withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},contentService}])}),define("modules/oms/content/show",["angularAMD","modules/oms/content/service","Session"],function(angularAMD){"use strict";angularAMD.controller("ShowCtrl",["$scope","contentService","Session","$controller","$stateParams","APP_CONFIG","ngDialog","$state",function($scope,contentService,Session,$controller,$stateParams,config,ngDialog,$state){$controller("BaseCtrl",{$scope:$scope}),$scope.dataConfig={edit:{template:"modules/oms/content/vodEdit.html",data:{title:"编辑栏目"},controller:"VodEditCtrl"},area:{template:"modules/oms/content/channelOption.html",data:{title:"所属地域",objName:"area",type:5},controller:"changeCtrl"}},$scope.itemService=contentService.setName("vod"),$scope.methods=$state.current.data.methods,$scope.$state=$state,"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage),contentService.getAllArea().then(function(resp){$scope.areaList=resp.data.rows},function(){});var objModel=[{template:"modules/oms/content/showOption.html",data:{title:"选择标签",objName:"tag",name:"videoTag",type:2},controller:"ShowOptionCtrl"},{template:"modules/oms/content/showOption.html",data:{title:"选择应用",objName:"apps",name:"appRelation",type:0},controller:"ShowOptionCtrl"},{template:"modules/oms/content/showOption.html",data:{title:"计费类型",objName:"vod"},controller:"ShowOptionCtrl"},{template:"modules/oms/content/showOption.html",data:{title:"所属地域",objName:"area"},controller:"ShowOptionCtrl"}],showCtrl=$scope.showCtrl={};$scope.typeSrc={1:"自制",2:"第三方"},$scope.typeState={1:"上线",2:"下线"},showCtrl.update=function(item,states){contentService.saveItem({id:item.id,videoStatus:states},$scope).then(function(e){$scope.submitStatus=!1,item.videoStatus=e.data.videoStatus},function(e){$scope.submitStatus=!1})},showCtrl.isDown=function(item,states){contentService.saveItem({id:item.id,isDownload:states},$scope).then(function(e){$scope.submitStatus=!1,item.isDownload=e.data.isDownload},function(e){$scope.submitStatus=!1})},showCtrl.changeItem=function(index,id){objModel[index].data.isAll=1,angular.isDefined(id)&&(objModel[index].data.id=id);var ngdialog=ngDialog.open(objModel[index]);ngdialog.closePromise.then(function(){contentService.setName("vod"),$scope.getResultsPage($scope.currentPage)})},contentService.getChargetype().then(function(e){$scope.chargeTypes=[],angular.forEach(e.data,function(value,key){$scope.chargeTypes.push({id:value,name:value})})},function(error){}),showCtrl.getVideo=function(id){var ngdialog=ngDialog.open({template:"modules/oms/content/showEdit.html",data:{title:"视频列表",id:id},controller:"ShowEditCtrl"});ngdialog.closePromise.then(function(data){$scope.getResultsPage($scope.currentPage)})},showCtrl.showVideo=function(id){contentService.getVideo(id).then(function(resp){$scope.urlId=resp.data[0].id;ngDialog.open({template:"modules/oms/content/showVideo.html",data:{title:"视频",id:id,urlId:$scope.urlId},controller:"ShowVideoCtrl"})},function(error){$scope.urlId=0,alert("无播放数据！")})},$scope.itemCtrl.search=function(){$scope.itemService=contentService.setName("vod"),$scope.getResultsPage(1,$scope.searchParams)}}])}),define("modules/oms/content/showEdit",["angularAMD","modules/oms/content/service"],function(angularAMD){"use strict";angularAMD.controller("ShowEditCtrl",function($scope,contentService,StarsUtils){function online(){var ids=$scope.ids.toString();$scope.status&&contentService.saveVideosOn(ids).then(function(){getList(),StarsUtils.alert("上线成功")},function(){StarsUtils.alert("上线失败")})}function offline(){var ids=$scope.ids.toString();contentService.saveVideosOff(ids).then(function(){getList(),StarsUtils.alert("下线成功")},function(){StarsUtils.alert("下线失败")})}function getList(){contentService.getVideo(id).then(function(resp){$scope.items=resp.data},function(){})}var showEditCtrl=$scope.showEditCtrl={};$scope.errorMessage="",$scope.title=$scope.ngDialogData.title;var id=($scope.vod=$scope.ngDialogData.item,$scope.id=$scope.ngDialogData.id);showEditCtrl.editAllline=function(index){$scope.ids=[],$scope.status=[];for(var i in $scope.items)$scope.ids.push($scope.items[i].id),$scope.status.push($scope.items[i].urlStatus);1==index&&online(),0==index&&offline()},showEditCtrl.changeDownload=function(item,states){contentService.saveVideo({id:item.id,isDownload:states}).then(function(e){getList()},function(){})},showEditCtrl.changeState=function(item,states){contentService.saveVideo({id:item.id,urlStatus:states}).then(function(e){getList()},function(){})},showEditCtrl.changeVip=function(item,states){contentService.saveVideo({id:item.id,vip:states}).then(function(e){getList()},function(){})},showEditCtrl.deleteShow=function(id){StarsUtils.confirm("确定删除吗？","删除","不删除").then(function(){contentService.deleteShow(id).then(function(list){getList(),StarsUtils.alert("删除成功")},function(reason){StarsUtils.alert("删除失败:"+reason)})})},getList()})}),define("modules/oms/content/showOption",["angularAMD","lodash","modules/oms/content/service"],function(angularAMD,_){"use strict";angularAMD.controller("ShowOptionCtrl",["$scope","contentService","Session","$controller","$state","ngDialog",function($scope,contentService,Session,$controller,$state,ngDialog){function getList(){$scope.itemService=contentService.setName($scope.ngDialogData.objName),$scope.getResultsPage($scope.currentPage,$scope.searchParams,setTagList)}function setTagList(){$scope.videoTagList=[],$scope.videoAppList=[],"选择标签"==$scope.title&&($scope.itemService=contentService.setName("videoTag"),$scope.itemService.getTagsByVideoId(videoid).then(function(resp){$scope.videoTagList=resp.data.rows,_.map($scope.items,function(item){_.find($scope.videoTagList,{tagId:item.id})&&$scope.ckMoreTag(item.id)})},function(error){$scope.errorMessage="code "+error.data.code+":"+error.data.message})),"选择应用"==$scope.title&&($scope.itemService=contentService.setName("appRelation"),$scope.itemService.getAppsByVideoId(refId).then(function(resp){$scope.videoAppList=resp.data.rows,_.map($scope.items,function(item){_.find($scope.videoAppList,{appId:item.id})&&$scope.ckMoreApp(item.id)})},function(error){$scope.errorMessage="code "+error.data.code+":"+error.data.message}))}var showOptionCtrl=$scope.showOptionCtrl={};$scope.methods=$state.current.data.methods,$controller("BaseCtrl",{$scope:$scope});var charge=$scope.charge={};$scope.title=$scope.ngDialogData.title;var videoid=$scope.ngDialogData.id,refId=$scope.ngDialogData.id,vod=$scope.vod={id:videoid};$scope.app={id:refId},$scope.typeApp="show",$scope.searchParams.type=$scope.ngDialogData.type,$scope.searchParams.isAll=1,angular.isUndefined($scope.vod.tagId)&&($scope.vod.tagId=[]),angular.isUndefined($scope.app.appId)&&($scope.app.appId=[]),$scope.ckMoreTag=function(id){$scope.vod.tagId.indexOf(id)>-1?$scope.vod.tagId.splice($scope.vod.tagId.indexOf(id),1):$scope.vod.tagId.push(id)},$scope.ckMoreApp=function(id){$scope.app.appId.indexOf(id)>-1?$scope.app.appId.splice($scope.app.appId.indexOf(id),1):$scope.app.appId.push(id)},showOptionCtrl.checkCloseDialog=function(){$scope.errorMessage="",$scope.submitted=!0,"选择标签"==$scope.title&&contentService.saveTag(vod).then(function(data){$scope.closeThisDialog(data)},function(error){$scope.errorMessage="code "+error.data.code+":"+error.data.message}),"选择应用"==$scope.title&&contentService.saveApp($scope.app).then(function(data){$scope.closeThisDialog(data)},function(error){$scope.errorMessage="code "+error.data.code+":"+error.data.message}),"计费类型"==$scope.title&&($scope.submitStatus=!0,$scope.itemService=contentService.setName("vod"),$scope.charge.chargeType=charge.chargeType.id,$scope.charge.id=$scope.ngDialogData.id,contentService.saveItem($scope.charge,$scope).then(function(resp){$scope.closeThisDialog(resp),$scope.submitStatus=!1},function(error){$scope.submitStatus=!1,$scope.errorMessage="code "+error.data.code+":"+error.data.message}))},contentService.getChargetype().then(function(e){$scope.chargelList=[],angular.forEach(e.data,function(e){$scope.chargelList.push({id:e.id,name:e.title})}),contentService.showVideoCharge(refId).then(function(resp){for(var i in $scope.chargelList)$scope.chargelList[i].id==resp.data.chargeType&&(charge.chargeType=$scope.chargelList[i])},function(error){$scope.errorMessage="code "+error.data.code+":"+error.data.message})},function(error){$scope.errorMessage="code "+error.data.code+":"+error.data.message}),getList()}])}),define("modules/oms/content/showVideo",["angularAMD","modules/oms/content/service"],function(angularAMD){"use strict";angularAMD.controller("ShowVideoCtrl",function($scope,contentService,$sce){function play(){_self.config={autoHide:!1,autoHideTime:3e3,autoPlay:!1,sources:[{src:$sce.trustAsResourceUrl($scope.location),type:"video/mp4"}],loop:!1}}$scope.errorMessage="",$scope.title=$scope.ngDialogData.title;var urlId=$scope.ngDialogData.urlId,location=$scope.ngDialogData.location,vodurls=$scope.vodurls={id:urlId,location:location};contentService.showVideo(vodurls).then(function(resp){$scope.location=resp.data.location,play()},function(){});var _self=this;this.currentTime=0,this.totalTime=0,this.state=null,this.volume=1,this.isCompleted=!1,this.API=null,this.onPlayerReady=function(API){_self.API=API}})}),define("modules/oms/content/vodEdit",["angularAMD","modules/oms/content/service"],function(angularAMD){"use strict";angularAMD.controller("VodEditCtrl",function($scope,contentService,StarsUtils){var vodEditCtrl=$scope.vodEditCtrl={},submitted=!1;$scope.errorMessage="",$scope.title=$scope.ngDialogData.title;var vod=$scope.vod=$scope.ngDialogData.item;"undefined"==typeof vod.vip&&(vod.vip=0),$scope.typeSrc={1:"自制",2:"第三方"},$scope.typeState={1:"上线",2:"下线"},vodEditCtrl.checkCloseDialog=function(){$scope.errorMessage="",submitted=!0,contentService.saveItem(vod,$scope).then(function(data){$scope.submitStatus=!1,$scope.closeThisDialog(data)},function(error){$scope.submitStatus=!1,$scope.errorMessage=error})}})}),define("modules/oms/cps/cpVideo",["angularAMD","modules/oms/cps/service","Session"],function(angularAMD){"use strict";angularAMD.controller("CpsVideoCtrl",["$scope","CpsService","Session","$controller","$state","ngDialog","$stateParams",function($scope,CpsService,Session,$controller,$state,ngDialog,$stateParams){$scope.methods=$state.current.data.methods,$scope.dataConfig={create:{template:"modules/oms/cps/cpVideoEdit.html",data:{title:"新增CP频道",item:{}},controller:"CpsVideoEditCtrl"}},$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=CpsService.setName("cpVideo"),$scope.searchParams.cpId=$stateParams.cpId,$scope.route(),"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage,$scope.searchParams),$scope.itemCtrl.ordersNum=function(){var list=[],eles=document.getElementsByClassName("sortInput");angular.forEach(eles,function(ele){list.push({cpVideoId:ele.getAttribute("data-id"),cpVideoSort:ele.value})}),$scope.itemService.saveOrder("cpVideoSort",list).then(function(){$scope.getResultsPage($scope.currentPage,$scope.searchParams)})}}])}),define("modules/oms/cps/cpVideoEdit",["angularAMD","modules/oms/cps/service"],function(angularAMD){"use strict";angularAMD.controller("CpsVideoEditCtrl",function($scope,CpsService,$stateParams,StarsUtils){var cpsVideoEditCtrl=$scope.cpsVideoEditCtrl={},submitted=!1;$scope.errorMessage="",$scope.title=$scope.ngDialogData.title,$scope.videoList=[],cpsVideoEditCtrl.refreshVideos=function(name){CpsService.getVideoList(name).then(function(resp){$scope.videoList=resp.data.rows,$scope.id=resp.data.rows.id},function(error){})};var id=$stateParams.cpId,cpVideo=$scope.cpVideo={cpId:id};cpsVideoEditCtrl.checkCloseDialog=function(){return $scope.errorMessage="",submitted=!0,angular.isUndefined(cpVideo.videoId)?void StarsUtils.alert("频道不存在！"):($scope.submitStatus=!0,void CpsService.saveCpVideo(cpVideo).then(function(data){$scope.submitStatus=!1,$scope.closeThisDialog(data)},function(error){$scope.submitStatus=!1,$scope.errorMessage="code "+error.data.code+":"+error.data.message}))}})}),define("modules/oms/cps/cps",["angularAMD","modules/oms/cps/service","Session"],function(angularAMD,BaseCtrl){"use strict";angularAMD.controller("CpsCtrl",["$scope","CpsService","Session","$controller","$state","ngDialog",function($scope,CpsService,Session,$controller,$state,ngDialog){$scope.methods=$state.current.data.methods,$scope.$state=$state,$scope.dataConfig={edit:{template:"modules/oms/cps/cpsEdit.html",data:{title:"编辑CP"},controller:"CpsEditCtrl"},create:{template:"modules/oms/cps/cpsEdit.html",data:{title:"新增CP",item:{}},controller:"CpsEditCtrl"},area:{template:"modules/oms/content/channelOption.html",data:{title:"所属地域",objName:"area",type:5},controller:"changeCtrl"}},$controller("BaseCtrl",{$scope:$scope}),$scope.searchParams.isAll=1,CpsService.getAllArea().then(function(resp){$scope.areaList=resp.data.rows},function(){}),"undefined"!=typeof $scope.methods.index.name&&($scope.itemService=CpsService.setName("cps"),$scope.getResultsPage($scope.currentPage,$scope.searchParams)),$scope.itemCtrl.ordersNum=function(){var els=document.getElementsByClassName("sortInput"),list=[];angular.forEach(els,function(el,idx){list.push({cpId:el.getAttribute("data-id"),sortNum:el.value})}),$scope.itemService.saveOrder("cpSort",list).then(function(data){$scope.getResultsPage($scope.currentPage)},function(error){$scope.errorMessage="code "+error.data.code+":"+error.data.message})}}])}),define("modules/oms/cps/cpsEdit",["angularAMD","modules/oms/cps/service"],function(angularAMD){"use strict";angularAMD.controller("CpsEditCtrl",function($scope,CpsService){var cpsEditCtrl=$scope.cpsEditCtrl={};$scope.errorMessage="",$scope.title=$scope.ngDialogData.title;var cp=$scope.cp=$scope.ngDialogData.item;null==cp.id&&($scope.ngDialogData.item={}),cpsEditCtrl.checkCloseDialog=function(){$scope.errorMessage="",$scope.submitted=!0,CpsService.isEmptyObject($scope.myform)||CpsService.saveItem(cp,$scope).then(function(data){$scope.closeThisDialog(data),$scope.submitStatus=!1},function(error){$scope.submitStatus=!1,$scope.errorMessage="code "+error.data.code+":"+error.data.message})}})}),define("modules/oms/cps/service",["angularAMD","BaseService"],function(angularAMD,BaseService){"use strict";angularAMD.service("CpsService",["APP_CONFIG","$http","$q",function(config,$http,$q){var mapping={cps:{id:"cpId",cpStatus:"cpStatus",sortNum:"sortNum",userId:"userId",userName:"userName",cpName:"cpName",cpImage:"cpImage",cpUrl:"cpUrl",cpDescription:"cpDescription",createdAt:"createdAt",updatedAt:"updatedAt",isAll:"isAll",areaId:"areaId"},cpVideo:{id:"cpVideoId",videoId:"videoId",cpId:"cpId",userId:"userId",cpVideoSort:"cpVideoSort",cpName:"cpName",userName:"userName",videoName:"videoName",createdAt:"createdAt",updatedAt:"updatedAt"},video:{id:"videoId",name:"videoName",videoType:"videoType",description:"description",videoStatus:"videoStatus",userId:"userId",createdAt:"createdAt",updatedAt:"updatedAt"}},cpsService=new BaseService(config,$http,$q,mapping);return cpsService.getVideoList=function(name){var that=this,params={name:name,sensor:!1};params=that.changeFromLocalColumns(params);var d=$q.defer();return $http({url:that.httpBaseUrl+"/video/index?isAll=1&videoStatus=1",method:"GET",header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},params:params,withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows,mapping.video),d.resolve(resp)},function(error){d.reject(error)}),d.promise},cpsService.saveCpVideo=function(item){var that=this,method="",url="",name=that.name;return _.isUndefined(item)||(method="POST",url=that.httpBaseUrl+"/"+name+"/create"),item=that.changeFromLocalColumns(item),that.$http({url:url,method:method,data:item,withCredentials:!0})},cpsService.saveOrder=function(ordername,list){var that=this,method="",url="",name=that.name;method="PATCH",url=that.httpBaseUrl+"/"+name+"/sort";var data={};return data[ordername]=list,that.$http({url:url,method:method,data:data,withCredentials:!0})},cpsService.checkExist=function(params){var that=this,d=$q.defer();return $http({url:that.httpBaseUrl+"/user/verifyname",method:"POST",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0,params:params}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},cpsService}])}),define("modules/oms/home/home",["angularAMD"],function(angularAMD){"use strict";angularAMD.controller("HomeCtrl",["$rootScope","$scope","$timeout",function($rootScope,$scope,$timeout){$scope.message="欢迎访问国广星空OMS后台管理系统",$scope.gotoState=function(state){}}])}),define("modules/oms/inteface/android",["angularAMD","modules/oms/inteface/service","Session"],function(angularAMD){"use strict";angularAMD.controller("androidCtrl",["$scope","intefaceService","Session","$controller","$state","ngDialog","StarsUtils",function($scope,intefaceService,Session,$controller,$state,ngDialog,StarsUtils){$scope.methods=$state.current.data.methods,$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=intefaceService.setName("android");var androidCtrl=$scope.androidCtrl={};androidCtrl.openApi=function(obj){intefaceService.getAndroidApi(obj.name,obj.version,obj.appKey).then(function(e){var tempwindow=window.open("_blank");tempwindow.location=e.data.url},function(error){alert(error.message)})},androidCtrl.init=function(){"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage)},androidCtrl.init()}])}),define("modules/oms/inteface/ios",["angularAMD","modules/oms/inteface/service","Session"],function(angularAMD){"use strict";angularAMD.controller("iosCtrl",["$scope","intefaceService","Session","$controller","$state","ngDialog","StarsUtils",function($scope,intefaceService,Session,$controller,$state,ngDialog,StarsUtils){$scope.methods=$state.current.data.methods,$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=intefaceService.setName("ios");var iosCtrl=$scope.iosCtrl={};iosCtrl.openApi=function(obj){intefaceService.getIosApi(obj.name,obj.version,obj.appKey).then(function(e){var tempwindow=window.open("_blank");tempwindow.location=e.data.url},function(error){alert(error.message)})},iosCtrl.init=function(){"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage)},iosCtrl.init()}])}),define("modules/oms/inteface/server",["angularAMD","modules/oms/inteface/service","Session"],function(angularAMD){"use strict";angularAMD.controller("serverCtrl",["$scope","intefaceService","Session","$controller","$state","ngDialog","StarsUtils",function($scope,intefaceService,Session,$controller,$state,ngDialog,StarsUtils){$scope.methods=$state.current.data.methods,$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=intefaceService.setName("server");var serverCtrl=$scope.serverCtrl={};serverCtrl.openApi=function(){intefaceService.getServerApi().then(function(e){var tempwindow=window.open("_blank");tempwindow.location=e.data.url},function(error){alert(error.message)})},serverCtrl.init=function(){"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage)},serverCtrl.init()}])}),define("modules/oms/inteface/service",["angularAMD","BaseService"],function(angularAMD,BaseService){"use strict";angularAMD.service("intefaceService",["APP_CONFIG","$http","$q",function(config,$http,$q){var mapping={web:{id:"appsId",appid:"appsAppId",version:"appsAppVersion",appsUserId:"appsUserId",appsCreatedAt:"appsCreatedAt",appsDescription:"appsDescription",appsIsAds:"appsIsAds",appsIsReview:"appsIsReview",appsIsUpdate:"appsIsUpdate",appsTargetVersion:"appsTargetVersion",appsUpdateMessage:"appsUpdateMessage",appsAppSource:"appsAppSource",name:"appsAppOs",appsUpdatedAt:"appsUpdatedAt"},ios:{id:"appsId",appid:"appsAppId",version:"appsAppVersion",appsUserId:"appsUserId",appsCreatedAt:"appsCreatedAt",appsDescription:"appsDescription",appsIsAds:"appsIsAds",appsIsReview:"appsIsReview",appsIsUpdate:"appsIsUpdate",appsTargetVersion:"appsTargetVersion",appsUpdateMessage:"appsUpdateMessage",appsAppSource:"appsAppSource",name:"appsAppOs",appsUpdatedAt:"appsUpdatedAt",appKeyName:"appKeyName",appKey:"appKey"},android:{id:"appsId",appid:"appsAppId",version:"appsAppVersion",appsUserId:"appsUserId",appsCreatedAt:"appsCreatedAt",appsDescription:"appsDescription",appsIsAds:"appsIsAds",appsIsReview:"appsIsReview",appsIsUpdate:"appsIsUpdate",appsTargetVersion:"appsTargetVersion",appsUpdateMessage:"appsUpdateMessage",appsAppSource:"appsAppSource",name:"appsAppOs",appsUpdatedAt:"appsUpdatedAt",appKeyName:"appKeyName",appKey:"appKey"}},intefaceService=new BaseService(config,$http,$q,mapping);return intefaceService.getWebApi=function(){var d=$q.defer();return $http({url:config.httpBaseUrl+"/web/show",method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/json"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},intefaceService.getServerApi=function(){var d=$q.defer();return $http({url:config.httpBaseUrl+"/server/show",method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/json"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},intefaceService.getIosApi=function(name,version,appKey){var d=$q.defer();return $http({url:config.httpBaseUrl+"/ios/show?appOs="+name+"&appVer="+version+"&appKey="+appKey,method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/json"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},intefaceService.getAndroidApi=function(name,version,appKey){var d=$q.defer();return $http({url:config.httpBaseUrl+"/android/show?appOs="+name+"&appVer="+version+"&appKey="+appKey,method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/json"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},intefaceService}])}),define("modules/oms/inteface/web",["angularAMD","modules/oms/inteface/service","Session"],function(angularAMD){"use strict";angularAMD.controller("webCtrl",["$scope","intefaceService","Session","$controller","$state","ngDialog","StarsUtils",function($scope,intefaceService,Session,$controller,$state,ngDialog,StarsUtils){$scope.methods=$state.current.data.methods,$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=intefaceService.setName("web");var webCtrl=$scope.webCtrl={};webCtrl.openApi=function(){intefaceService.getWebApi().then(function(e){var tempwindow=window.open("_blank");tempwindow.location=e.data.url},function(error){alert(error.message)})},webCtrl.init=function(){"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage)},webCtrl.init()}])}),define("modules/oms/logs/log",["angularAMD","modules/oms/logs/service","Session"],function(angularAMD,BaseCtrl){"use strict";angularAMD.controller("LogCtrl",["$scope","LogService","Session","$controller","$state",function($scope,LogService,Session,$controller,$state){$scope.methods=$state.current.data.methods,$controller("BaseCtrl",{$scope:$scope}),$scope.typeStatus={0:"正常",1:"错误",2:"通知",3:"警告",4:"调试",5:"危险",6:"消息"},$scope.itemService=LogService.setName("log"),"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage,$scope.searchParams),$scope.searchParams.time=new Date("Thu Jul 30 2015 00:00:00 GMT+0800"),$scope.searchParams.endTimes=new Date,$scope.itemCtrl.search=function(){$scope.searchParams.createdAt=angular.copy($scope.searchParams.time),$scope.searchParams.endTime=angular.copy($scope.searchParams.endTimes),$scope.searchParams.createdAt=Math.floor(Date.parse($scope.searchParams.createdAt)/1e3),$scope.searchParams.endTime=Math.floor(Date.parse($scope.searchParams.endTime)/1e3),$scope.getResultsPage(1,$scope.searchParams)}}])}),define("modules/oms/logs/service",["angularAMD","BaseService"],function(angularAMD,BaseService){"use strict";angularAMD.service("LogService",["APP_CONFIG","$http","$q",function(config,$http,$q){var mapping={log:{id:"logsId",status:"logsStatus",url:"logsAction",description:"logsDescription",createdAt:"logsCreatedAt",name:"userName",endTime:"endTime"}},logService=new BaseService(config,$http,$q,mapping);return logService}])}),define("modules/oms/manage/account",["angularAMD","modules/oms/manage/service","utils","Session"],function(angularAMD){"use strict";angularAMD.controller("AccountCtrl",["$scope","ngDialog","usSpinnerService","StarsUtils","Session","$state","$controller","manageService",function($scope,ngDialog,usSpinnerService,StarsUtils,Session,$state,$controller,manageService){$scope.fallback=function(copy){window.prompt("Press cmd+c to copy the text below.",copy)},$scope.showMessage=function(){},$scope.methods=$state.current.data.methods,$scope.dataConfig={edit:{template:"modules/oms/manage/accountEdit.html",data:{title:"修改账号"},controller:"accountEditCtrl"},create:{template:"modules/oms/manage/accountEdit.html",data:{title:"新增账号",item:{}},controller:"accountEditCtrl"}},$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=manageService.setName("user"),$scope.init=function(){$scope.getResultsPage($scope.currentPage),manageService.getRoleForLogin().then(function(e){$scope.roles=e.data},function(error){})},"undefined"!=typeof $scope.methods.index.name&&$scope.init(),
$scope.route()}])}),define("modules/oms/manage/accountEdit",["angularAMD","modules/oms/manage/service"],function(angularAMD){"use strict";angularAMD.controller("accountEditCtrl",function($scope,$controller,manageService){var account,accountEditCtrl=$scope.accountEditCtrl={};$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=manageService.setName("user"),$scope.errorMessage="",$scope.title=$scope.ngDialogData.title,accountEditCtrl.init=function(){$scope.account=$scope.ngDialogData.item,$scope.userNameChecked="ok",account=angular.copy($scope.account),manageService.getRoleForLogin().then(function(e){$scope.roles=e.data,"undefined"==typeof $scope.account.id?($scope.account={},$scope.userRole=$scope.roles[0]):(manageService.getUserById($scope.account.id).then(function(e){$scope.account=e.data,$scope.account.id=$scope.account.userId,$scope.account.userPassword=""}),angular.forEach($scope.roles,function(val,e){val.roleId==$scope.account.roleId&&($scope.userRole=$scope.roles[e])}))},function(error){})},accountEditCtrl.isEmail=function(form){var reg=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;reg.test(form.userEmail.$viewValue)?delete form.$error.emailError:form.$error.emailError=!0},accountEditCtrl.ckPhone=function(form){/^1[3|4|5|8][0-9]\d{8,8}$/.test(form.userTelephone.$viewValue)?(delete $scope.phoneFormt,delete form.$error.phomeError):($scope.phoneFormt=!0,form.$error.phomeError=!0)},accountEditCtrl.checkCloseDialog=function(){$scope.errorMessage="",$scope.submitted=!0,manageService.isEmptyObject($scope.myform.$error)&&"ok"==$scope.userNameChecked&&(""==$scope.account.userPassword&&delete $scope.account.userPassword,$scope.account.roleId=angular.copy($scope.userRole.roleId),manageService.saveItem($scope.account,$scope).then(function(data){$scope.submitStatus=!1,$scope.closeThisDialog(data)},function(error){$scope.submitStatus=!1,$scope.errorMessage="code "+error.data.code+":"+error.data.message}))},accountEditCtrl.checkUserName=function(username){return account.userName==username&&""!=username&&"undefined"!=typeof username?void($scope.userNameChecked="ok"):void("undefined"!=typeof username&&manageService.checkExist({userName:username,userPersonName:""}).then(function(data){$scope.userNameChecked="no"},function(reason){$scope.userNameChecked="ok"}))},accountEditCtrl.init()})}),define("modules/oms/manage/permission",["angularAMD","modules/oms/manage/permissionService","Session"],function(angularAMD,BaseCtrl){"use strict";angularAMD.controller("PermissionCtrl",["$scope","PermissionService","Session","$controller","$state","ngDialog",function($scope,PermissionService,Session,$controller,$state,ngDialog){$scope.methods=$state.current.data.methods,$scope.dataConfig={edit:{template:"modules/oms/manage/permissionEdit.html",data:{title:"编辑权限"},controller:"PermissionEditCtrl"}},$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=PermissionService.setName("permissions"),"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage),$scope.route()}])}),define("modules/oms/manage/permissionEdit",["angularAMD","modules/oms/manage/service"],function(angularAMD){"use strict";angularAMD.controller("PermissionEditCtrl",function($scope,PermissionService){var permissionEditCtrl=$scope.permissionEditCtrl={},submitted=!1;$scope.errorMessage="",$scope.title=$scope.ngDialogData.title;var permission=$scope.permission=$scope.ngDialogData.item;permissionEditCtrl.checkCloseDialog=function(){$scope.errorMessage="",submitted=!0,PermissionService.saveItem(permission,$scope).then(function(data){$scope.submitStatus=!1,$scope.closeThisDialog(data)},function(error){$scope.submitStatus=!1,$scope.errorMessage="code "+error.data.code+":"+error.data.message})}})}),define("modules/oms/manage/permissionEdit__",["../module"],function(module){"use strict";module.controller("PermissionEditCtrl",function($scope,ManageService){var permissionEditCtrl=$scope.permissionEditCtrl={},submitted=!1;$scope.errorMessage="",$scope.title=$scope.ngDialogData.title;var perm=$scope.perm=$scope.ngDialogData.perm;permissionEditCtrl.checkCloseDialog=function(){$scope.errorMessage="",submitted=!0,ManageService.savePermission(perm).then(function(){$scope.closeThisDialog()},function(msg){$scope.errorMessage=msg})}})}),define("modules/oms/manage/permissionService",["angularAMD","BaseService"],function(angularAMD,BaseService){"use strict";angularAMD.service("PermissionService",["APP_CONFIG","$http","$q",function(config,$http,$q){var mapping={permissions:{id:"permissionId",permissionName:"permissionName",permissionControllerName:"permissionControllerName",permissionDisplayName:"permissionDisplayName"}},permissionService=new BaseService(config,$http,$q,mapping);return permissionService.getPermissionList=function(){return $http({url:config.httpBaseUrl+"/permissions/index",method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0})},permissionService}])}),define("modules/oms/manage/permission__",["../module","./service","utils"],function(module){"use strict";module.controller("PermissionCtrl",["$scope","ManageService","ngDialog","usSpinnerService","StarsUtils",function($scope,ManageService,ngDialog,usSpinnerService,StarsUtils){$scope.loading_list=!0,$scope.processing_delete=!1,$scope.search_error=!1;var permissionsCtrl=$scope.permissionsCtrl={};$scope.permissions=[];ManageService.getPermissions().then(function(data){ManageService.permissions=data,$scope.loading_list=!1,$scope.permissions=data},function(data){$scope.loading_list=!1,alert("error")}),permissionsCtrl.createNew=function(){ngDialog.open({template:"modules/oms/manage/permissionEdit.html",data:{title:"添加权限",perm:{}},controller:"PermissionEditCtrl"})},permissionsCtrl.editItem=function(perm){var ngdialog=ngDialog.open({template:"modules/oms/manage/permissionEdit.html",data:{title:"编辑权限",perm:perm},controller:"PermissionEditCtrl"});ngdialog.closePromise.then(function(data){ManageService.savePermission(data)})},permissionsCtrl.deleteItem=function(id,e){StarsUtils.confirm("确定删除吗？","删除","不删除").then(function(){$scope.processing_delete=!0;var target=e.currentTarget||e.target;angular.element(target).css("display","none").next().css("display","inline-block"),usSpinnerService.spin("spinner_"+id),ManageService.deletePermission(id).then(function(list){$scope.permissions=list},function(reason){StarsUtils.alert("删除失败:"+reason),$scope.processing_delete=!0;var target=e.currentTarget||e.target;angular.element(target).css("display","inline-block").next().css("display","none"),usSpinnerService.stop("spinner_"+id)})})},permissionsCtrl.search=function(){$scope.search_error=!0}}])}),define("modules/oms/manage/power",["angularAMD","modules/oms/manage/service","Session"],function(angularAMD){"use strict";angularAMD.controller("PowerCtrl",["$scope","manageService","ngDialog","Session","$state","usSpinnerService","StarsUtils","$stateParams","$controller",function($scope,manageService,ngDialog,$rootScope,$state,usSpinnerService,StarsUtils,$stateParams,$controller){$controller("BaseCtrl",{$scope:$scope});var powerCtrl=$scope.powerCtrl={};$scope.ids=[],$scope.itemService=manageService.setName("permissionrole"),$scope.roleId=$state.params.roleId,$scope.items=[2],powerCtrl.init=function(){$scope.route(),manageService.getPowerByRoleId($scope.roleId).then(function(e){var permissionArray=[];$scope.ids=e.data.data.permissionsids,angular.forEach(e.data.data.permissionsList,function(val,i){var str_key=val.permissionDisplayName.substring(0,val.permissionDisplayName.lastIndexOf("_"));"undefined"==typeof permissionArray[str_key]&&(permissionArray[str_key]=[{name:val.permissionName,check:!0,options:[]}]);var ckstatus=!0;-1==$scope.ids.indexOf(val.permissionId)&&(ckstatus=!1,permissionArray[str_key][0].check=!1),permissionArray[str_key][0].options.push({permissionId:val.permissionId,ckstatus:ckstatus,permissionControllerName:val.permissionControllerName})}),$scope.items=[];for(var p in permissionArray){({name:p,obj:permissionArray[p]});$scope.items.push({name:p,obj:permissionArray[p]})}},function(error){})},powerCtrl.save=function(){$scope.submitStatus=!0,manageService.savePower($scope.roleId,$scope.ids).then(function(e){alert("权限设置成功"),$scope.itemCtrl.back(),$scope.submitStatus=!1},function(error){alert("权限设置失败"),$scope.submitStatus=!1})},powerCtrl.toggleSelection=function(permission){var idx=$scope.ids.indexOf(permission.permissionId);idx>-1?$scope.ids.splice(idx,1):$scope.ids.push(permission.permissionId)},powerCtrl.init()}]),angularAMD.directive("ckallBox",function(){return{restrict:"A",require:"?ngModel",link:function(scope,element,attrs,ngModel){element.on("click",function(){scope.$apply(ckbox)});var ckbox=function(){attrs.$$element[0].checked?angular.forEach(scope.item.obj[0].options,function(e,vl){scope.item.obj[0].options[vl].ckstatus||(scope.item.obj[0].options[vl].ckstatus=!0,scope.$parent.ids.push(e.permissionId))}):angular.forEach(scope.item.obj[0].options,function(e,vl){var index=scope.$parent.ids.indexOf(e.permissionId);scope.$parent.ids.splice(index,1),scope.item.obj[0].options[vl].ckstatus=!1})}}}})}),define("modules/oms/manage/role",["angularAMD","modules/oms/manage/service","Session"],function(angularAMD){"use strict";angularAMD.controller("RoleCtrl",["$scope","manageService","$controller","$state","ngDialog",function($scope,manageService,$controller,$state,ngDialog){$scope.methods=$state.current.data.methods,$scope.dataConfig={edit:{template:"modules/oms/manage/roleEdit.html",data:{title:"编辑角色"},controller:"roleEditCtrl"},create:{template:"modules/oms/manage/roleEdit.html",data:{title:"新增角色",item:{}},controller:"roleEditCtrl"}},$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=manageService.setName("role"),"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage),$scope.route()}])}),define("modules/oms/manage/roleEdit",["angularAMD","modules/oms/manage/service"],function(angularAMD){"use strict";angularAMD.controller("roleEditCtrl",function($scope,manageService,$rootScope){var roleEditCtrl=$scope.roleEditCtrl={};if($scope.submitted=!1,$scope.errorMessage="",$scope.userNameChecked="",$scope.title=$scope.ngDialogData.title,$scope.item=$scope.ngDialogData.item,"undefined"!=typeof $scope.item.roleName)var temporaryName=angular.copy($scope.item.roleName);else $scope.item={};roleEditCtrl.saveRole=function(){manageService.isEmptyObject($scope.myform.userName.$error)&&roleEditCtrl.ckRole($scope.item.roleName),$scope.submitted=!0},roleEditCtrl.ckRole=function(rolename){return temporaryName==rolename?void manageService.saveItem($scope.item,$scope).then(function(data){$scope.submitStatus=!1,$scope.closeThisDialog(data)},function(error){$scope.submitStatus=!1,$scope.errorMessage="code "+error.data.code+":"+error.data.message}):void manageService.ckRole({roleName:rolename}).then(function(data){$scope.roleNameCk="no"},function(error){rolename.length>0&&manageService.saveItem($scope.item,$scope).then(function(data){$scope.closeThisDialog(data)},function(error){$scope.errorMessage="code "+error.data.code+":"+error.data.message})})}})}),define("modules/oms/manage/roleService",["angularAMD","BaseService"],function(angularAMD,BaseService){"use strict";angularAMD.service("roleService",["APP_CONFIG","$http","$q",function(config,$http,$q){var mapping={apps:{id:"appsId",appsAppId:"appsAppId",appVersion:"appsAppVersion",appsUserId:"appsUserId",appsCreatedAt:"appsCreatedAt",appsUpdatedAt:"appsUpdatedAt",appsDescription:"appsDescription",appsIsAds:"appsIsAds",appsIsReview:"appsIsReview",appsIsUpdate:"appsIsUpdate",appsTargetVersion:"appsTargetVersion",appsUpdateMessage:"appsUpdateMessage",appsAppSource:"appsAppSource",appsAppOs:"appsAppOs",userName:"userName"}},roleService=new BaseService(config,$http,$q,mapping);return roleService.getRoleList=function(pageNumber,params){return params=params?params:{},params.currentPage=pageNumber,$http({url:config.httpBaseUrl+"/role/index",method:"GET",params:params,headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0})},roleService.upRole=function(roleId,params){return $http({url:config.httpBaseUrl+"/role/update/"+roleId,method:"PATCH",params:params,headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0})},roleService.addRole=function(params){return $http({url:config.httpBaseUrl+"/role/create",method:"POST",params:params,headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0})},roleService.ckRole=function(params){return $http({url:config.httpBaseUrl+"/role/rolename",method:"POST",params:params,headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0})},roleService.delRole=function(params){return $http({url:config.httpBaseUrl+"/role/dels/"+params,method:"DELETE",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0})},roleService}])}),define("modules/oms/manage/service",["angularAMD","BaseService"],function(angularAMD,BaseService){"use strict";angularAMD.service("manageService",["APP_CONFIG","$http","$q",function(config,$http,$q){var mapping={role:{roleCreatedAt:"roleCreatedAt",id:"roleId",roleName:"roleName",roleUpdatedAt:"roleUpdatedAt"},permission:{permissionId:"permissionId",permissionName:"permissionName",permissionDisplayName:"permissionDisplayName",permissionControllerName:"permissionControllerName",permissionCreatedAt:"permissionCreatedAt",permissionUpdatedAt:"permissionUpdatedAt"},user:{id:"userId",userName:"userName",userPassword:"userPassword",userPersonName:"userPersonName",userUnitName:"userUnitName",userEmail:"userEmail",userTelephone:"userTelephone",userStatus:"userStatus",CreatedAt:"userStatus",UpdatedAt:"UpdatedAt",roleId:"roleId",roleName:"roleName"},permissions:{id:"permissionId",permissionName:"permissionName",permissionControllerName:"permissionControllerName",permissionDisplayName:"permissionDisplayName"}},manageService=new BaseService(config,$http,$q,mapping);return manageService.getPowerByRoleId=function(roleid){var that=this,d=$q.defer();return $http({url:that.httpBaseUrl+"/permissionrole/show/"+roleid,method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},manageService.getUserById=function(userId){var that=this,d=that.$q.defer();return $http({url:that.httpBaseUrl+"/user/show/"+userId,method:"GET",withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},manageService.getRoleForLogin=function(){var that=this,d=$q.defer();return $http({url:that.httpBaseUrl+"/role/alllist",method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},manageService.checkExist=function(params){var that=this,d=$q.defer();return $http({url:that.httpBaseUrl+"/user/verifyname",method:"POST",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0,params:params}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},manageService.ckRole=function(params){var that=this;return $http({url:that.httpBaseUrl+"/role/rolename",method:"POST",params:params,headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0})},manageService.savePower=function(roleid,powerList){var that=this,d=$q.defer(),strArry="["+powerList.toString()+"]",params={permissionroleId:roleid,permissionsids:strArry};return $http({url:that.httpBaseUrl+"/permissionrole/update/"+roleid,method:"PATCH",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},params:params,withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},manageService}])}),define("modules/oms/states",["angularAMD","Session"],function(angularAMD,Session){"use strict";angularAMD.config(["$stateProvider","$starSessionProvider","$futureStateProvider",function($stateProvider,$starSessionProvider,$futureStateProvider,$scope){function loadCtrl($q,deps){var d=$q.defer();return require(deps,function(){d.resolve()}),d.promise}function setStates(objs){angular.forEach(objs,function(obj){if("undefined"!=typeof stateFactory["site."+obj.name]){var _state=stateFactory["site."+obj.name];"undefined"!=typeof obj.methods&&obj.methods.length>0&&angular.forEach(obj.methods,function(_m){"undefined"==typeof _state.data&&(_state.data={}),"undefined"==typeof _state.data.methods&&(_state.data.methods={}),_state.data.methods[_m.name]=_m}),$stateProvider.state(_state),"undefined"!=typeof obj.modules&&obj.modules.length>0&&setStates(obj.modules),"undefined"!=typeof obj.controllers&&obj.controllers.length>0&&setStates(obj.controllers)}})}var session=$starSessionProvider.getSession(),stateFactory={"site.oms":{name:"site.oms",url:"/oms",views:{topnav:{templateUrl:"public/layout/topnav.html",controller:"TopnavCtrl"},leftnav:{templateUrl:"public/layout/leftnav.html",controller:"LeftnavCtrl"}},data:{authorizedRoles:[session.userRole]}},"site.oms.home":{name:"site.oms.home",url:"/home",views:{"content@site":{templateUrl:"modules/oms/home/home.html",controller:"HomeCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/home/home"])}}},"site.oms.home.homeindex":{name:"site.oms.home.homeindex",url:"/home",views:{"content@site":{templateUrl:"modules/oms/home/home.html",controller:"HomeCtrl"}},data:{display:!1},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/home/home"])}}},"site.oms.system":{name:"site.oms.system",url:"/system"},"site.oms.system.permissions":{name:"site.oms.system.permissions",url:"/permissions",views:{"leftna@":{},"topnav@":{},"content@site":{templateUrl:"modules/oms/manage/permission.html",controller:"PermissionCtrl"}},data:{methods:{index:{},update:{}}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/manage/permission","modules/oms/manage/permissionEdit"])}}},"site.oms.system.role":{name:"site.oms.system.role",url:"/role",views:{"leftnav@":{},"topnav@":{},"content@site":{templateUrl:"modules/oms/manage/role.html",controller:"RoleCtrl"}},data:{methods:{create:{},index:{},update:{},"delete":{},forceUpdate:{}}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/manage/role","modules/oms/manage/roleEdit","modules/oms/manage/service"])}}},"site.oms.system.permissionrole":{name:"site.oms.system.permissionrole",url:"/power/:roleId",data:{display:!1},views:{"content@site":{templateUrl:"modules/oms/manage/power.html",controller:"PowerCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/manage/power","modules/oms/manage/service"])}}},"site.oms.system.user":{name:"site.oms.system.user",url:"/account",views:{"leftnav@":{},"topnav@":{},"content@site":{templateUrl:"modules/oms/manage/account.html",controller:"AccountCtrl"}},data:{methods:{create:{},index:{},update:{},"delete":{},forceUpdate:{}}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/manage/account","modules/oms/manage/accountEdit","modules/oms/manage/service"])}}},"site.oms.apps":{name:"site.oms.apps",url:"/apps"},"site.oms.apps.apps":{name:"site.oms.apps.apps",url:"/apps/:appsAppId/:titleName",views:{"content@site":{templateUrl:"modules/oms/apps/apps.html",controller:"AppsCtrl"}},data:{methods:{create:{},index:{},update:{},"delete":{},forceUpdate:{}},display:!1},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/apps/apps","modules/oms/apps/appsEdit","modules/oms/apps/appOperation","modules/oms/apps/appsForceUpdate"])}}},"site.oms.apps.appkey":{name:"site.oms.apps.appkey",url:"/appkey",views:{"content@site":{templateUrl:"modules/oms/apps/appsKey.html",controller:"AppsKeyCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/apps/appsKey","modules/oms/apps/appsKeyEdit","modules/oms/apps/appShow"])}}},"site.oms.cps":{name:"site.oms.cps",url:"/cps"},"site.oms.cps.cps":{name:"site.oms.cps.cps",url:"/cps",views:{"content@site":{templateUrl:"modules/oms/cps/cps.html",controller:"CpsCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/cps/cps","modules/oms/cps/cpsEdit","modules/oms/content/channelOption"])}}},"site.oms.cps.cpvideo":{name:"site.oms.cps.cpvideo",url:"/cpvideo/:cpId",views:{"content@site":{templateUrl:"modules/oms/cps/cpVideo.html",controller:"CpsVideoCtrl"}},data:{display:!1},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/cps/cpVideo","modules/oms/cps/cpVideoEdit"])}}},"site.oms.contents":{name:"site.oms.contents",url:"/contents"},"site.oms.epg":{name:"site.oms.epg",url:"/epg"},"site.oms.epg.video":{name:"site.oms.epg.video",url:"/video",views:{"content@site":{templateUrl:"modules/oms/content/epg.html",controller:"EpgCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/content/epg","modules/oms/content/epgEdit"])}}},"site.oms.epg.epg":{name:"site.oms.epg.epg",url:"/epg/:videoId",views:{"content@site":{templateUrl:"modules/oms/content/program.html",controller:"ProgramCtrl"}},data:{display:!1},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/content/program","modules/oms/content/programEdit"])}}},"site.oms.contents.vod":{name:"site.oms.contents.vod",url:"/vod",views:{"content@site":{templateUrl:"modules/oms/content/show.html?videoType=0",controller:"ShowCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/content/show","modules/oms/content/showEdit","modules/oms/content/channelOption","modules/oms/content/showOption","modules/oms/content/showVideo","modules/oms/content/vodEdit"])}}},"site.oms.contents.video":{name:"site.oms.contents.video",url:"/channel",views:{"content@site":{templateUrl:"modules/oms/content/channel.html",controller:"channelCtrl"}},data:{methods:{create:{},index:{},update:{},"delete":{},forceUpdate:{}}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/content/channel","modules/oms/content/channelOption","modules/oms/content/service"])}}},"site.oms.contents.createvideo":{name:"site.oms.contents.createvideo",url:"/videocreate/:videoId",views:{"content@site":{templateUrl:"modules/oms/content/channelEdit.html",controller:"channelEditCtrl"}},data:{display:!1},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/content/channelEdit","modules/oms/content/channelOption","modules/oms/content/service"])}}},"site.oms.contents.bindVideo":{name:"site.oms.contents.bindVideo",url:"/bindVideo/:videoId",views:{"content@site":{templateUrl:"modules/oms/content/bindVideo.html",controller:"bindVideoCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/content/bindVideo"])}}},"site.oms.basic":{name:"site.oms.basic",url:"/basic"},"site.oms.basic.property":{name:"site.oms.basic.property",url:"/property",views:{"content@site":{templateUrl:"modules/oms/basic/property.html",controller:"PropertyCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/basic/property","modules/oms/basic/propertyEdit"])}}},"site.oms.basic.tag":{name:"site.oms.basic.tag",url:"/tag",views:{"leftnav@":{},"topnav@":{},"content@site":{templateUrl:"modules/oms/basic/tag.html",controller:"TagCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/basic/tag","modules/oms/basic/tagEdit"])}}},"site.oms.basic.category":{name:"site.oms.basic.category",url:"/category",views:{"leftnav@":{},"topnav@":{},"content@site":{templateUrl:"modules/oms/basic/category.html",controller:"CategoryCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/basic/category","modules/oms/basic/categoryEdit","modules/oms/apps/appOperation"])}}},"site.oms.basic.market":{name:"site.oms.basic.market",url:"/market",views:{"leftnav@":{},"topnav@":{},"content@site":{templateUrl:"modules/oms/basic/market.html",controller:"MarketCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/basic/market","modules/oms/basic/marketEdit"])}}},"site.oms.client":{name:"site.oms.client",url:"/client"},"site.oms.client.tablet":{name:"site.oms.client.tablet",url:"/tablet",views:{"content@site":{templateUrl:"modules/oms/client/tab.html",controller:"TabCtrl"}},data:{methods:{create:{},index:{},update:{},"delete":{},forceUpdate:{}}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/client/tab","modules/oms/client/tabEdit","modules/oms/client/versionList"])}}},"site.oms.client.target":{name:"site.oms.client.target",url:"/target/:targetId",views:{"content@site":{templateUrl:"modules/oms/client/clientManage.html",controller:"clientCtrl"}},data:{methods:{create:{},index:{},update:{},"delete":{},forceUpdate:{}}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/client/clientManage","modules/oms/client/template","modules/oms/client/service"])}}},"site.oms.client.create":{name:"site.oms.client.create",url:"/clientCtrl/:targetId/:tabletId",views:{"content@site":{templateUrl:"modules/oms/client/clientEdit.html",controller:"clientEditCtrl"}},data:{display:!1},resolve:{loadCtrl:function($q){return loadCtrl($q,["libs/jquery-ui","modules/oms/client/clientEdit","modules/oms/client/clientOption","modules/oms/client/service","modules/oms/client/clientSetTime"])}}},"site.oms.client.version":{name:"site.oms.client.version",url:"/version/:clientId/:nameIndex/:tabletId",views:{"content@site":{templateUrl:"modules/oms/client/clientVersion.html",controller:"versionCtrl"}},data:{display:!1},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/client/clientVersion","modules/oms/client/versionOption","modules/oms/client/service"])}}},"site.oms.client.radio":{name:"site.oms.client.radio",url:"/radio",views:{"content@site":{templateUrl:"modules/oms/client/audioapi.html",controller:"AudioapiCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/client/audioapi"])}}},"site.oms.inteface.customapi":{name:"site.oms.inteface.customapi",url:"/customapi",views:{"content@site":{templateUrl:"modules/oms/client/tmpapi.html",controller:"TmpapiCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/client/tmpapi","modules/oms/client/tmpapiEdit","modules/oms/client/versionList","modules/oms/content/channelOption"])}}},"site.oms.test":{name:"site.oms.test",url:"/test"},"site.oms.test.test":{name:"site.oms.test.test",url:"/test",views:{"content@site":{templateUrl:"modules/oms/test/frame.html",controller:"TestCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/test/ZeroClipboard.min","modules/oms/test/testEdit"])}}},"site.oms.inteface":{name:"site.oms.inteface",url:"/inteface"},"site.oms.inteface.server":{name:"site.oms.inteface.server",url:"/server",views:{"content@site":{templateUrl:"modules/oms/inteface/server.html",controller:"serverCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/inteface/server","modules/oms/inteface/service"])}}},"site.oms.inteface.web":{name:"site.oms.inteface.web",url:"/intefaceWeb",views:{"content@site":{templateUrl:"modules/oms/inteface/web.html",controller:"webCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/inteface/web","modules/oms/inteface/service"])}}},"site.oms.inteface.ios":{name:"site.oms.inteface.ios",url:"/intefaceIos",views:{"content@site":{templateUrl:"modules/oms/inteface/ios.html",controller:"iosCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/inteface/ios","modules/oms/inteface/service"])}}},"site.oms.inteface.android":{name:"site.oms.inteface.android",url:"/intefaceAndroid",views:{"content@site":{templateUrl:"modules/oms/inteface/android.html",controller:"androidCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/inteface/android","modules/oms/inteface/service"])}}},"site.oms.logs":{name:"site.oms.logs",url:"/logs"},"site.oms.logs.log":{name:"site.oms.logs.log",url:"/log",views:{"content@site":{templateUrl:"modules/oms/logs/log.html",controller:"LogCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/logs/log"])}}},"site.oms.area":{name:"site.oms.area",url:"/relatArea"},"site.oms.area.arearelation":{name:"site.oms.area.arearelation",url:"/relatArea",views:{"content@site":{templateUrl:"modules/oms/relatArea/relatArea.html",controller:"AreaRelatCtrl"}},data:{methods:{create:{},index:{},update:{},"delete":{},forceUpdate:{}}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/relatArea/relatArea","modules/oms/relatArea/relatOperation"])}}},"site.oms.config":{name:"site.oms.config",url:"/config"},"site.oms.config.config":{name:"site.oms.config.config",url:"/config",views:{"content@site":{templateUrl:"modules/oms/config/config.html",controller:"ConfigCtrl"}},data:{methods:{create:{},index:{},update:{},"delete":{},forceUpdate:{}}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/config/config"])}}}};setStates(session.systems),$stateProvider.state({name:"site.oms.contents.bindVideo",url:"/bindVideo/:videoId",views:{"content@site":{templateUrl:"modules/oms/content/bindVideo.html",controller:"bindVideoCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/oms/content/bindVideo"])}}})}])}),define("appVersionSelect",["angularAMD","BaseService","lodash"],function(angularAMD,BaseService,_){angularAMD.directive("appVersionSelect",["appVersionSelectService",function(appVersionSelectService){return{restrict:"EA",replace:!0,scopt:{returnValue:"&",type:"=",id:"="},templateUrl:"utils/appVersionSelect/tpl.html",link:function($scope,element,attrs){var params,id,tabEditCtrl=$scope.tabEditCtrl={},app=$scope.app;switch($scope.typeApp){case"tab":id=$scope.app.id,$scope.app=$scope.ngDialogData.item,params={refId:$scope.app.id,appRelationType:22,isAll:1},$scope.selectAll=!1,$scope.toggleAll=function(){$scope.selectAll?(app.appId=[],angular.forEach($scope.tabVersion,function(val){app.appId.push(val.appsId)})):app.appId=[]};break;case"show":id=$scope.app.id,params={refId:$scope.ngDialogData.id,isAll:1};break;case"video":app=$scope.app={appId:$scope.idOptions};break;case"city":app=$scope.app={appId:$scope.idOptions}}angular.isUndefined(app.appId)&&(app.appId=[]),$scope.appVersions=[],appVersionSelectService.getVersionList().then(function(resp){$scope.tabVersion=resp.data.rows,angular.isUndefined(id)||($scope.versionAppList=[],appVersionSelectService.getTabByVersionId(params).then(function(resp){$scope.versionAppList=resp.data.rows,angular.forEach($scope.versionAppList,function(obj,i){app.appId.push(obj.appId)}),$scope.tabVersion.length==app.appId.length&&($scope.selectAll=!0)},function(error){}))},function(error){}),$scope.toggleVesCheck=function(item){app.appId.indexOf(item.appsId)>-1?(app.appId.splice(app.appId.indexOf(item.appsId),1),"video"==$scope.typeApp&&delete $scope.rItem[item.appsId]):(app.appId.push(item.appsId),"video"==$scope.typeApp&&($scope.rItem[item.appsId]=item))},"city"!==$scope.typeApp&&appVersionSelectService.getApp().then(function(resp){$scope.appKeys=resp.data.rows},function(error){}),"city"==$scope.typeApp&&appVersionSelectService.videoApp($scope.video_id).then(function(resp){$scope.appKeys=resp.data},function(error){}),$scope.$watch("appKeys",function(){$scope.appKeys&&$scope.appKeys.length>6&&($scope.len=0,$(".appKeyIndex > a:gt(5)").css("display","none"))}),$scope.changeShow=function(status){$scope.len=status,0==$scope.len?$(".appKeyIndex > a:gt(5)").css("display","none"):$(".appKeyIndex > a:gt(5)").css("display","inline")};var indexList=[],versionList=[];tabEditCtrl.clickGetApp_Ver=function(params,index,event){appVersionSelectService.getVersionList(params).then(function(resp){versionList=[],indexList.indexOf(index)>-1?(event.target.setAttribute("style",""),
indexList.splice(indexList.indexOf(index),1),versionList=resp.data.rows,_.forEach(versionList,function(a){_.forEach(angular.copy($scope.appVersions),function(b,i){a.appsId==b.appsId&&$scope.appVersions.splice(i,1)})})):(indexList.push(index),event.target.setAttribute("style","background-color: #EEAD0E"),versionList=resp.data.rows,$scope.appVersions=$scope.appVersions.concat(versionList))},function(error){})}}}}]),angularAMD.service("appVersionSelectService",["APP_CONFIG","$http","$q",function(config,$http,$q,$scope){var mapping={client:{id:"videoId",name:"videoName"},tablet:{id:"tabletId",modelId:"modelId",tabName:"tabletName",tabApi:"apiName",weight:"tabletSort",tabletStatus:"tabletStatus",tabletLock:"tabletLock",createdAt:"createdAt",updatedAt:"updatedAt",userId:"userId",userName:"userName",tabType:"tabletType",appId:"appId"},target:{id:"targetId",tabletId:"tabletId",name:"targetName",userName:"userName",appId:"appId",data:"data",delModelId:"delModelId",userId:"userId",status:"status",createdAt:"createdAt",updatedAt:"updatedAt"},video:{id:"videoId",name:"videoName",videoType:"videoType",imgUrl:"videoImage",intro:"intro",recomm:"recomm",description:"description",videoDuration:"videoDuration",videoStatus:"videoStatus",area:"area",urlSource:"urlSource",videoSize:"videoSize",firstChar:"firstChar",videoOfflinetime:"videoOfflinetime",videoOnlinetime:"videoOnlinetime",score:"score",videoRecord:"videoRecord",videoEpg:"videoEpg",images:"images",videoUrl:"videoUrl",userId:"userId",videoCp:"videoCp",videoCategory:"videoCategory",videoTag:"videoTag",videoApp:"appRelation",createdAt:"createdAt",chargeType:"chargeType",chargeTypeName:"chargeTypeName",updatedAt:"updatedAt",videoImage:"videoImage",videoShareImage:"videoShareImage",videoTvImage:"videoTvImage",vip:"vip",relationEpg:"relationEpg",areaId:"areaId"},apps:{id:"appsId",version:"appsAppVersion",name:"appsAppOs",appKeyName:"appKeyName"},appRelation:{appRelationId:"appRelationId",refId:"refId",id:"appId",userId:"userId",type:"type",targetId:"targetId",version:"appsAppVersion",name:"appsAppOs",noAppId:"noAppId",appKeyName:"appKeyName"},radio:{id:"id",videoId:"videoId",videoName:"videoName",sort:"sort",status:"status",createdAt:"createdAt",updatedAt:"updatedAt"},customApi:{id:"customApiId",name:"customName",apiName:"customApiName",status:"customStatus",createdAt:"createdAt",updatedAt:"updatedAt",userId:"userId",userName:"userName",appId:"appId",customValue:"customValue"}},appVersionSelectService=new BaseService(config,$http,$q,mapping);return appVersionSelectService.getVersionList=function(params){var that=appVersionSelectService,method="",url="";return method="GET",url=that.httpBaseUrl+"/apps/index/?isAll=1",that.$http({url:url,params:params,method:method,withCredentials:!0})},appVersionSelectService.videoApp=function(id){var that=appVersionSelectService,method="",url="";return method="GET",url=that.httpBaseUrl+"/video/videoappkey/"+id,that.$http({url:url,method:method,withCredentials:!0})},appVersionSelectService.getApp=function(){var that=this,d=$q.defer();return $http({url:that.httpBaseUrl+"/appKey/index?isAll=1",method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},appVersionSelectService.getTabByVersionId=function(params){var that=this,method="GET",url="",d=that.$q.defer();return url=that.httpBaseUrl+"/appRelation/index",that.$http({url:url,method:method,params:params,withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},appVersionSelectService}])}),define("modules/oms/module",["angular","angularAMD","Session","uiRouterExtras","utils","dirPagination","angularUiSelect","modules/oms/states","appVersionSelect"],function(angular,angularAMD,Session){"use strict";var oms=angular.module("oms",["star.session","ui.router","ngDialog","ct-ui-router-extras","stars.utils","dirPagination","ui.select"]);return oms.filter("propsFilter",function(){return function(items,props){var out=[];return angular.isArray(items)?items.forEach(function(item){for(var itemMatches=!1,keys=Object.keys(props),i=0;i<keys.length;i++){var prop=keys[i],text=props[prop].toLowerCase();if(-1!==item[prop].toString().toLowerCase().indexOf(text)){itemMatches=!0;break}}itemMatches&&out.push(item)}):out=items,out}}),oms}),define("modules/oms/relatArea/relatArea",["angularAMD","modules/oms/relatArea/service","Session"],function(angularAMD,BaseCtrl){"use strict";angularAMD.controller("AreaRelatCtrl",["$scope","relatAreaService","Session","$controller","$state","ngDialog",function($scope,relatAreaService,Session,$controller,$state,ngDialog){$scope.methods=$state.current.data.methods,$scope.dataConfig={video:{template:"modules/oms/relatArea/relatOperation.html",data:{title:"关联频道",type:1},controller:"relatOperationCtrl"},vod:{template:"modules/oms/relatArea/relatOperation.html",data:{title:"关联栏目",type:0},controller:"relatOperationCtrl"},cp:{template:"modules/oms/relatArea/relatOperation.html",data:{title:"关联CP",type:5},controller:"relatOperationCtrl"}},$controller("BaseCtrl",{$scope:$scope}),$scope.relative=function(id,type){var config;switch(type){case 1:config=$scope.dataConfig.video;break;case 0:config=$scope.dataConfig.vod;break;case 5:config=$scope.dataConfig.cp}config.data.id=id;var ngdialog=ngDialog.open(config);ngdialog.closePromise.then(function(data){relatAreaService.setName("area").getAreaList(1).then(function(resp){$scope.items=resp.data.rows},function(error){})})},"undefined"!=typeof $scope.methods.index.name&&relatAreaService.setName("area").getAreaList(1).then(function(resp){$scope.items=resp.data.rows},function(error){})}])}),define("modules/oms/relatArea/relatOperation",["angularAMD","modules/oms/relatArea/service"],function(angularAMD){"use strict";angularAMD.controller("relatOperationCtrl",function($scope,relatAreaService,$controller,$state){function isRelation(type){$scope.norelativeObj=[],$scope.relativeObj=[],0==type||1==type?angular.forEach($scope.items,function(obj){-1==$scope.ids.indexOf(obj.videoId)?$scope.norelativeObj.push({videoType:obj.videoType,videoId:obj.videoId,videoName:obj.videoName,videoCategory:obj.videoCategory}):$scope.relativeObj.push({videoType:obj.videoType,videoId:obj.videoId,videoName:obj.videoName,videoCategory:obj.videoCategory})}):angular.forEach($scope.items,function(obj){-1==$scope.ids.indexOf(obj.cpId)?$scope.norelativeObj.push({cpId:obj.cpId,cpName:obj.cpName}):$scope.relativeObj.push({cpId:obj.cpId,cpName:obj.cpName})})}var relatOperationCtrl=$scope.relatOperationCtrl={};$scope.errorMessage="",$scope.title=$scope.ngDialogData.title,$scope.type=$scope.ngDialogData.type,$controller("BaseCtrl",{$scope:$scope}),$scope.loading_list=!0;$scope.app=$scope.ngDialogData.item;relatOperationCtrl.init=function(){$scope.ids=[],$scope.is_ids=[],$scope.no_ids=[],$scope.refs=[],$scope.is_refs=[],$scope.no_refs=[],$scope.norelativeObj=[],$scope.relativeObj=[],$scope.selectAll_is=!1,$scope.selectAll_no=!1,relatAreaService.getAllList($scope.type,$scope.searchParams).then(function(e){$scope.items=e.data.rows,$scope.totalItems=e.data.totalResults,relatAreaService.getRelation($scope.ngDialogData.id,$scope.type).then(function(e){$scope.loading_list=!1,angular.forEach(e.data.rows,function(obj){$scope.ids.push(obj.refId),$scope.refs.push({id:obj.refId,type:obj.videoType})}),0==$scope.ids.length&&($scope.isRelative=0),isRelation($scope.type)})})},$scope.isRelative=1,relatOperationCtrl.changeRelation=function(i){$scope.isRelative=i},relatOperationCtrl.toggleSelection=function(vid,type,videoType){1==type?$scope.is_ids.indexOf(vid)>=0?($scope.is_ids.splice($scope.is_ids.indexOf(vid),1),$scope.is_refs.splice($scope.is_refs.indexOf({id:vid,type:videoType}),1)):($scope.is_ids.push(vid),$scope.is_refs.push({id:vid,type:videoType})):0==type&&($scope.no_ids.indexOf(vid)>=0?($scope.no_ids.splice($scope.no_ids.indexOf(vid),1),$scope.no_refs.splice($scope.no_refs.indexOf({id:vid,type:videoType}),1)):($scope.no_ids.push(vid),$scope.no_refs.push({id:vid,type:videoType})))},relatOperationCtrl.search=function(){relatOperationCtrl.init()},relatOperationCtrl.toggleAll=function(type,obj){1==type?obj.selectAll_is?($scope.is_ids=[],$scope.is_refs=[],angular.forEach($scope.items,function(obj){$scope.is_ids.push(obj.videoId),$scope.is_refs.push({id:obj.videoId,type:obj.videoType})})):($scope.is_ids=[],$scope.is_refs=[]):obj.selectAll_no?($scope.no_ids=[],$scope.no_refs=[],angular.forEach($scope.items,function(obj){-1==$scope.ids.indexOf(obj.videoId)&&($scope.no_ids.push(obj.videoId),$scope.no_refs.push({id:obj.videoId,type:obj.videoType}))})):($scope.no_ids=[],$scope.no_refs=[])},relatOperationCtrl.toggleAll_cp=function(type,obj){1==type?obj.selectAll_is?($scope.is_ids=[],angular.forEach($scope.items,function(obj){$scope.is_ids.push(obj.cpId)})):$scope.is_ids=[]:obj.selectAll_no?($scope.no_ids=[],angular.forEach($scope.items,function(obj){-1==$scope.ids.indexOf(obj.cpId)&&$scope.no_ids.push(obj.cpId)})):$scope.no_ids=[]},relatOperationCtrl.init(),relatOperationCtrl.checkCloseDialog=function(status){if($scope.no_ids.length>0&&0==status&&($scope.ids=$scope.ids.concat($scope.no_ids),$scope.refs=$scope.refs.concat($scope.no_refs)),$scope.is_ids.length>0&&1==status)for(var i=0;i<$scope.is_ids.length;i++)$scope.ids.splice($scope.ids.indexOf($scope.is_ids[i]),1),$scope.refs.splice($scope.refs.indexOf($scope.is_refs[i]),1);var item;item=1==$scope.type?{areaId:$scope.ngDialogData.id,refs:$scope.refs}:{areaId:$scope.ngDialogData.id,refIds:$scope.ids,areaRelationType:$scope.type},$scope.submitStatus=!0,relatAreaService.saveRelation(item,$scope.type).then(function(data){$scope.closeThisDialog(data),$state.go("site.oms.area.arearelation")},function(error){$scope.submitStatus=!1,$scope.errorMessage=error})}})}),define("modules/oms/relatArea/service",["angularAMD","BaseService"],function(angularAMD,BaseService){"use strict";angularAMD.service("relatAreaService",["APP_CONFIG","$http","$q",function(config,$http,$q){var mapping={area:{id:"areaId",name:"areaName",areaNote:"areaNote",createdAt:"createdAt",updatedAt:"updatedAt",userId:"userId",refName:"refName",refId:"refId",videoType:"areaRelationType"},cps:{cpId:"cpId",cpName:"cpName"},vod:{id:"videoId",videoName:"videoName"},video:{id:"videoId",videoName:"videoName"}},relatAreaService=new BaseService(config,$http,$q,mapping);return relatAreaService.getAreaList=function(pageNumber,params){var that=this,d=that.$q.defer();return params=params?that.changeFromLocalColumns(params):{},params.currentPage=pageNumber,that.$http({url:config.areaUrl+"/"+that.name+"/index",method:"GET",params:params,header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/json"},withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},relatAreaService.getRelation=function(id,type){var url;1==type?url=config.httpBaseUrl+"/areaRelation/index?isAll=1&video=1&areaId="+id:0==type?url=config.httpBaseUrl+"/areaRelation/index?isAll=1&areaRelationType="+type+"&areaId="+id:5==type&&(url=config.httpBaseUrl+"/areaRelation/index?isAll=1&areaRelationType="+type+"&areaId="+id);var that=this,d=that.$q.defer();return $http({url:url,method:"GET",withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},relatAreaService.getAllList=function(type,params){var url,that=this,d=that.$q.defer();return 1==type?url=config.httpBaseUrl+"/video/index?isAll=1":0==type?url=config.httpBaseUrl+"/vod/index?isAll=1":5==type&&(url=config.httpBaseUrl+"/cps/index?isAll=1"),$http({url:url,method:"GET",params:params,header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/json"},withCredentials:!0}).then(function(resp){d.resolve(resp)},function(error){d.reject(error)}),d.promise},relatAreaService.saveRelation=function(item,type){var url,that=this,method="PATCH";return url=1==type?config.httpBaseUrl+"/areaRelation/areavideoref":config.httpBaseUrl+"/areaRelation/arearef/",that.$http({url:url,method:method,data:item,withCredentials:!0})},relatAreaService}])});