define("modules/push/basic/service",["angularAMD","BaseService"],function(angularAMD,BaseService){"use strict";angularAMD.service("BasicsService",["APP_CONFIG","$http","$q",function(config,$http,$q){var mapping={tag:{id:"tagId",tagName:"tagName",message:"message"}},basicsService=new BaseService(config,$http,$q,mapping);return basicsService.setHttpBaseUrl(config.pushBaseUrl),basicsService}])}),define("modules/push/basic/tag",["angularAMD","modules/push/basic/service","Session"],function(angularAMD){"use strict";angularAMD.controller("TagCtrl",["$scope","BasicsService","Session","$controller","$state",function($scope,BasicsService,Session,$controller,$state){$scope.methods=$state.current.data.methods,$scope.$state=$state,$scope.dataConfig={edit:{template:"modules/push/basic/tagEdit.html",data:{title:"编辑标签"},controller:"TagEditCtrl"},create:{template:"modules/push/basic/tagEdit.html",data:{title:"添加标签",item:{}},controller:"TagEditCtrl"}},$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=BasicsService.setName("tag"),"undefined"!=typeof $scope.methods.index.name&&$scope.getResultsPage($scope.currentPage)}])}),define("modules/push/basic/tagEdit",["angularAMD"],function(angularAMD){"use strict";angularAMD.controller("TagEditCtrl",function($scope,BasicsService){var tagEditCtrl=$scope.tagEditCtrl={};$scope.submitted=!1,$scope.errorMessage="",$scope.title=$scope.ngDialogData.title;var tag=$scope.tag=$scope.ngDialogData.item;null==tag.id&&($scope.ngDialogData.item={}),tagEditCtrl.init=function(){$scope.options=[{id:1,tagName:"频道标签"},{id:2,tagName:"栏目标签"},{id:3,tagName:"节目标签"}],"undefined"!=typeof $scope.ngDialogData.item.id?$scope.tag.tagType=$scope.options[$scope.tag.tagType-1]:$scope.tag.tagType=$scope.options[0]},tagEditCtrl.checkCloseDialog=function(){$scope.errorMessage="",$scope.submitted=!0,BasicsService.isEmptyObject($scope.myform.$error)&&($scope.tag.tagType=$scope.tag.tagType.id,$scope.tag.pid=$scope.tag.pid.id,"undefined"==typeof $scope.tag.pid&&($scope.tag.pid=0),tag=angular.copy($scope.tag),BasicsService.saveItem(tag,$scope).then(function(data){$scope.closeThisDialog(data),$scope.submitStatus=!1},function(error){$scope.submitStatus=!1,$scope.errorMessage=error}))},tagEditCtrl.getParentTags=function(){BasicsService.getParentTags().then(function(resp){$scope.parentTags=resp.data.data,"undefined"==typeof $scope.tag.id||null==$scope.tag.id||""==$scope.tag.id?$scope.tag.pid=$scope.parentTags[0]:angular.forEach($scope.parentTags,function(obj,i){obj.id==$scope.tag.pid&&($scope.tag.pid=$scope.parentTags[i])})},function(error){})},tagEditCtrl.getParentTags(),$scope.is_first_level_tag=!1,tagEditCtrl.setTagPidValue=function(el){$scope.is_first_level_tag?$scope.is_first_level_tag=!1:($scope.is_first_level_tag=!0,$scope.tag.pid=0)},tagEditCtrl.init()})}),define("modules/push/home/home",["angularAMD"],function(angularAMD){"use strict";angularAMD.controller("HomeCtrl",["$rootScope","$scope","$timeout",function($rootScope,$scope,$timeout){$scope.message="欢迎访问国广星空PUSH后台管理系统",$scope.gotoState=function(state){}}])}),define("modules/push/states",["angularAMD","Session"],function(angularAMD,Session){"use strict";angularAMD.config(["$stateProvider","$starSessionProvider","$futureStateProvider",function($stateProvider,$starSessionProvider,$futureStateProvider,$scope){function loadCtrl($q,deps){var d=$q.defer();return require(deps,function(){d.resolve()}),d.promise}function setStates(objs){angular.forEach(objs,function(obj){if("undefined"!=typeof stateFactory["site."+obj.name]){var _state=stateFactory["site."+obj.name];"undefined"!=typeof obj.methods&&obj.methods.length>0&&angular.forEach(obj.methods,function(_m){"undefined"==typeof _state.data&&(_state.data={}),"undefined"==typeof _state.data.methods&&(_state.data.methods={}),_state.data.methods[_m.name]=_m}),$stateProvider.state(_state),"undefined"!=typeof obj.modules&&obj.modules.length>0&&setStates(obj.modules),"undefined"!=typeof obj.controllers&&obj.controllers.length>0&&setStates(obj.controllers)}})}var session=$starSessionProvider.getSession(),stateFactory={"site.push":{name:"site.push",url:"/push",views:{topnav:{templateUrl:"public/layout/topnav.html",controller:"TopnavCtrl"},leftnav:{templateUrl:"public/layout/leftnav.html",controller:"LeftnavCtrl"}},data:{authorizedRoles:[session.userRole]}},"site.push.pushmsg":{name:"site.push.pushmsg",url:"/pushmsg"},"site.push.pushmsg.createHidemsg":{name:"site.push.pushmsg.createHidemsg",url:"/createHidemsg/:showId",views:{"content@site":{templateUrl:"modules/push/pushmsg/addnews.html",controller:"AddNewsCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/push/pushmsg/addnews","modules/push/pushmsg/addnewsOption"])}}},"site.push.pushmsg.createMsg":{name:"site.push.pushmsg.createMsg",url:"/createMsg/:showId",views:{"content@site":{templateUrl:"modules/push/pushmsg/pushmessage.html",controller:"PushMessageCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/push/pushmsg/pushmessage","modules/push/pushmsg/addnewsOption"])}}},"site.push.pushmsg.index":{name:"site.push.pushmsg.index",url:"/index",views:{"content@site":{templateUrl:"modules/push/pushmsg/pushlist.html",controller:"PushListCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/push/pushmsg/pushlist","modules/push/pushmsg/pushlistEdit"])}}},"site.push.pushmsg.show":{name:"site.push.pushmsg.show",url:"/show/:showId",views:{"content@site":{templateUrl:"modules/push/pushmsg/pushlistEdit.html",controller:"PushListEditCtrl"}},data:{display:!1},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/push/pushmsg/pushlistEdit"])}}},"site.push.pushmsg.switchLbs":{name:"site.push.pushmsg.switchLbs",url:"/switchLbs",views:{"content@site":{templateUrl:"modules/push/pushmsg/switch.html",controller:"SwitchCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/push/pushmsg/switch"])}}},"site.push.basic":{name:"site.push.basic",url:"/basic"},"site.push.basic.tag":{name:"site.push.basic.tag",url:"/tag",views:{"content@site":{templateUrl:"modules/push/basic/tag.html",controller:"TagCtrl"}},resolve:{loadCtrl:function($q){return loadCtrl($q,["modules/push/basic/tag","modules/push/basic/tagEdit"])}}}};setStates(session.systems)}])}),define("modules/push/module",["angular","angularAMD","Session","uiRouterExtras","utils","dirPagination","angularUiSelect","modules/push/states"],function(angular,angularAMD,Session){"use strict";var push=angular.module("push",["star.session","ui.router","ngDialog","ct-ui-router-extras","stars.utils","dirPagination","ui.select"]);return push.filter("propsFilter",function(){return function(items,props){var out=[];return angular.isArray(items)?items.forEach(function(item){for(var itemMatches=!1,keys=Object.keys(props),i=0;i<keys.length;i++){var prop=keys[i],text=props[prop].toLowerCase();if(-1!==item[prop].toString().toLowerCase().indexOf(text)){itemMatches=!0;break}}itemMatches&&out.push(item)}):out=items,out}}),push}),define("modules/push/pushmsg/addnews",["angularAMD","modules/push/pushmsg/service","Session","jquery"],function(angularAMD){"use strict";angularAMD.controller("AddNewsCtrl",["$scope","PushMsgService","Session","$controller","$state","ngDialog","StarsUtils","$stateParams",function($scope,PushMsgService,Session,$controller,$state,ngDialog,StarsUtils,$stateParams){$scope.showId=$stateParams.showId,$scope.methods=$state.current.data.methods,$scope.$state=$state;var addNewsCtrl=$scope.addNewsCtrl={};$scope.typeStatus={1:"已发送",0:"未发送",2:"异常"};var news=$scope.news={};news.equipment=[],news.msgPic="",news.equipment=[],news.pushway=1;var tmpData=$scope.tmpData={};if(news.msgType=0,""==$stateParams.showId)$scope.showCloseBtn=1,$scope.showTitle=1,$scope.sends=0,$scope.showTime=3,$scope.ranges=1,news.addData={},$scope.houseTime=1,$scope.minuteTime=0,$scope.secondTime=0,$scope.deviceCount=0,$scope.speed=0,$scope.speed_time=1,$scope.sendTime=new Date,$scope.loading_list=!1,$scope.itemService=PushMsgService.setName("pushmsg"),$controller("BaseCtrl",{$scope:$scope});else{$scope.updateType=1;var android_device=angular.element(document.getElementsByClassName(".android_device")[0]),ios_device=angular.element(document.getElementsByClassName(".ios_device")[0]);$scope.loading_list=!0,PushMsgService.getPushList($stateParams.showId).then(function(resp){$scope.loading_list=!1;$scope.android={},$scope.ios={};for(var i in resp.data.status)"Android"==resp.data.status[i].deviceType?($scope.flagA=1,$scope.message=1,$scope.status_A=resp.data.status[i].sentStatus,$scope.num_A=resp.data.status[i].sentTotal,$scope.sucess_A=resp.data.status[i].msgProcess,android_device.checked=!0,news.equipment.push(1)):"IOS"==resp.data.status[i].deviceType&&($scope.flagI=1,$scope.message=1,$scope.status_I=resp.data.status[i].sentStatus,$scope.num_I=resp.data.status[i].sentTotal,$scope.sucess_I=resp.data.status[i].msgProcess,ios_device.checked=!0,news.equipment.push(2)),2==resp.data.status[i].sentStatus&&($scope.message=2,$scope.errorMessage=resp.data.status[i].message);if(news.equipment=_.uniq(news.equipment),news.equipment.indexOf(2)&&news.equipment.indexOf(1)?($scope.android=!0,$scope.ios=!0):news.equipment.indexOf(2)&&!news.equipment.indexOf(1)?($scope.android=!0,$scope.ios=!1):!news.equipment.indexOf(2)&&news.equipment.indexOf(1)?($scope.android=!1,$scope.ios=!0):news.equipment.indexOf(2)||news.equipment.indexOf(1)||($scope.android=!1,$scope.ios=!1),news.title=resp.data.msgTitle,news.msgPic=resp.data.msgPic,news["abstract"]=resp.data.msgTitle,news.addType=resp.data.addType,resp.data.addData)var addData=resp.data.addData;1==news.addType&&addData?(news.addData=$scope.addTmpData=addData.value.videoId+"-"+addData.value.videoName+"-"+addData.value.playType+"-"+addData.value.image,$scope.channelId=angular.copy(addData.value.videoId),$scope.channelName=angular.copy(addData.value.videoName),$scope.channelType=angular.copy(addData.value.playType),$scope.channelImage=angular.copy(addData.value.image)):2==news.addType&&addData?news.addData=tmpData.addTmpData=addData.value:3==news.addType&&addData?news.addData=tmpData.addTmpData=addData.value:4==news.addType&&addData?news.addData=$scope.addTmpData=addData.value.videoId+"-"+addData.value.videoName:5==news.addType&&addData&&(tmpData.addTmpKey=addData.key,tmpData.addTmpData=addData.value),news.area=resp.data.area,"all"==resp.data.receiverGid?($scope.ranges=1,news.receiverGid="all"):($scope.ranges=2,$scope.receiverGid=resp.data.videoName,$scope.colomnId=resp.data.addData.value.videoId),news.pushServer=1,$scope.showCloseBtn=resp.data.addData.showCloseBtn,$scope.showPlaceVal=resp.data.addData.showPlaceVal,$scope.showTime=resp.data.addData.showTime,$scope.showTitle=resp.data.addData.showTitle,$scope.sendTime=new Date(parseInt(1e3*resp.data.sendTime)),$scope.houseTime=parseInt(resp.data.validTime/36e5),$scope.minuteTime=parseInt(resp.data.validTime%36e5/60),$scope.secondTime=parseInt(resp.data.validTime%36e5%60/60),0==resp.data.speed?$scope.speed=0:($scope.speed=1,$scope.speed_time=parseInt(resp.data.speed))},function(error){})}var objOption=[{template:"modules/push/pushmsg/addnewsOption.html",data:{title:"选择频道",type:1,key:"play"},controller:"ChooseCtrl"},{template:"modules/push/pushmsg/addnewsOption.html",data:{title:"选择栏目",type:3,key:"column"},controller:"ChooseCtrl"},{template:"modules/push/pushmsg/addnewsOption.html",data:{title:"选择点播",type:4,key:"vod"},controller:"ChooseCtrl"}];$scope.ckMore=function(item,box){box?(news.equipment.push(item),$scope.deviceCount++):(news.equipment.splice(news.equipment.indexOf(item),1),$scope.deviceCount--)},addNewsCtrl.changeChannelR=function(){var ngdialog1=ngDialog.open(objOption[0]);ngdialog1.closePromise.then(function(data){"undefined"!=typeof data.value&&"$closeButton"!=data.value&&"$document"!=data.value&&0!=data.value&&($scope.receiverGid=angular.copy(data.value.videoName),news.receiverGid=angular.copy(data.value.videoId))})},addNewsCtrl.changeChannel=function(){if(1==news.addType){var ngdialog1=ngDialog.open(objOption[0]);ngdialog1.closePromise.then(function(data){"undefined"!=typeof data.value&&"$closeButton"!=data.value&&"$document"!=data.value&&0!=data.value&&($scope.channelId=angular.copy(data.value.videoId),$scope.channelName=angular.copy(data.value.videoName),$scope.channelType=angular.copy(data.value.videoType),$scope.channelImage=angular.copy(data.value.videoImage),$scope.addTmpData=$scope.channelId+" - "+$scope.channelName+" - "+$scope.channelType+" - "+$scope.channelImage)})}else if(4==news.addType){var ngdialog4=ngDialog.open(objOption[1]);ngdialog4.closePromise.then(function(data){"undefined"!=typeof data.value&&"$closeButton"!=data.value&&"$document"!=data.value&&0!=data.value&&($scope.colomnId=angular.copy(data.value.videoId),$scope.addTmpData=data.value.videoId+" - "+data.value.videoName)})}},addNewsCtrl.chooseArea=function(num){var objArea=[{template:"modules/push/pushmsg/addnewsOption.html",data:{title:"选择地区（最多3个）",type:2,area:news.area},controller:"ChooseCtrl"}],ngdialog=ngDialog.open(objArea[num]);ngdialog.closePromise.then(function(data){"undefined"!=typeof data.value&&"$closeButton"!=data.value&&"$document"!=data.value&&0!=data.value&&(news.area=data.value)})},addNewsCtrl.goList=function(){$state.go("site.push.pushmsg.index")},addNewsCtrl.checkCloseDialog=function(){$scope.errorMessage="",$scope.submitted=!0,1==$scope.sends?news.sendTime="":news.sendTime=angular.copy(parseInt($scope.sendTime.valueOf()/1e3)),0==$scope.speed?news.speed=0:news.speed=angular.copy(parseInt($scope.speed_time)),1==$scope.ranges&&(news.receiverGid="all"),1==news.addType&&(news.addData={key:"play",value:{videoId:$scope.channelId,videoName:$scope.channelName,playType:$scope.channelType,image:$scope.channelImage},showTime:$scope.showTime,showPlaceVal:$scope.showPlaceVal,showCloseBtn:$scope.showCloseBtn,showTitle:$scope.showTitle}),2==news.addType&&(news.addData={key:"download",value:tmpData.addTmpData,showTime:$scope.showTime,showPlaceVal:$scope.showPlaceVal,showCloseBtn:$scope.showCloseBtn,showTitle:$scope.showTitle}),3==news.addType&&(news.addData={key:"url",value:tmpData.addTmpData,showTime:$scope.showTime,showPlaceVal:$scope.showPlaceVal,showCloseBtn:$scope.showCloseBtn,showTitle:$scope.showTitle}),4==news.addType&&(news.addData={key:"column",value:$scope.colomnId,showTime:$scope.showTime,showPlaceVal:$scope.showPlaceVal,showCloseBtn:$scope.showCloseBtn,showTitle:$scope.showTitle}),5==news.addType&&(news.addData={key:tmpData.addTmpKey,value:tmpData.addTmpData,showTime:$scope.showTime,showPlaceVal:$scope.showPlaceVal,showCloseBtn:$scope.showCloseBtn,showTitle:$scope.showTitle}),news.validTime=36e5*$scope.houseTime+6e4*$scope.minuteTime+1e3*$scope.secondTime,$scope.myform.$invalid||(""==$stateParams.showId?StarsUtils.confirm("是否"+(""==news.sendTime?"发送":"保存")).then(function(data){PushMsgService.saveItem(news,$scope).then(function(data){$scope.submitStatus=!1,200==data.status||201==data.status?StarsUtils.confirm((""==news.sendTime?"发送":"保存")+"成功！").then(function(data){$state.go("site.push.pushmsg.index")},function(e){}):StarsUtils.alert((""==news.sendTime?"发送":"保存")+"失败！")},function(error){$scope.submitStatus=!1,StarsUtils.alert((""==news.sendTime?"发送":"保存")+"失败！")})},function(error){$scope.submitStatus=!1,StarsUtils.alert("未"+(""==news.sendTime?"发送":"保存")),$scope.errorMessage=error}):StarsUtils.confirm("是否"+(""==news.sendTime?"发送":"保存")).then(function(data){news.id=$stateParams.showId,PushMsgService.saveItem(news,$scope).then(function(data){$scope.submitStatus=!1,200==data.status||201==data.status?(StarsUtils.alert((""==news.sendTime?"发送":"保存")+"成功！"),$state.go("site.push.pushmsg.index")):StarsUtils.alert((""==news.sendTime?"发送":"保存")+"失败！")},function(error){$scope.submitStatus=!1,StarsUtils.alert((""==news.sendTime?"发送":"保存")+"失败！")})},function(error){$scope.submitStatus=!1,StarsUtils.alert("未"+(""==news.sendTime?"发送":"保存")),$scope.errorMessage=error}))}}])}),define("modules/push/pushmsg/addnewsOption",["angularAMD","Session"],function(angularAMD){"use strict";angularAMD.controller("ChooseCtrl",["$scope","PushMsgService","Session","$controller","$state","ngDialog",function($scope,PushMsgService,Session,$controller,$state,ngDialog){$scope.methods=$state.current.data.methods;var chooseCtrl=$scope.chooseCtrl={};$controller("BaseCtrl",{$scope:$scope}),$scope.items=[],$scope.title=$scope.ngDialogData.title,$scope.type=$scope.ngDialogData.type,$scope.appKeyId=$scope.ngDialogData.appKeyId,$scope.choose=$scope.ngDialogData.choose,$scope.android=$scope.ngDialogData.android,$scope.area=$scope.ngDialogData.area,$scope.ios=$scope.ngDialogData.ios,$scope.rItem=[],$scope.checkBox1=["北京","天津","河北","山西","内蒙古"],$scope.checkBox2=["辽宁","吉林","黑龙江"],$scope.checkBox3=["上海","江苏","浙江","安徽","福建","江西","山东"],$scope.checkBox4=["河南","湖北","湖南"],$scope.checkBox5=["广东","广西","海南"],$scope.checkBox6=["重庆","四川","贵州","云南","西藏"],$scope.checkBox7=["陕西","甘肃","青海","宁夏","新疆"],$scope.checkBox8=["香港","澳门","台湾"],1==$scope.type?($scope.loading_list=!0,PushMsgService.getChanngel().then(function(resp){$scope.loading_list=!1,$scope.items=resp.data.rows,$scope.totalItems=resp.data.totalResults},function(error){})):3==$scope.type?($scope.loading_list=!0,PushMsgService.getEpg().then(function(resp){$scope.loading_list=!1,$scope.items=resp.data.rows,$scope.totalItems=resp.data.totalResults},function(error){})):5==$scope.type?PushMsgService.getApps($scope.appKeyId).then(function(resp){$scope.appVersion=$scope.items=resp.data.rows,""!=$scope.choose&&($scope.rItem=[],angular.forEach($scope.choose,function(obj,i){"Android"==obj.appsAppOs?($scope.rItemA.push(obj.appsAppVersion),$scope.rItem.push(obj)):($scope.rItemI.push(obj.appsAppVersion),$scope.rItem.push(obj))}))},function(error){}):2==$scope.type&&""!=$scope.area&&($scope.rItem=[],angular.forEach($scope.area,function(obj){$scope.rItem.push(obj)})),chooseCtrl.saveChoose=function(){(1==$scope.type||3==$scope.type)&&$scope.closeThisDialog($scope.rItem[0]),2==$scope.type&&$scope.closeThisDialog($scope.rItem),5==$scope.type&&$scope.closeThisDialog($scope.rItem)},(angular.isUndefined($scope.rItemA)||angular.isUndefined($scope.rItemI))&&($scope.rItemA=[],$scope.rItemI=[]),$scope.ckOption=function(obj){$scope.rItem[0]=obj},$scope.ckMore=function(obj,e){$scope.showArea=!1;var target=e.target;target.checked?(2==$scope.type&&($scope.rItem.length<3?$scope.rItem.push(obj):($scope.showArea=!0,target.checked=!1)),5==$scope.type&&$scope.rItem.push(obj)):$scope.rItem.splice($scope.rItem.indexOf(obj),1)},$scope.selectAll=function(num,e){1==num&&(e.target.checked?angular.forEach($scope.appVersion,function(obj){for(var i in $scope.rItem)$scope.rItem[i].appsAppOs==obj.appsAppOs&&$scope.rItem[i].appsAppVersion==obj.appsAppVersion&&"Android"==obj.appsAppOs&&$scope.rItem.splice($scope.rItem[i],1);"Android"==obj.appsAppOs&&$scope.rItem.indexOf(obj)<0&&($scope.selectAndroid=!0,$scope.rItem.push(obj))}):($scope.selectAndroid=!1,angular.forEach($scope.rItem,function(obj){"Android"==obj.appsAppOs&&$scope.rItem.splice($scope.rItem.indexOf(obj),1)}))),2==num&&(e.target.checked?angular.forEach($scope.appVersion,function(obj){for(var i in $scope.rItem)$scope.rItem[i].appsAppOs==obj.appsAppOs&&$scope.rItem[i].appsAppVersion==obj.appsAppVersion&&"IOS"==obj.appsAppOs&&$scope.rItem.splice($scope.rItem[i],1);"IOS"==obj.appsAppOs&&($scope.selectIOS=!0,$scope.rItem.push(obj))}):($scope.selectIOS=!1,angular.forEach(angular.copy($scope.rItem),function(obj){"IOS"==obj.appsAppOs&&$scope.rItem.splice($scope.rItem.indexOf(obj),1)})))},chooseCtrl.search=function(){$scope.getResultsPage(1,$scope.searchParams)},$scope.getResultsPage=function(pageNumber,params){$scope.currentPage=pageNumber,$scope.items=[],$scope.loading_list=!0,3==$scope.type&&PushMsgService.getEpgList(pageNumber,params).then(function(data){$scope.loading_list=!1,$scope.items=data.data.rows,$scope.totalItems=data.data.totalResults},function(error){}),1==$scope.type&&PushMsgService.getChannelList(pageNumber,params).then(function(data){$scope.loading_list=!1,$scope.items=data.data.rows,$scope.totalItems=data.data.totalResults},function(error){})}}])}),define("modules/push/pushmsg/pushlist",["angularAMD","modules/push/pushmsg/service","Session"],function(angularAMD){"use strict";angularAMD.controller("PushListCtrl",["$scope","PushMsgService","Session","$controller","$state","ngDialog",function($scope,PushMsgService,Session,$controller,$state,ngDialog){$scope.methods=$state.current.data.methods;var pushListCtrl=$scope.pushListCtrl={};$controller("BaseCtrl",{$scope:$scope}),$scope.itemService=PushMsgService.setName("pushmsg"),$scope.route(),$scope.searchType=1,$scope.getDevice=function(data){var device=[],returnDevice="";angular.forEach(data,function(val){device.push(val.deviceType)});for(var i in _.uniq(device))returnDevice+=_.uniq(device)[i]+"\n";return returnDevice},$scope.chooseDate=function(data){return null!=data&&data.key?"play"==data.key?data.value.videoId+"-"+data.value.playType+"-"+data.value.videoName+"-"+data.value.image:"download"==data.key?data.value:"url"==data.key?data.value:"column"==data.key?data.value.videoId+"-"+data.value.videoName:data.value:void 0},pushListCtrl.search=function(){$scope.getResultsPage(1,$scope.searchParams)},$scope.typeServer={1:"个推"},$scope.typeSend={0:"未发送",1:"已发送",2:"异常"},$scope.typeMsg={0:"透传",1:"通知"},$scope.typeContent={1:"频道",2:"下载",3:"链接",4:"栏目",5:"自定义"},$scope.getResultsPage($scope.currentPage)}])}),define("modules/push/pushmsg/pushlistEdit",["angularAMD","Session","jquery"],function(angularAMD){"use strict";angularAMD.controller("PushListEditCtrl",["$scope","PushMsgService","Session","$controller","$state","ngDialog","$stateParams",function($scope,PushMsgService,Session,$controller,$state,ngDialog,$stateParams){$scope.methods=$state.current.data.methods;var news=$scope.news={},android=$scope.android={},ios=$scope.ios={};$scope.message=1,$controller("BaseCtrl",{$scope:$scope}),$scope.typeStatus={1:"已发送",0:"未发送",2:"异常"},$scope.updateType=1,$scope.loading_list=!0,PushMsgService.getAppKey().then(function(resp){$scope.appTypeName=resp.data.rows},function(error){}),PushMsgService.getPushList($stateParams.showId).then(function(resp){$scope.msgType=resp.data.msgType,$scope.loading_list=!1,news.appVersions=[],news.appKeyId=resp.data.appKeyId,$scope.appKeyId=news.appKeyId,angular.forEach($scope.appTypeName,function(obj,i){obj.appKeyId==news.appKeyId&&($scope.chooseName=obj.appKeyName)});for(var i in resp.data.status)"Android"==resp.data.status[i].deviceType?($scope.flagA=1,android.status=resp.data.status[i].sentStatus,android.num=resp.data.status[i].sentTotal,android.sucess=resp.data.status[i].msgProcess,$scope.opens=resp.data.openNum,$scope.androidCheck=!0,news.appVersions.push($scope.chooseName+resp.data.status[i].deviceType+resp.data.status[i].appVersions)):"IOS"==resp.data.status[i].deviceType&&($scope.flagI=1,ios.status=resp.data.status[i].sentStatus,ios.num=resp.data.status[i].sentTotal,ios.sucess=resp.data.status[i].msgProcess,$scope.opens=resp.data.openNum,$scope.iosCheck=!0,news.appVersions.push($scope.chooseName+resp.data.status[i].deviceType+resp.data.status[i].appVersions)),2==resp.data.status[i].sentStatus&&($scope.message=2,$scope.errorMessage=resp.data.status[i].message);if(news.title=resp.data.msgTitle,news.msgPic=resp.data.msgPic,news["abstract"]=resp.data.msgTitle,news.addType=resp.data.addType,resp.data.addData)var addData=resp.data.addData;1==news.addType&&addData?news.addData=addData.value.videoId+"-"+addData.value.videoName+"-"+addData.value.playType+"-"+addData.value.image:2==news.addType&&addData?news.addData=addData.value:3==news.addType&&addData?news.addData=addData.value:4==news.addType&&addData?news.addData=addData.value.videoId+"-"+addData.value.videoName:5==news.addType&&addData&&($scope.addTmpKey=addData.key,news.addData=addData.value),news.area=resp.data.area,news.sendTime=new Date(1e3*resp.data.sendTime),$scope.houseTime=parseInt(resp.data.validTime/36e5),$scope.minuteTime=parseInt(resp.data.validTime%36e5/60),$scope.secondTime=parseInt(resp.data.validTime%36e5%60/60),0==resp.data.speed?$scope.speed=0:($scope.speed=1,news.speed_time=parseInt(resp.data.speed))},function(error){})}])}),define("modules/push/pushmsg/pushmessage",["angularAMD","modules/push/pushmsg/service","Session","jquery"],function(angularAMD){"use strict";angularAMD.controller("PushMessageCtrl",["$scope","PushMsgService","Session","$controller","$state","ngDialog","StarsUtils","$stateParams",function($scope,PushMsgService,Session,$controller,$state,ngDialog,StarsUtils,$stateParams){$scope.showId=$stateParams.showId,$scope.methods=$state.current.data.methods;var news=$scope.news={},pushMessageCtrl=$scope.pushMessageCtrl={};if($scope.showId=$stateParams.showId,news.equipment=[],$scope.typeStatus={1:"已发送",0:"未发送",2:"异常"},news.msgType=1,news.pushway=1,$controller("BaseCtrl",{$scope:$scope}),$scope.route(),PushMsgService.getAppKey().then(function(resp){$scope.appTypeName=resp.data.rows},function(error){}),pushMessageCtrl.chooseAppType=function(i){news.appKeyId=$scope.appTypeName[i].appKeyId,angular.forEach($scope.appTypeName,function(obj,i){obj.appKeyId!==$scope.appKeyId&&($scope.appVersion=[])})},""==$stateParams.showId){$scope.loading_list=!1;news.addData={},$scope.sends=1,$scope.ranges=1,news.msgPic="",news.appVersions=[],$scope.houseTime=1,$scope.minuteTime=0,$scope.secondTime=0,$scope.deviceCount=0,$scope.speed=0,$scope.speed_time=1,$scope.itemService=PushMsgService.setName("pushmsg"),$scope.sendTime=new Date}else{$scope.updateType=1;var android_device=angular.element(document.getElementsByClassName(".android_device")[0]),ios_device=angular.element(document.getElementsByClassName(".ios_device")[0]);$scope.loading_list=!0,$scope.indexApp=[],PushMsgService.getPushList($stateParams.showId).then(function(resp){$scope.msgType=resp.data.msgType,$scope.loading_list=!1,$scope.appVersion=[],news.appKeyId=resp.data.appKeyId,$scope.appKeyId=news.appKeyId,angular.forEach($scope.appTypeName,function(obj,i){obj.appKeyId==news.appKeyId&&($scope.chooseName=obj.appKeyName)});for(var i in resp.data.status)"Android"==resp.data.status[i].deviceType?($scope.flagA=1,$scope.message=1,$scope.status_A=resp.data.status[i].sentStatus,$scope.num_A=resp.data.status[i].sentTotal,$scope.sucess_A=resp.data.status[i].msgProcess,$scope.opens=resp.data.openNum,android_device.checked=!0,$scope.appVersion.push($scope.chooseName+resp.data.status[i].deviceType+resp.data.status[i].appVersions),news.equipment.push(1)):"IOS"==resp.data.status[i].deviceType&&($scope.flagI=1,$scope.message=1,$scope.status_I=resp.data.status[i].sentStatus,$scope.num_I=resp.data.status[i].sentTotal,$scope.sucess_I=resp.data.status[i].msgProcess,$scope.opens=resp.data.openNum,ios_device.checked=!0,$scope.appVersion.push($scope.chooseName+resp.data.status[i].deviceType+resp.data.status[i].appVersions),news.equipment.push(2)),2==resp.data.status[i].sentStatus&&($scope.message=2,$scope.errorMessage=resp.data.status[i].message);if(news.equipment=_.uniq(news.equipment),news.equipment.indexOf(2)>-1&&news.equipment.indexOf(1)>-1?($scope.android=!0,$scope.ios=!0):news.equipment.indexOf(1)>-1&&news.equipment.indexOf(2)<0?($scope.android=!0,$scope.ios=!1):news.equipment.indexOf(1)<0&&news.equipment.indexOf(2)>-1?($scope.android=!1,$scope.ios=!0):news.equipment.indexOf(2)<0&&news.equipment.indexOf(1)<0&&($scope.android=!1,$scope.ios=!1),$scope.tmpValue=angular.copy(resp.data.status),news.appVersions={},angular.forEach($scope.tmpValue,function(val){if("Android"==val.deviceType?val.deviceType="1":val.deviceType="2",angular.isDefined(val.deviceType)){var valuS=[];for(var j in val.appVersions)valuS.push(val.appVersions[j]);for(var a in valuS)(null==valuS[a]||"undefined"==valuS[a]||""==valuS[a])&&valuS.splice(valuS.indexOf(valuS[a]),1);news.appVersions[val.deviceType]=[].concat(news.appVersions[val.deviceType],valuS)}else{var valuN=[];for(var i in val.appVersions)valuN.push(val.appVersions[i]);news.appVersions[val.deviceType]=valuN}}),angular.isDefined(news.appVersions[1]))for(var k in news.appVersions[1])(null==news.appVersions[1][k]||"undefined"==news.appVersions[1][k]||""==news.appVersions[1][k])&&news.appVersions[1].splice(news.appVersions[1].indexOf(news.appVersions[1][k]),1);if(angular.isDefined(news.appVersions[2]))for(var k in news.appVersions[2])(null==news.appVersions[2][k]||"undefined"==news.appVersions[2][k]||""==news.appVersions[2][k])&&news.appVersions[2].splice(news.appVersions[2].indexOf(news.appVersions[2][k]),1);if(news.title=resp.data.msgTitle,news.msgPic=resp.data.msgPic,news["abstract"]=resp.data.msgDigest,news.addType=resp.data.addType,resp.data.addData)var addData=resp.data.addData;1==news.addType&&addData?(news.addData=$scope.addTmpData=addData.value.videoId+"-"+addData.value.videoName+"-"+addData.value.playType+"-"+addData.value.image,$scope.channelId=angular.copy(addData.value.videoId),$scope.channelName=angular.copy(addData.value.videoName),$scope.channelType=angular.copy(addData.value.playType),$scope.channelImage=angular.copy(addData.value.image)):2==news.addType&&addData?news.addData=tmpData.addTmpData=addData.value:3==news.addType&&addData?news.addData=tmpData.addTmpData=addData.value:4==news.addType&&addData?news.addData=$scope.addTmpData=addData.value.videoId+"-"+addData.value.videoName:5==news.addType&&addData&&(tmpData.addTmpKey=addData.key,tmpData.addTmpData=addData.value),news.area=resp.data.area,news.receiverGid="all",news.pushServer=1,$scope.sendTime=new Date(parseInt(1e3*resp.data.sendTime)),$scope.houseTime=parseInt(resp.data.validTime/36e5),$scope.minuteTime=parseInt(resp.data.validTime%36e5/60),$scope.secondTime=parseInt(resp.data.validTime%36e5%60/60),0==resp.data.speed?$scope.speed=0:($scope.speed=1,$scope.speed_time=parseInt(resp.data.speed))},function(error){})}var tmpData=$scope.tmpData={};$scope.ver={};var objOption=[{template:"modules/push/pushmsg/addnewsOption.html",data:{title:"选择频道",type:1,key:"play"},controller:"ChooseCtrl"},{template:"modules/push/pushmsg/addnewsOption.html",data:{title:"选择栏目",type:3},controller:"ChooseCtrl"}];$scope.ckMore=function(item,box){box?(news.equipment.push(item),$scope.deviceCount++):(news.equipment.splice(news.equipment.indexOf(item),1),$scope.deviceCount--)},pushMessageCtrl.changeChannel=function(){if(1==news.addType||2==$scope.ranges){var ngdialog1=ngDialog.open(objOption[0]);ngdialog1.closePromise.then(function(data){"undefined"!=typeof data.value&&"$closeButton"!=data.value&&"$document"!=data.value&&0!=data.value&&(1==news.addType&&2!=$scope.ranges&&($scope.channelId=data.value.videoId,$scope.channelName=data.value.videoName,$scope.channelType=data.value.videoType,$scope.channelImage=data.value.videoImage,$scope.addTmpData=$scope.channelId+" - "+$scope.channelName+" - "+$scope.channelType+" - "+$scope.channelImage),2==$scope.ranges&&(news.receiverGid=data.value.videoName))})}else if(4==news.addType){var ngdialog4=ngDialog.open(objOption[1]);ngdialog4.closePromise.then(function(data){"undefined"!=typeof data.value&&"$closeButton"!=data.value&&"$document"!=data.value&&0!=data.value&&($scope.colomnId=data.value.videoId,$scope.addTmpData=data.value.videoId+" - "+data.value.videoName)})}},pushMessageCtrl.chooseVersion=function(num){var objVersion=[{template:"modules/push/pushmsg/addnewsOption.html",data:{title:"选择版本",type:5,choose:$scope.appVer,android:$scope.android,appKeyId:news.appKeyId,ios:$scope.ios},controller:"ChooseCtrl"}];if(0==$scope.deviceCount)return void StarsUtils.alert("请先选择目标设备");var ngdialog=ngDialog.open(objVersion[num]);ngdialog.closePromise.then(function(data){if("undefined"!=typeof data.value&&"$closeButton"!=data.value&&"$document"!=data.value&&0!=data.value){news.appVersions={};var appVer=[];angular.forEach(data.value,function(obj){appVer.push(obj)});var versionValue=angular.copy(data.value);angular.forEach(versionValue,function(v,i){"Android"==v.appsAppOs?v.appsAppOs="1":v.appsAppOs="2",angular.isDefined(news.appVersions[v.appsAppOs])?news.appVersions[v.appsAppOs]=[].concat(news.appVersions[v.appsAppOs],[v.appsAppVersion]):news.appVersions[v.appsAppOs]=[v.appsAppVersion];
}),$scope.appVer=appVer,$scope.appVersion=[];for(var i in data.value)$scope.appVersion[i]=data.value[i].appKeyName+data.value[i].appsAppOs+data.value[i].appsAppVersion,"6.0.0"==data.value[i].appsAppVersion&&(news.addType=1)}},function(error){})},pushMessageCtrl.checkAddType=function(){4==$scope.news.addType&&$scope.appVersion.join("").indexOf("6.0.0")>-1&&(StarsUtils.alert("6.0.0版本没有栏目"),$scope.news.addType=1)},pushMessageCtrl.chooseArea=function(num){var objArea=[{template:"modules/push/pushmsg/addnewsOption.html",data:{title:"选择地区（最多3个）",type:2,area:news.area},controller:"ChooseCtrl"}],ngdialog=ngDialog.open(objArea[num]);ngdialog.closePromise.then(function(data){"undefined"!=typeof data.value&&"$closeButton"!=data.value&&"$document"!=data.value&&0!=data.value&&(news.area=data.value)})},pushMessageCtrl.goList=function(){$state.go("site.push.pushmsg.index")},pushMessageCtrl.checkCloseDialog=function(){$scope.errorMessage="",$scope.submitted=!0,news.validTime=36e5*$scope.houseTime+6e4*$scope.minuteTime+1e3*$scope.secondTime,0==$scope.sends?news.sendTime="":news.sendTime=Math.floor(Date.parse($scope.sendTime)/1e3),0==$scope.speed?news.speed=0:news.speed=angular.copy(parseInt($scope.speed_time)),1==$scope.ranges&&(news.receiverGid="all"),1==news.addType&&(news.addData={key:"play",value:{videoId:$scope.channelId,videoName:$scope.channelName,playType:$scope.channelType,image:$scope.channelImage}}),2==news.addType&&(news.addData={key:"download",value:tmpData.addTmpData}),3==news.addType&&(news.addData={key:"url",value:tmpData.addTmpData}),4==news.addType&&(news.addData={key:"column",value:$scope.colomnId}),5==news.addType&&(news.addData={key:tmpData.addTmpKey,value:tmpData.addTmpData}),$scope.myform.$invalid||(""==$stateParams.showId?StarsUtils.confirm("是否"+(""==news.sendTime?"发送":"保存")).then(function(data){PushMsgService.saveItem(news,$scope).then(function(data){$scope.submitStatus=!1,200==data.status||201==data.status?StarsUtils.confirm((""==news.sendTime?"发送":"保存")+"成功！").then(function(data){$state.go("site.push.pushmsg.index")},function(e){}):StarsUtils.alert((""==news.sendTime?"发送":"保存")+"失败！")},function(error){$scope.submitStatus=!1,StarsUtils.alert((""==news.sendTime?"发送":"保存")+"失败！")})},function(error){$scope.submitStatus=!1,StarsUtils.alert("未"+(""==news.sendTime?"发送":"保存")),$scope.errorMessage=error}):StarsUtils.confirm("是否"+(""==news.sendTime?"发送":"保存")).then(function(data){news.id=$stateParams.showId,PushMsgService.saveItem(news,$scope).then(function(data){$scope.submitStatus=!1,200==data.status||201==data.status?(StarsUtils.alert((""==news.sendTime?"发送":"保存")+"成功！"),$state.go("site.push.pushmsg.index")):StarsUtils.alert((""==news.sendTime?"发送":"保存")+"失败！")},function(error){$scope.submitStatus=!1,StarsUtils.alert((""==news.sendTime?"发送":"保存")+"失败！")})},function(error){$scope.submitStatus=!1,StarsUtils.alert("未"+(""==news.sendTime?"发送":"保存")),$scope.errorMessage=error}))}}])}),define("modules/push/pushmsg/service",["angularAMD","BaseService"],function(angularAMD,BaseService){"use strict";angularAMD.service("PushMsgService",["APP_CONFIG","$http","$q",function(config,$http,$q){var mapping={pushmsg:{msgType:"msgType",id:"msgId",title:"msgTitle",msgPic:"msgPic","abstract":"msgDigest",sentStatus:"sentStatus",equipment:"deviceType",pushway:"pushServer",addType:"addType",addData:"addData",receiverGid:"receiverGid",area:"area",sendTime:"sendTime",showTime:"showTime",showPlaceVal:"showPlaceVal",showCloseBtn:"showCloseBtn",showTitle:"showTitle",appVersions:"appVersions",validTime:"validTime",videoId:"videoId",videoName:"videoName",videoType:"videoType",videoImage:"videoImage",appsAppVersion:"appsAppVersion",appsAppOs:"appsAppOs",appKey:"appKey",appKeyId:"appKeyId",appKeyName:"appKeyName",description:"appsDescription",status:"status",speed:"speed",videoCategory:"videoCategory"},pushlist:{id:"propertyId",notice:"propertyId",content:"propertyType",objects:"typeName",way:"propertyId",equipment:"propertyName",status:"propertyType",time:"typeName"}},pushMsgService=new BaseService(config,$http,$q,mapping);return pushMsgService.setHttpBaseUrl(config.pushBaseUrl),pushMsgService.getChanngel=function(){var d=$q.defer();return $http({url:config.serverUrl+"/video/indexfornormal",method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){resp.data.rows=pushMsgService.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},pushMsgService.getEpg=function(){var d=$q.defer();return $http({url:config.serverUrl+"/video/indexfornormalvod",method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){resp.data.rows=pushMsgService.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},pushMsgService.getEpgList=function(pageNumber,params){var that=this,d=that.$q.defer();return params=params?that.changeFromLocalColumns(params):{},params.currentPage=pageNumber,that.$http({url:that.serverUrl+"/video/indexfornormalvod",method:"GET",params:params,header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/json"},withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},pushMsgService.getChannelList=function(pageNumber,params){var that=this,d=that.$q.defer();return params=params?that.changeFromLocalColumns(params):{},params.currentPage=pageNumber,that.$http({url:that.serverUrl+"/video/indexfornormal",method:"GET",params:params,header:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/json"},withCredentials:!0}).then(function(resp){resp.data.rows=that.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},pushMsgService.getApps=function(id){var d=$q.defer();return $http({url:config.serverUrl+"/apps/indexforpush?appsAppId="+id+"&isAll=1",method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){resp.data.rows=pushMsgService.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},pushMsgService.getAppKey=function(){var d=$q.defer();return $http({url:config.serverUrl+"/apps/indexappkey?isAll=1",method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){resp.data.rows=pushMsgService.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},pushMsgService.getPushList=function(id){var d=$q.defer();return $http({url:config.pushBaseUrl+"/pushmsg/show/"+id,method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){resp.data.rows=pushMsgService.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},pushMsgService.getSwitch=function(){var d=$q.defer();return $http({url:config.pushBaseUrl+"/pushmsg/lbs/GeTuiLBSlock",method:"GET",headers:{Authorization:"Basic fdfwoeigjiewoe","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(resp){resp.data.rows=pushMsgService.changeToLocalColumns(resp.data.rows),d.resolve(resp)},function(error){d.reject(error)}),d.promise},pushMsgService.setSwitch=function(num){var that=this,method="",url="";return method="POST",url=that.pushBaseUrl+"/pushmsg/switchlbs",that.$http({url:url,method:method,data:{key:"GeTuiLBSlock",value:num},withCredentials:!0})},pushMsgService}])}),define("modules/push/pushmsg/switch",["angularAMD","modules/push/pushmsg/service","Session"],function(angularAMD){"use strict";angularAMD.controller("SwitchCtrl",["$scope","PushMsgService","Session","$controller","$state","ngDialog","StarsUtils",function($scope,PushMsgService,Session,$controller,$state,ngDialog,StarsUtils){$scope.methods=$state.current.data.methods,$scope.$state=$state;var switchCtrl=$scope.switchCtrl={};PushMsgService.getSwitch().then(function(resp){$scope.opens=resp.data.data.value},function(error){}),switchCtrl.setChange=function(num){1==num?PushMsgService.setSwitch(num).then(function(resp){$scope.opens=resp.data.data.value},function(error){}):PushMsgService.setSwitch(num).then(function(resp){$scope.opens=resp.data.data.value},function(error){})}}])});